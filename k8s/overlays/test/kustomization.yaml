apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: service-layer

resources:
  - ../../base

# Local test images are built/imported with the `:test` tag.
images:
  - name: service-layer/neofeeds
    newTag: test
  - name: service-layer/neoflow
    newTag: test
  - name: service-layer/neoaccounts
    newTag: test
  - name: service-layer/neocompute
    newTag: test
  - name: service-layer/neovrf
    newTag: test
  - name: service-layer/neooracle
    newTag: test
  - name: service-layer/neorequests
    newTag: test
  - name: service-layer/txproxy
    newTag: test
  - name: service-layer/globalsigner
    newTag: test

# Test overlay: run in OE simulation mode with MARBLE_ENV=testing.
patches:
  - target:
      kind: ConfigMap
      name: service-layer-config
    patch: |-
      - op: replace
        path: /data/OE_SIMULATION
        value: "1"
      - op: replace
        path: /data/MARBLE_ENV
        value: "testing"
      - op: replace
        path: /data/TXPROXY_TIMEOUT
        value: "90s"
      - op: replace
        path: /data/SUPABASE_URL
        value: "http://postgrest.supabase.svc.cluster.local:3000"
      - op: replace
        path: /data/SUPABASE_REST_PREFIX
        value: "/"
      - op: replace
        path: /data/SUPABASE_ALLOW_INSECURE
        value: "true"
      - op: replace
        path: /data/CONTRACT_PAYMENT_HUB_ADDRESS
        value: "0x0bb8f09e6d3611bc5c8adbd79ff8af1e34f73193"
      - op: replace
        path: /data/CONTRACT_GOVERNANCE_ADDRESS
        value: "0xc8f3bbe1c205c932aab00b28f7df99f9bc788a05"
      - op: replace
        path: /data/CONTRACT_PRICE_FEED_ADDRESS
        value: "0xc5d9117d255054489d1cf59b2c1d188c01bc9954"
      - op: replace
        path: /data/CONTRACT_RANDOMNESS_LOG_ADDRESS
        value: "0x76dfee17f2f4b9fa8f32bd3f4da6406319ab7b39"
      - op: replace
        path: /data/CONTRACT_APP_REGISTRY_ADDRESS
        value: "0x79d16bee03122e992bb80c478ad4ed405f33bc7f"
      - op: replace
        path: /data/CONTRACT_AUTOMATION_ANCHOR_ADDRESS
        value: "0x1c888d699ce76b0824028af310d90c3c18adeab5"
      - op: replace
        path: /data/CONTRACT_SERVICE_GATEWAY_ADDRESS
        value: "0x27b79cf631eff4b520dd9d95cd1425ec33025a53"

labels:
  - includeSelectors: true
    includeTemplates: true
    pairs:
      environment: test
