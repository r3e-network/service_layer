# =============================================================================
# Neo Service Layer - Environment Configuration
# MarbleRun + EGo + Supabase + Vercel Architecture
# =============================================================================

# =============================================================================
# Supabase Configuration
# =============================================================================
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key

# PostgreSQL Direct Connection (SSL Required)
POSTGRES_HOST=db.your-project.supabase.co
POSTGRES_PORT=5432
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-password
POSTGRES_SSLMODE=verify-full

# =============================================================================
# MarbleRun Coordinator Configuration
# =============================================================================
# Address marbles use to reach the coordinator mesh port.
# - Docker Compose: use the service DNS name (default network)
# - Kubernetes: use the Service DNS name (e.g. marblerun-coordinator.marblerun.svc.cluster.local:2001)
COORDINATOR_MESH_ADDR=coordinator:2001
COORDINATOR_CLIENT_ADDR=localhost:4433
MANIFEST_PATH=/app/manifests/manifest.json

# =============================================================================
# EGo/SGX Configuration
# =============================================================================
# Set to 1 for simulation mode (development)
# Set to 0 for SGX hardware (production)
OE_SIMULATION=1

# =============================================================================
# Server Configuration
# =============================================================================
MARBLE_ENV=development
PORT=8080
METRICS_PORT=9090
DEBUG=false

# Logging
LOG_LEVEL=info
LOG_FORMAT=json

# =============================================================================
# Gateway Security
# =============================================================================
# Required in production (>= 32 bytes). Prefer MarbleRun secrets injection.
JWT_SECRET=change-me-change-me-change-me-32bytes

# Optional admin allowlists (comma-separated user IDs).
# When set, the gateway will attach `X-User-Role: admin|super_admin` to proxied
# service requests (over MarbleRun mTLS) to unlock admin endpoints.
ADMIN_USER_IDS=
SUPER_ADMIN_USER_IDS=

# JWT expiry (Go duration, e.g. 15m, 24h). Used to keep JWT `exp`, Supabase
# session expiry, and OAuth cookie TTL aligned.
JWT_EXPIRY=24h

# Gateway rate limiting (optional but recommended in production)
RATE_LIMIT_ENABLED=false
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=1m
# Optional burst budget (defaults to RATE_LIMIT_REQUESTS if unset)
RATE_LIMIT_BURST=100

# Public listener TLS mode:
# - off: HTTP (recommended behind a TLS-terminating reverse proxy / ingress)
# - tls: HTTPS without client certs (uses MarbleRun-issued cert; not publicly trusted)
# - mtls: HTTPS with required client certs (mesh-only)
GATEWAY_TLS_MODE=off

# CORS (comma-separated)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# =============================================================================
# OAuth (Optional)
# =============================================================================
FRONTEND_URL=http://localhost:3000
OAUTH_REDIRECT_BASE=http://localhost:8080
OAUTH_COOKIE_MODE=true
# strict|lax|none (none requires HTTPS)
OAUTH_COOKIE_SAMESITE=lax
# OAuth token at-rest encryption key (hex-encoded 32 bytes).
# - MarbleRun deployments can generate/inject this via manifest secret OAUTH_TOKENS_MASTER_KEY.
# - Non-Marblerun: generate with `openssl rand -hex 32`
OAUTH_TOKENS_MASTER_KEY=
# Secrets encryption master key (hex-encoded 32 bytes).
# Required in production/SGX mode for secrets management and secret injection into services.
# Generate with `openssl rand -hex 32`
SECRETS_MASTER_KEY=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# =============================================================================
# Neo N3 Configuration
# =============================================================================
NEO_RPC_URL=https://testnet1.neo.coz.io:443
NEO_NETWORK_MAGIC=894710606

# Neo N3 Testnet Account (for Fairy tests and contract deployment)
NEO_TESTNET_WIF=your-testnet-wif-here
NEO_TESTNET_ADDRESS=your-testnet-address-here
NEO_TESTNET_PUBKEY=your-testnet-pubkey-here

# =============================================================================
# Neo N3 Contract Addresses
# Deploy contracts with: go run ./cmd/deploy-fairy/main.go
# =============================================================================
CONTRACT_GATEWAY_HASH=0x0000000000000000000000000000000000000000
CONTRACT_VRF_HASH=0x0000000000000000000000000000000000000000
# Preferred names (legacy fallbacks are still accepted by the codebase)
CONTRACT_DATAFEEDS_HASH=0x0000000000000000000000000000000000000000
CONTRACT_AUTOMATION_HASH=0x0000000000000000000000000000000000000000
CONTRACT_CONFIDENTIAL_HASH=0x0000000000000000000000000000000000000000
CONTRACT_ORACLE_HASH=0x0000000000000000000000000000000000000000

# Fairy RPC for local testing
FAIRY_RPC_URL=http://127.0.0.1:16868

# =============================================================================
# Gateway Upstream Service URLs
# When running via Docker Compose, use service DNS names (not localhost).
# =============================================================================
VRF_SERVICE_URL=http://neorand:8081
DATAFEEDS_SERVICE_URL=http://neofeeds:8083
AUTOMATION_SERVICE_URL=http://neoflow:8084
ACCOUNTPOOL_SERVICE_URL=http://neoaccounts:8085
CONFIDENTIAL_SERVICE_URL=http://neocompute:8086
ORACLE_SERVICE_URL=http://neooracle:8088

# Service-to-service URLs (used by marbles)
ACCOUNTPOOL_URL=http://neoaccounts:8085

# Oracle outbound URL allowlist (comma-separated prefixes)
# Required in production/SGX mode. Examples:
# ORACLE_HTTP_ALLOWLIST=https://api.binance.com,https://api.coinbase.com
ORACLE_HTTP_ALLOWLIST=https://api.binance.com,https://api.coinbase.com

# NeoFlow webhook security (production/SGX)
# External webhooks are blocked from targeting private/loopback/link-local networks by default.
# Set to true only if you need to call private endpoints (not recommended).
NEOFLOW_WEBHOOK_ALLOW_PRIVATE_NETWORKS=false

# =============================================================================
# Frontend Configuration (Vercel)
# =============================================================================
VITE_API_URL=http://localhost:8080/api/v1

# Binance API
BINANCE_API_KEY=your_binance_api_key_here

# Arbitrum RPC for Chainlink price feeds
ARBITRUM_RPC=https://arb1.arbitrum.io/rpc
