# =============================================================================
# Neo Service Layer - Environment Configuration
# MarbleRun + EGo + Supabase + Vercel Architecture
# =============================================================================

# =============================================================================
# Supabase Configuration
# =============================================================================
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
# Supabase service role key. For compatibility:
# - Go services typically use `SUPABASE_SERVICE_KEY`
# - Supabase Edge functions typically use `SUPABASE_SERVICE_ROLE_KEY`
SUPABASE_SERVICE_KEY=your-service-key
SUPABASE_SERVICE_ROLE_KEY=your-service-key

# PostgreSQL Direct Connection (SSL Required)
POSTGRES_HOST=db.your-project.supabase.co
POSTGRES_PORT=5432
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-password
POSTGRES_SSLMODE=verify-full

# =============================================================================
# MarbleRun Coordinator Configuration
# =============================================================================
# Address marbles use to reach the coordinator mesh port.
# - Docker Compose: use the service DNS name (default network)
# - Kubernetes: use the Service DNS name (e.g. marblerun-coordinator.marblerun.svc.cluster.local:2001)
COORDINATOR_MESH_ADDR=coordinator:2001
COORDINATOR_CLIENT_ADDR=localhost:4433
MANIFEST_PATH=/app/manifests/manifest.json

# =============================================================================
# EGo/SGX Configuration
# =============================================================================
# Set to 1 for simulation mode (development)
# Set to 0 for SGX hardware (production)
OE_SIMULATION=1

# =============================================================================
# Server Configuration
# =============================================================================
MARBLE_ENV=development
PORT=8080
METRICS_PORT=9090
DEBUG=false

# Service selection (cmd/marble)
# MarbleRun sets `MARBLE_TYPE` for each Marble automatically.
# For local debugging, you can set `SERVICE_TYPE` instead:
# SERVICE_TYPE=neocompute
# MARBLE_TYPE=neocompute

# Logging
LOG_LEVEL=info
LOG_FORMAT=json

# Metrics exposure toggle (see infrastructure/metrics)
# - production: disabled unless explicitly enabled
# - non-production: enabled unless explicitly disabled
# METRICS_ENABLED=true

# =============================================================================
# Secrets (Shared: Supabase Edge + TEE services)
# =============================================================================
# Secrets encryption master key (hex-encoded 32 bytes).
# Required for secrets management and secret injection into services.
# Generate with `openssl rand -hex 32`
SECRETS_MASTER_KEY=

# =============================================================================
# Neo N3 Configuration
# =============================================================================
# Optional: comma-separated list of RPC endpoints (used by cmd/marble if set).
# If unset, `NEO_RPC_URL` is used.
# NEO_RPC_URLS=https://testnet1.neo.coz.io:443,https://testnet2.neo.coz.io:443
NEO_RPC_URL=https://testnet1.neo.coz.io:443
NEO_NETWORK_MAGIC=894710606

# Neo N3 Testnet Account (for Fairy tests and contract deployment)
NEO_TESTNET_WIF=your-testnet-wif-here
NEO_TESTNET_ADDRESS=your-testnet-address-here
NEO_TESTNET_PUBKEY=your-testnet-pubkey-here

# =============================================================================
# Neo N3 Contract Addresses
# Deploy contracts with: go run ./cmd/deploy-fairy/main.go
# =============================================================================
# MiniApp platform contracts
CONTRACT_PAYMENTHUB_HASH=0x0000000000000000000000000000000000000000
CONTRACT_GOVERNANCE_HASH=0x0000000000000000000000000000000000000000
CONTRACT_PRICEFEED_HASH=0x0000000000000000000000000000000000000000
CONTRACT_RANDOMNESSLOG_HASH=0x0000000000000000000000000000000000000000
CONTRACT_APPREGISTRY_HASH=0x0000000000000000000000000000000000000000
CONTRACT_AUTOMATIONANCHOR_HASH=0x0000000000000000000000000000000000000000

# Fairy RPC for local testing
FAIRY_RPC_URL=http://127.0.0.1:16868

# =============================================================================
# Service routing (Supabase Edge + internal mesh)
# =============================================================================
# These are the service URLs the Supabase Edge functions call. In production you
# should use HTTPS + mTLS with MarbleRun/attested TLS.
NEOFEEDS_URL=http://neofeeds:8083
NEOCOMPUTE_URL=http://neocompute:8086
NEOORACLE_URL=http://neooracle:8088
NEOFLOW_URL=http://neoflow:8084
TXPROXY_URL=http://txproxy:8090

# Optional: service-to-service signer routing (preferred over distributing keys).
# When set, marbles (except `globalsigner`) will delegate signing to GlobalSigner.
# GLOBALSIGNER_SERVICE_URL=https://globalsigner:8092

# Optional: chain event listener start height (defaults to current height-1).
# NEO_EVENT_START_BLOCK=0

# Oracle outbound URL allowlist (comma-separated prefixes)
# Required in production/SGX mode. Examples:
# ORACLE_HTTP_ALLOWLIST=https://api.binance.com,https://api.coinbase.com
ORACLE_HTTP_ALLOWLIST=https://api.binance.com,https://api.coinbase.com

# NeoOracle request controls (optional)
# - ORACLE_TIMEOUT: Go duration (e.g. 20s, 1m)
# - ORACLE_MAX_SIZE: max response size in bytes (supports KiB/MiB/GiB suffixes)
ORACLE_TIMEOUT=20s
ORACLE_MAX_SIZE=2MiB

# NeoCompute execution result retention (optional; default 24h)
# NEOCOMPUTE_RESULT_TTL=24h

# TxProxy allowlist (JSON). Default is deny-all when unset.
# Method names must match Neo devpack manifest names (lowerCamelCase).
# Minimal platform allowlist example:
# TXPROXY_ALLOWLIST='{"contracts":{"<paymentHubHash>":["pay"],"<governanceHash>":["stake","unstake","vote"],"<priceFeedHash>":["update"],"<randomnessLogHash>":["record"],"<automationAnchorHash>":["markExecuted"]}}'
# For automation target contracts, add them explicitly (or use "*" per contract, not recommended).
TXPROXY_ALLOWLIST=

# NeoFlow webhook security (production/SGX)
# External webhooks are blocked from targeting private/loopback/link-local networks by default.
# Set to true only if you need to call private endpoints (not recommended).
NEOFLOW_WEBHOOK_ALLOW_PRIVATE_NETWORKS=false

# NeoFlow scheduler hydration (optional)
# If set, the scheduler will hydrate Supabase triggers for this user ID on startup.
# (Intended to be injected via MarbleRun secrets in production.)
# NEOFLOW_SCHEDULER_USER_ID=

# AutomationAnchor anchored tasks (optional)
# Comma-separated task IDs to load from the on-chain `AutomationAnchor` registry.
# Each entry can be either:
# - plain ASCII (stored as bytes), or
# - hex bytes (0x...).
NEOFLOW_TASK_IDS=

# Binance API
BINANCE_API_KEY=your_binance_api_key_here

# Arbitrum RPC for Chainlink price feeds
ARBITRUM_RPC=https://arb1.arbitrum.io/rpc

# =============================================================================
# Development-only signing keys (fallback)
# =============================================================================
# In production, use GlobalSigner (`GLOBALSIGNER_SERVICE_URL`) rather than
# distributing private keys to every enclave service.
#
# TEE_PRIVATE_KEY=hex_private_key_for_chain_signing
# TEE_WALLET_PRIVATE_KEY=hex_private_key_for_wallet_operations

# =============================================================================
# MarbleRun-injected identity & secrets (do not set manually)
# =============================================================================
# These are injected by MarbleRun/ego inside the enclave and are shown here for
# completeness and for debugging local simulations.
#
# MARBLE_CERT=
# MARBLE_KEY=
# MARBLE_ROOT_CA=
# MARBLE_EXTRA_CLIENT_CA=
# MARBLE_UUID=
# MARBLE_SECRETS=

# =============================================================================
# Supabase Edge â†’ TEE mTLS (optional)
# =============================================================================
# Edge functions will use mTLS when these PEM values are set.
#
# TEE_MTLS_CERT_PEM=
# TEE_MTLS_KEY_PEM=
# TEE_MTLS_ROOT_CA_PEM=
#
# Alternatively:
# MARBLERUN_ROOT_CA_PEM=
#
# RNG anchoring (optional): set to 1 to record RNG results on-chain via txproxy.
# RNG_ANCHOR=1
