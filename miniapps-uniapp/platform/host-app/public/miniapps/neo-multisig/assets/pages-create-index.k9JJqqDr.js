import{d as e,r as a,m as l,c as s,a as t,w as u,i,b as c,e as d,f as n,p as o,h as r,t as v,u as f,q as _,j as m,F as p,k as h,I as b,s as g,n as y,v as k,g as w,x as C,y as S}from"./index-Cx0r-ZdL.js";import{u as F,_ as x}from"./Fireworks.vue_vue_type_style_index_0_scoped_c40424c2_lang.CSrFNuIw.js";import{N as A,a as V}from"./NeoCard.CpQJoTQ8.js";import{u as I,n as N,i as U,v as T,f as B,c as H,b as L,a as j}from"./multisig.BGRtNVDZ.js";import"minimalistic-assert";import"minimalistic-crypto-utils";import"brorand";import"inherits";import"hash.js";import"hmac-drbg";const D=x(e({__name:"index",setup(e){const{t:x}=F(),{chainId:D}=I(),G=a(1),O=a(["",""]),P=a(1),E=a("neo-n3-testnet"===D.value?"neo-n3-testnet":"neo-n3-mainnet"),K=a("GAS"),M=a(""),z=a(""),J=a(""),q=a(!1),R=a(!1),$=a(null),Q=a(null),W=a({systemFee:"0",networkFee:"0",validUntilBlock:0});l(O,e=>{P.value>e.length&&(P.value=e.length||1)},{deep:!0});const X=s(()=>{var e;return(null==(e=$.value)?void 0:e.address)||""}),Y=s(()=>{var e;return(null==(e=$.value)?void 0:e.scriptHash)||""}),Z=s(()=>"neo-n3-mainnet"===E.value?x("chainMainnet"):x("chainTestnet")),ee=s(()=>O.value.map(e=>e.trim())),ae=s(()=>{if(ee.value.some(e=>!e))return!1;try{return N(ee.value),!0}catch{return!1}}),le=s(()=>U(M.value)&&T(z.value,K.value)),se=()=>o(),te=()=>O.value.push(""),ue=e=>{E.value=e},ie=e=>{P.value=e.detail.value},ce=()=>{G.value=2},de=()=>{var e;try{const e=N(ee.value);$.value=H(P.value,e),G.value=3}catch(a){const l=(null==(e=null==a?void 0:a.message)?void 0:e.includes("duplicate"))?x("toastDuplicateSigners"):x("toastInvalidSigners");k({title:l,icon:"none"})}},ne=async()=>{if($.value)if(U(M.value))if(T(z.value,K.value)){q.value=!0;try{const e=await L({chainId:E.value,fromAddress:X.value,toAddress:M.value,amount:z.value,assetSymbol:K.value,threshold:P.value,publicKeys:$.value.publicKeys});Q.value=e.tx,W.value={systemFee:e.systemFee,networkFee:e.networkFee,validUntilBlock:e.validUntilBlock},G.value=4}catch(e){k({title:x("toastPrepareFailed"),icon:"none"})}finally{q.value=!1}}else k({title:x("toastInvalidAmount"),icon:"none"});else k({title:x("toastInvalidAddress"),icon:"none"});else k({title:x("toastInvalidSigners"),icon:"none"})},oe=async()=>{if(Q.value&&$.value){R.value=!0;try{const e=await j.create({chainId:E.value,scriptHash:$.value.scriptHash,threshold:P.value,signers:$.value.publicKeys,transactionHex:Q.value.serialize(!1),memo:J.value||void 0}),a=w("multisig_history")?JSON.parse(w("multisig_history")):[];a.unshift({id:e.id,scriptHash:$.value.scriptHash,status:e.status||"pending",createdAt:e.created_at||(new Date).toISOString()}),C("multisig_history",JSON.stringify(a.slice(0,10))),S({url:`/pages/sign/index?id=${e.id}`})}catch(e){k({title:x("toastCreateFailed"),icon:"none"})}finally{R.value=!1}}},re=e=>B(e);return(e,a)=>{const l=n,s=i,o=b,k=g;return c(),t(s,{class:"page-container"},{default:u(()=>[d(s,{class:"nav-header"},{default:u(()=>[d(l,{class:"back-btn",onClick:se},{default:u(()=>[r("←")]),_:1}),d(s,{class:"nav-text"},{default:u(()=>[d(l,{class:"title"},{default:u(()=>[r(v(f(x)("createTitle")),1)]),_:1}),d(l,{class:"subtitle"},{default:u(()=>[r(v(f(x)("appSubtitle")),1)]),_:1})]),_:1})]),_:1}),d(s,{class:"content"},{default:u(()=>[1===G.value?(c(),t(f(A),{key:0,class:"step-card"},{default:u(()=>[d(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step1Title")),1)]),_:1}),d(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step1Desc")),1)]),_:1}),d(s,{class:"signer-list"},{default:u(()=>[(c(!0),m(p,null,h(O.value,(e,a)=>(c(),t(s,{key:a,class:"signer-row"},{default:u(()=>[d(l,{class:"index"},{default:u(()=>[r(v(a+1),1)]),_:2},1024),d(o,{class:"input",modelValue:O.value[a],"onUpdate:modelValue":e=>O.value[a]=e,placeholder:f(x)("signerPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),O.value.length>1?(c(),t(l,{key:0,class:"remove-btn",onClick:e=>{return l=a,O.value.splice(l,1);var l}},{default:u(()=>[r("×")]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024))),128))]),_:1}),d(f(V),{variant:"secondary",size:"sm",onClick:te,class:"add-btn"},{default:u(()=>[r(v(f(x)("addSigner")),1)]),_:1}),d(s,{class:"actions"},{default:u(()=>[d(f(V),{variant:"primary",block:"",onClick:ce,disabled:!ae.value},{default:u(()=>[r(v(f(x)("buttonNext")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0),2===G.value?(c(),t(f(A),{key:1,class:"step-card"},{default:u(()=>[d(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step2Title")),1)]),_:1}),d(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step2Desc")),1)]),_:1}),d(s,{class:"threshold-control"},{default:u(()=>[d(l,{class:"threshold-val"},{default:u(()=>[r(v(P.value),1)]),_:1}),d(l,{class:"threshold-total"},{default:u(()=>[r("/ "+v(O.value.length),1)]),_:1})]),_:1}),d(k,{value:P.value,min:1,max:O.value.length,activeColor:"#00E599",onChange:ie},null,8,["value","max"]),d(s,{class:"actions row"},{default:u(()=>[d(f(V),{variant:"secondary",onClick:a[0]||(a[0]=e=>G.value=1)},{default:u(()=>[r(v(f(x)("buttonBack")),1)]),_:1}),d(f(V),{variant:"primary",onClick:de},{default:u(()=>[r(v(f(x)("buttonNext")),1)]),_:1})]),_:1})]),_:1})):_("",!0),3===G.value?(c(),t(f(A),{key:2,class:"step-card"},{default:u(()=>[d(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step3Title")),1)]),_:1}),d(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step3Desc")),1)]),_:1}),d(s,{class:"summary-block"},{default:u(()=>[d(s,{class:"summary-row"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("multisigAddressLabel")),1)]),_:1}),d(l,{class:"value mono"},{default:u(()=>[r(v(X.value||"--"),1)]),_:1})]),_:1}),d(s,{class:"summary-row"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("multisigScriptHashLabel")),1)]),_:1}),d(l,{class:"value mono"},{default:u(()=>[r(v(Y.value||"--"),1)]),_:1})]),_:1})]),_:1}),d(s,{class:"form-group"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("chainLabel")),1)]),_:1}),d(s,{class:"pill-group"},{default:u(()=>[d(s,{class:y(["pill",{active:"neo-n3-mainnet"===E.value}]),onClick:a[1]||(a[1]=e=>ue("neo-n3-mainnet"))},{default:u(()=>[d(l,null,{default:u(()=>[r(v(f(x)("chainMainnet")),1)]),_:1})]),_:1},8,["class"]),d(s,{class:y(["pill",{active:"neo-n3-testnet"===E.value}]),onClick:a[2]||(a[2]=e=>ue("neo-n3-testnet"))},{default:u(()=>[d(l,null,{default:u(()=>[r(v(f(x)("chainTestnet")),1)]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),d(s,{class:"form-group"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("assetLabel")),1)]),_:1}),d(s,{class:"asset-toggle"},{default:u(()=>[d(l,{class:y({active:"GAS"===K.value}),onClick:a[3]||(a[3]=e=>K.value="GAS")},{default:u(()=>[r(v(f(x)("assetGas")),1)]),_:1},8,["class"]),d(l,{class:y({active:"NEO"===K.value}),onClick:a[4]||(a[4]=e=>K.value="NEO")},{default:u(()=>[r(v(f(x)("assetNeo")),1)]),_:1},8,["class"])]),_:1})]),_:1}),d(s,{class:"form-group"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("toAddressLabel")),1)]),_:1}),d(o,{class:"input",modelValue:M.value,"onUpdate:modelValue":a[5]||(a[5]=e=>M.value=e),placeholder:f(x)("toAddressPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),d(s,{class:"form-group"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("amountLabel")),1)]),_:1}),d(o,{class:"input",modelValue:z.value,"onUpdate:modelValue":a[6]||(a[6]=e=>z.value=e),type:"digit",placeholder:f(x)("amountPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),d(s,{class:"form-group"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("memoLabel")),1)]),_:1}),d(o,{class:"input",modelValue:J.value,"onUpdate:modelValue":a[7]||(a[7]=e=>J.value=e),placeholder:f(x)("memoPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),d(s,{class:"actions row"},{default:u(()=>[d(f(V),{variant:"secondary",onClick:a[8]||(a[8]=e=>G.value=2)},{default:u(()=>[r(v(f(x)("buttonBack")),1)]),_:1}),d(f(V),{variant:"primary",onClick:ne,disabled:!le.value||q.value},{default:u(()=>[r(v(q.value?f(x)("loading"):f(x)("buttonReview")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0),4===G.value?(c(),t(f(A),{key:3,class:"step-card"},{default:u(()=>[d(l,{class:"step-title"},{default:u(()=>[r(v(f(x)("step4Title")),1)]),_:1}),d(l,{class:"step-desc"},{default:u(()=>[r(v(f(x)("step4Desc")),1)]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewFrom")),1)]),_:1}),d(l,{class:"value mono"},{default:u(()=>[r(v(X.value),1)]),_:1})]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewTo")),1)]),_:1}),d(l,{class:"value mono"},{default:u(()=>[r(v(M.value),1)]),_:1})]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewAmount")),1)]),_:1}),d(l,{class:"value highlight"},{default:u(()=>[r(v(z.value)+" "+v(K.value),1)]),_:1})]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewSigners")),1)]),_:1}),d(l,{class:"value"},{default:u(()=>[r(v(P.value)+" / "+v(O.value.length),1)]),_:1})]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewChain")),1)]),_:1}),d(l,{class:"value"},{default:u(()=>[r(v(Z.value),1)]),_:1})]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewFees")),1)]),_:1}),d(s,{class:"fee-grid"},{default:u(()=>[d(s,{class:"fee-row"},{default:u(()=>[d(l,{class:"fee-label"},{default:u(()=>[r(v(f(x)("reviewNetworkFee")),1)]),_:1}),d(l,{class:"fee-value"},{default:u(()=>[r(v(re(W.value.networkFee))+" GAS",1)]),_:1})]),_:1}),d(s,{class:"fee-row"},{default:u(()=>[d(l,{class:"fee-label"},{default:u(()=>[r(v(f(x)("reviewSystemFee")),1)]),_:1}),d(l,{class:"fee-value"},{default:u(()=>[r(v(re(W.value.systemFee))+" GAS",1)]),_:1})]),_:1})]),_:1})]),_:1}),d(s,{class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("reviewValidUntil")),1)]),_:1}),d(l,{class:"value"},{default:u(()=>[r(v(W.value.validUntilBlock),1)]),_:1})]),_:1}),J.value?(c(),t(s,{key:0,class:"review-item"},{default:u(()=>[d(l,{class:"label"},{default:u(()=>[r(v(f(x)("detailMemo")),1)]),_:1}),d(l,{class:"value"},{default:u(()=>[r(v(J.value),1)]),_:1})]),_:1})):_("",!0),d(s,{class:"actions row"},{default:u(()=>[d(f(V),{variant:"secondary",onClick:a[9]||(a[9]=e=>G.value=3)},{default:u(()=>[r(v(f(x)("buttonBack")),1)]),_:1}),d(f(V),{variant:"primary",onClick:oe,disabled:R.value},{default:u(()=>[r(v(R.value?f(x)("buttonCreating"):f(x)("buttonCreate")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-7e13e6ee"]]);export{D as default};
