import{d as a,x as e,c as l,h as s,e as t,g as u,w as i,j as c,v as r,z as n,q as o,l as d,F as v,k as f,t as p,i as _,B as y,r as m,o as k,C as h,p as b,n as z,u as C}from"./index-COnl_ame.js";import{u as g,a as I,A as w,P as T}from"./useScratchCard.Csh_h9HV.js";import{_ as x}from"./useI18n.gVGLE7Zz.js";const D=x(a({__name:"ChineseLuckyOverlay",props:{visible:{type:Boolean},prize:{},tier:{}},emits:["close"],setup(a,{emit:m}){const k=a,h=m,b=["","å®‰æ…°å¥–","äº”ç­‰å¥–","å››ç­‰å¥–","ä¸‰ç­‰å¥–","ç‰¹ç­‰å¥–"],z=e(()=>b[k.tier]||""),C=()=>h("close"),g=a=>({left:5*a%100+"%",animationDelay:.1*a+"s",animationDuration:`${1.5+Math.random()}s`}),I=a=>({left:3.3*a%100+"%",backgroundColor:a%2==0?"#DC2626":"#F59E0B",animationDelay:.05*a+"s"});return(a,e)=>{const m=u,k=f,h=_;return a.visible?(t(),l(m,{key:0,class:"lucky-overlay",onClick:C},{default:i(()=>[c(m,{class:"coins-container"},{default:i(()=>[(t(),r(v,null,n(20,a=>c(m,{key:a,class:"coin",style:o(g(a))},{default:i(()=>[d("ðŸª™")]),_:2},1032,["style"])),64))]),_:1}),c(m,{class:"prize-card",onClick:e[0]||(e[0]=y(()=>{},["stop"]))},{default:i(()=>[c(m,{class:"prize-header"},{default:i(()=>[c(k,{class:"congrats"},{default:i(()=>[d("ðŸŽ‰ æ­å–œä¸­å¥– ðŸŽ‰")]),_:1})]),_:1}),c(m,{class:"prize-amount"},{default:i(()=>[c(k,{class:"amount"},{default:i(()=>[d(p(a.prize),1)]),_:1}),c(k,{class:"unit"},{default:i(()=>[d("GAS")]),_:1})]),_:1}),c(m,{class:"prize-tier"},{default:i(()=>[c(k,null,{default:i(()=>[d(p(z.value),1)]),_:1})]),_:1}),c(h,{class:"btn-claim",onClick:C},{default:i(()=>[d(" é¢†å–å¥–åŠ± ")]),_:1})]),_:1}),c(m,{class:"confetti-container"},{default:i(()=>[(t(),r(v,null,n(30,a=>c(m,{key:"c"+a,class:"confetti",style:o(I(a))},null,8,["style"])),64))]),_:1})]),_:1})):s("",!0)}}}),[["__scopeId","data-v-9f81b6ad"]]),j=x(a({__name:"play",props:{type:{},ticketId:{}},setup(a){const o=a,{getLotteryType:y}=g(),{isLoading:x,buyTicket:j,revealTicket:P,formatPrize:S}=I(),$=m(!1),A=m(!1),B=m(0),F=m(0),L=m(null),G=m(0),M=m(""),O=m(!1),q=e(()=>{const a=parseInt(o.type||"0");return y(a)}),E=async()=>{if(q.value){M.value="è´­ä¹°ä¸­...";try{const a=await j(q.value.type);L.value=a.ticketId,$.value=!0,M.value="è´­ä¹°æˆåŠŸï¼åˆ®å¼€çœ‹çœ‹å§",H()}catch(a){M.value=`è´­ä¹°å¤±è´¥: ${a.message}`}}},R=async()=>{if(L.value){M.value="å¼€å¥–ä¸­...";try{const a=await P(L.value);A.value=!0,B.value=a.prize,F.value=a.tier||0,a.isWinner?(M.value=`æ­å–œä¸­å¥– ${S(a.prize)}ï¼`,O.value=!0):M.value="è°¢è°¢å‚ä¸Žï¼Œå†æŽ¥å†åŽ‰ï¼"}catch(a){M.value=`å¼€å¥–å¤±è´¥: ${a.message}`}}};let W=null;const H=()=>{W=h("scratchCanvas"),W.setFillStyle("#C0C0C0"),W.fillRect(0,0,300,200),W.draw()},J=a=>{$.value&&A.value},K=async a=>{if(!W||!$.value||A.value)return;const e=a.touches[0];W.globalCompositeOperation="destination-out",W.beginPath(),W.arc(e.x,e.y,20,0,2*Math.PI),W.fill(),W.draw(!0),G.value+=1,G.value>50&&L.value&&await R()},N=()=>{};return k(()=>{o.ticketId&&($.value=!0,H())}),(a,e)=>{const o=f,y=u,m=b,k=_;return t(),l(w,{title:"åˆ®å¥–",class:"theme-chinese-lucky"},{default:i(()=>[c(y,{class:"scratch-play"},{default:i(()=>[q.value?(t(),l(y,{key:0,class:"lottery-info"},{default:i(()=>[c(o,{class:"lottery-name"},{default:i(()=>[d(p(q.value.name),1)]),_:1}),c(o,{class:"lottery-price"},{default:i(()=>[d(p(q.value.priceDisplay),1)]),_:1})]),_:1})):s("",!0),c(y,{class:"scratch-area"},{default:i(()=>[c(m,{"canvas-id":"scratchCanvas",class:"scratch-canvas",onTouchstart:J,onTouchmove:K,onTouchend:N}),c(y,{class:z(["prize-layer",{revealed:A.value}])},{default:i(()=>[B.value>0?(t(),l(o,{key:0,class:"prize-amount"},{default:i(()=>[d(" æ­å–œä¸­å¥– "+p(B.value)+" GAS ",1)]),_:1})):(t(),l(o,{key:1,class:"no-prize"},{default:i(()=>[d(" è°¢è°¢å‚ä¸Ž ")]),_:1}))]),_:1},8,["class"])]),_:1}),c(y,{class:"actions"},{default:i(()=>[c(k,{class:"btn-buy",onClick:E,disabled:C(x)||$.value},{default:i(()=>[d(p(C(x)?"å¤„ç†ä¸­...":"è´­ä¹°å½©ç¥¨"),1)]),_:1},8,["disabled"]),$.value&&!A.value?(t(),l(k,{key:0,class:"btn-reveal",onClick:R,disabled:C(x)},{default:i(()=>[d(" ä¸€é”®åˆ®å¼€ ")]),_:1},8,["disabled"])):s("",!0)]),_:1}),M.value?(t(),l(y,{key:1,class:"status-message"},{default:i(()=>[c(o,null,{default:i(()=>[d(p(M.value),1)]),_:1})]),_:1})):s("",!0),c(y,{class:"prize-tiers"},{default:i(()=>[c(o,{class:"tiers-title"},{default:i(()=>[d("å¥–é‡‘ç­‰çº§")]),_:1}),c(y,{class:"tier-list"},{default:i(()=>[(t(!0),r(v,null,n(C(T),a=>(t(),l(y,{key:a.tier,class:"tier-item"},{default:i(()=>[c(o,{class:"tier-label"},{default:i(()=>[d(p(a.label),1)]),_:2},1024),c(o,{class:"tier-odds"},{default:i(()=>[d(p(a.odds)+"%",1)]),_:2},1024),c(o,{class:"tier-prize"},{default:i(()=>[d(p(a.multiplier)+"x",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),c(D,{visible:O.value,prize:B.value,tier:F.value,onClose:e[0]||(e[0]=a=>O.value=!1)},null,8,["visible","prize","tier"])]),_:1})}}}),[["__scopeId","data-v-d7f67d6d"]]);export{j as default};
