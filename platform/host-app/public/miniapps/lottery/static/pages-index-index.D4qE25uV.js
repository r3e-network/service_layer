import{r as a,d as e,c as t,o as l,a as s,b as u,w as n,i as c,e as o,f as d,g as r,h as i,j as f,k as v,n as _,t as p,l as w,u as y,m,F as g,p as b}from"./index-GCE_LOMj.js";function k(a=5e3){return new Promise((e,t)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const l=setTimeout(()=>{t(new Error("SDK timeout"))},a),s=()=>{clearTimeout(l),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?e(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}const S="miniapp-lottery",h=((a,e)=>{const t=a.__vccOpts||a;for(const[l,s]of e)t[l]=s;return t})(e({__name:"index",setup(e){const{payGAS:h,isLoading:x}=function(e){const t=a(!1),l=a(null);return{isLoading:t,error:l,payGAS:async(a,s)=>{t.value=!0,l.value=null;try{const t=await k();return await t.payments.payGAS(e,a,s)}catch(u){throw l.value=u,u}finally{t.value=!1}}}}(S);!function(){const e=a(!1),t=a(null)}(S);const M=a(1),A=a("01:00"),D=a(1),K=a(0),P=a(0),T=a(0),E=a([]),G=a(null),L=a(Date.now()),$=t(()=>.1*M.value),C=(a,e=2)=>function(a,e=2){return a>=1e6?(a/1e6).toFixed(e)+"M":a>=1e3?(a/1e3).toFixed(e)+"K":a.toFixed(e)}(a,e),F=a=>{M.value=Math.max(1,Math.min(100,M.value+a))},z=async()=>{if(!x.value)try{G.value={msg:"Purchasing...",type:"loading"},await h(String($.value),`lottery:${D.value}:${M.value}`),G.value={msg:`Bought ${M.value} ticket(s)!`,type:"success"},P.value+=M.value,T.value+=M.value,K.value+=$.value}catch(a){G.value={msg:a.message||"Error",type:"error"}}};let B;return l(()=>{B=setInterval(()=>{const a=Date.now()-L.value,e=Math.max(0,6e4-a%6e4),t=Math.floor(e/6e4),l=Math.floor(e%6e4/1e3);A.value=`${String(t).padStart(2,"0")}:${String(l).padStart(2,"0")}`},1e3)}),s(()=>clearInterval(B)),(a,e)=>{const t=f,l=c,s=o("uni-easyinput");return d(),u(l,{class:"app-container"},{default:n(()=>[r(l,{class:"header"},{default:n(()=>[r(t,{class:"title"},{default:n(()=>[v("Neo Lottery")]),_:1}),r(t,{class:"subtitle"},{default:n(()=>[v("Provably fair draws")]),_:1})]),_:1}),G.value?(d(),u(l,{key:0,class:_(["status-msg",G.value.type])},{default:n(()=>[r(t,null,{default:n(()=>[v(p(G.value.msg),1)]),_:1})]),_:1},8,["class"])):i("",!0),r(l,{class:"card"},{default:n(()=>[r(t,{class:"countdown"},{default:n(()=>[v(p(A.value),1)]),_:1}),r(l,{class:"stats-grid"},{default:n(()=>[r(l,{class:"stat-box"},{default:n(()=>[r(t,{class:"stat-value"},{default:n(()=>[v("#"+p(D.value),1)]),_:1}),r(t,{class:"stat-label"},{default:n(()=>[v("Round")]),_:1})]),_:1}),r(l,{class:"stat-box"},{default:n(()=>[r(t,{class:"stat-value"},{default:n(()=>[v(p(C(K.value)),1)]),_:1}),r(t,{class:"stat-label"},{default:n(()=>[v("Prize Pool")]),_:1})]),_:1}),r(l,{class:"stat-box"},{default:n(()=>[r(t,{class:"stat-value"},{default:n(()=>[v(p(P.value),1)]),_:1}),r(t,{class:"stat-label"},{default:n(()=>[v("Total")]),_:1})]),_:1}),r(l,{class:"stat-box"},{default:n(()=>[r(t,{class:"stat-value"},{default:n(()=>[v(p(T.value),1)]),_:1}),r(t,{class:"stat-label"},{default:n(()=>[v("Yours")]),_:1})]),_:1})]),_:1})]),_:1}),r(l,{class:"card"},{default:n(()=>[r(t,{class:"card-title"},{default:n(()=>[v("Buy Tickets")]),_:1}),r(l,{class:"ticket-row"},{default:n(()=>[r(l,{class:"ticket-btn",onClick:e[0]||(e[0]=a=>F(-1))},{default:n(()=>[r(t,null,{default:n(()=>[v("-")]),_:1})]),_:1}),r(s,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),type:"number",class:"ticket-input"},null,8,["modelValue"]),r(l,{class:"ticket-btn",onClick:e[2]||(e[2]=a=>F(1))},{default:n(()=>[r(t,null,{default:n(()=>[v("+")]),_:1})]),_:1})]),_:1}),r(l,{class:"total-row"},{default:n(()=>[r(t,{class:"total-label"},{default:n(()=>[v("Total Cost")]),_:1}),r(t,{class:"total-value"},{default:n(()=>[v(p(C($.value,1))+" GAS",1)]),_:1})]),_:1}),r(l,{class:"buy-btn",onClick:z,style:w({opacity:y(x)?.6:1})},{default:n(()=>[r(t,null,{default:n(()=>[v(p(y(x)?"Processing...":"Buy Tickets"),1)]),_:1})]),_:1},8,["style"])]),_:1}),r(l,{class:"card"},{default:n(()=>[r(t,{class:"card-title"},{default:n(()=>[v("Recent Winners")]),_:1}),r(l,{class:"winners-list"},{default:n(()=>[0===E.value.length?(d(),u(t,{key:0,class:"empty"},{default:n(()=>[v("No winners yet")]),_:1})):i("",!0),(d(!0),m(g,null,b(E.value,(a,e)=>(d(),u(l,{key:e,class:"winner-item"},{default:n(()=>[r(t,{class:"winner-round"},{default:n(()=>[v("#"+p(a.round),1)]),_:2},1024),r(t,{class:"winner-addr"},{default:n(()=>[v(p(a.address.slice(0,8))+"...",1)]),_:2},1024),r(t,{class:"winner-prize"},{default:n(()=>[v(p(C(a.prize))+" GAS",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-dc06a428"]]);export{h as default};
