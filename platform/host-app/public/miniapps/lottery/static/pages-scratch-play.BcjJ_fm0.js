import{d as e,x as a,c as t,h as l,e as s,g as c,w as i,j as r,v as u,z as n,q as o,l as d,F as v,k as f,t as y,u as p,i as _,B as h,r as m,o as k,C as g,p as z,n as b}from"./index-BD0NlBWI.js";import{u as C,a as T,A as I,P as w}from"./useScratchCard.BeUSGPCz.js";import{u as P,_ as F}from"./useI18n.lseyrGOK.js";const S=F(e({__name:"ChineseLuckyOverlay",props:{visible:{type:Boolean},prize:{},tier:{}},emits:["close"],setup(e,{emit:m}){const k=e,g=m,{t:z}=P(),b=a(()=>{const e={1:"tierConsolation",2:"tierFifth",3:"tierFourth",4:"tierThird",5:"tierSpecial"}[k.tier];return e?z(e):""}),C=()=>g("close"),T=e=>({left:5*e%100+"%",animationDelay:.1*e+"s",animationDuration:`${1.5+Math.random()}s`}),I=e=>({left:3.3*e%100+"%",backgroundColor:e%2==0?"var(--lucky-red)":"var(--lucky-gold)",animationDelay:.05*e+"s"});return(e,a)=>{const m=c,k=f,g=_;return e.visible?(s(),t(m,{key:0,class:"lucky-overlay",onClick:C},{default:i(()=>[r(m,{class:"coins-container"},{default:i(()=>[(s(),u(v,null,n(20,e=>r(m,{key:e,class:"coin",style:o(T(e))},{default:i(()=>[d("ðŸª™")]),_:2},1032,["style"])),64))]),_:1}),r(m,{class:"prize-card",onClick:a[0]||(a[0]=h(()=>{},["stop"]))},{default:i(()=>[r(m,{class:"prize-header"},{default:i(()=>[r(k,{class:"congrats"},{default:i(()=>[d(y(p(z)("scratchCongrats")),1)]),_:1})]),_:1}),r(m,{class:"prize-amount"},{default:i(()=>[r(k,{class:"amount"},{default:i(()=>[d(y(e.prize),1)]),_:1}),r(k,{class:"unit"},{default:i(()=>[d("GAS")]),_:1})]),_:1}),r(m,{class:"prize-tier"},{default:i(()=>[r(k,null,{default:i(()=>[d(y(b.value),1)]),_:1})]),_:1}),r(g,{class:"btn-claim",onClick:C},{default:i(()=>[d(y(p(z)("scratchClaim")),1)]),_:1})]),_:1}),r(m,{class:"confetti-container"},{default:i(()=>[(s(),u(v,null,n(30,e=>r(m,{key:"c"+e,class:"confetti",style:o(I(e))},null,8,["style"])),64))]),_:1})]),_:1})):l("",!0)}}}),[["__scopeId","data-v-a9585456"]]),x=F(e({__name:"play",props:{type:{},ticketId:{}},setup(e){const o=e,{t:h}=P(),{getLotteryType:F}=C(),{isLoading:x,buyTicket:B,revealTicket:j,formatPrize:A,getPrizeTierLabel:D}=T(),L=m(!1),R=m(!1),W=m(0),M=m(0),O=m(null),q=m(0),E=m(""),G=m(!1),N=a(()=>{const e=parseInt(o.type||"0");return F(e)}),V=async()=>{if(N.value){E.value=h("scratchBuying");try{const e=await B(N.value.type);O.value=e.ticketId,L.value=!0,E.value=h("scratchBought"),J()}catch(e){E.value=h("scratchBuyFailed",{error:e.message})}}},$=async()=>{if(O.value){E.value=h("scratchRevealing");try{const e=await j(O.value);R.value=!0,W.value=e.prize,M.value=e.tier||0,e.isWinner?(E.value=h("scratchWinStatus",{amount:A(e.prize)}),G.value=!0):E.value=h("scratchTryAgain")}catch(e){E.value=h("scratchRevealFailed",{error:e.message})}}};let H=null;const J=()=>{H=g("scratchCanvas"),H.setFillStyle("undefined"==typeof window||"undefined"==typeof document?"#c0c0c0":getComputedStyle(document.documentElement).getPropertyValue("--lucky-scratch-coating").trim()||"#c0c0c0"),H.fillRect(0,0,300,200),H.draw()},K=e=>{L.value&&R.value},Q=async e=>{if(!H||!L.value||R.value)return;const a=e.touches[0];H.globalCompositeOperation="destination-out",H.beginPath(),H.arc(a.x,a.y,20,0,2*Math.PI),H.fill(),H.draw(!0),q.value+=1,q.value>50&&O.value&&await $()},U=()=>{};return k(()=>{o.ticketId&&(L.value=!0,J())}),(e,a)=>{const o=f,m=c,k=z,g=_;return s(),t(I,{title:p(h)("scratchPlayTitle"),class:"theme-chinese-lucky"},{default:i(()=>[r(m,{class:"scratch-play"},{default:i(()=>[N.value?(s(),t(m,{key:0,class:"lottery-info"},{default:i(()=>[r(o,{class:"lottery-name"},{default:i(()=>[d(y(N.value.name),1)]),_:1}),r(o,{class:"lottery-price"},{default:i(()=>[d(y(N.value.priceDisplay),1)]),_:1})]),_:1})):l("",!0),r(m,{class:"scratch-area"},{default:i(()=>[r(k,{"canvas-id":"scratchCanvas",class:"scratch-canvas",onTouchstart:K,onTouchmove:Q,onTouchend:U}),r(m,{class:b(["prize-layer",{revealed:R.value}])},{default:i(()=>[W.value>0?(s(),t(o,{key:0,class:"prize-amount"},{default:i(()=>[d(y(p(h)("scratchWinInline",{amount:p(A)(W.value)})),1)]),_:1})):(s(),t(o,{key:1,class:"no-prize"},{default:i(()=>[d(y(p(h)("scratchNoPrize")),1)]),_:1}))]),_:1},8,["class"])]),_:1}),r(m,{class:"actions"},{default:i(()=>[r(g,{class:"btn-buy",onClick:V,disabled:p(x)||L.value},{default:i(()=>[d(y(p(x)?p(h)("processing"):p(h)("buyTicket")),1)]),_:1},8,["disabled"]),L.value&&!R.value?(s(),t(g,{key:0,class:"btn-reveal",onClick:$,disabled:p(x)},{default:i(()=>[d(y(p(h)("scratchRevealAll")),1)]),_:1},8,["disabled"])):l("",!0)]),_:1}),E.value?(s(),t(m,{key:1,class:"status-message"},{default:i(()=>[r(o,null,{default:i(()=>[d(y(E.value),1)]),_:1})]),_:1})):l("",!0),r(m,{class:"prize-tiers"},{default:i(()=>[r(o,{class:"tiers-title"},{default:i(()=>[d(y(p(h)("prizeTiers")),1)]),_:1}),r(m,{class:"tier-list"},{default:i(()=>[(s(!0),u(v,null,n(p(w),e=>(s(),t(m,{key:e.tier,class:"tier-item"},{default:i(()=>[r(o,{class:"tier-label"},{default:i(()=>[d(y(p(D)(e.tier)),1)]),_:2},1024),r(o,{class:"tier-odds"},{default:i(()=>[d(y(e.odds)+"%",1)]),_:2},1024),r(o,{class:"tier-prize"},{default:i(()=>[d(y(e.multiplier)+"x",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),r(S,{visible:G.value,prize:W.value,tier:M.value,onClose:a[0]||(a[0]=e=>G.value=!1)},null,8,["visible","prize","tier"])]),_:1},8,["title"])}}}),[["__scopeId","data-v-3c39e3dd"]]);export{x as default};
