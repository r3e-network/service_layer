import{r as a,d as e,c as t,w as s,i as l,o as u,a as r,b as n,e as c,f as i,n as o,t as d,u as v}from"./index-0m3aRMLM.js";function f(a=5e3){return new Promise((e,t)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const s=setTimeout(()=>{t(new Error("SDK timeout"))},a),l=()=>{clearTimeout(s),window.removeEventListener("miniapp-sdk-ready",l),window.MiniAppSDK?e(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",l)})}const p="miniapp-scratchcard",y=((a,e)=>{const t=a.__vccOpts||a;for(const[s,l]of e)t[s]=l;return t})(e({__name:"index",setup(e){const{payGAS:y,isLoading:_}=function(e){const t=a(!1),s=a(null);return{isLoading:t,error:s,payGAS:async(a,l)=>{t.value=!0,s.value=null;try{const t=await f();return await t.payments.payGAS(e,a,l)}catch(u){throw s.value=u,u}finally{t.value=!1}}}}(p),{requestRandom:w}=function(e){const t=a(!1),s=a(null);return{isLoading:t,error:s,requestRandom:async()=>{t.value=!0,s.value=null;try{const a=await f();return await a.rng.requestRandom(e)}catch(a){throw s.value=a,a}finally{t.value=!1}}}}(p),m=a(!1),S=a(!1),h=a(0),g=a(0),A=a(0),k=a(null),b=async()=>{if(!_.value)try{await y("1","scratchcard:buy"),m.value=!0,S.value=!1,h.value=0,k.value={msg:"Card purchased!",type:"success"}}catch(a){k.value={msg:a.message||"Error",type:"error"}}},D=async()=>{if(m.value&&!S.value)try{const a=await w(),e=parseInt(a.randomness.slice(0,4),16)%100;h.value=e<5?10:e<20?2:e<40?1:0,S.value=!0,g.value++,h.value>0&&(A.value+=h.value),m.value=!1}catch(a){k.value={msg:a.message||"Error",type:"error"}}};return(a,e)=>{const f=c,p=l;return u(),t(p,{class:"app-container"},{default:s(()=>[r(p,{class:"header"},{default:s(()=>[r(f,{class:"title"},{default:s(()=>[i("Scratch Card")]),_:1}),r(f,{class:"subtitle"},{default:s(()=>[i("Instant win prizes")]),_:1})]),_:1}),k.value?(u(),t(p,{key:0,class:o(["status-msg",k.value.type])},{default:s(()=>[r(f,null,{default:s(()=>[i(d(k.value.msg),1)]),_:1})]),_:1},8,["class"])):n("",!0),r(p,{class:"card"},{default:s(()=>[r(p,{class:"scratch-area",onClick:D},{default:s(()=>[S.value?(u(),t(f,{key:1,class:"prize-text"},{default:s(()=>[i(d(h.value>0?`ðŸŽ‰ ${h.value} GAS!`:"ðŸ˜¢ No Win"),1)]),_:1})):(u(),t(f,{key:0,class:"scratch-text"},{default:s(()=>[i("ðŸŽ« Tap to Scratch")]),_:1}))]),_:1}),S.value||!m.value?(u(),t(p,{key:0,class:"buy-btn",onClick:b},{default:s(()=>[r(f,null,{default:s(()=>[i(d(v(_)?"Buying...":"Buy Card (1 GAS)"),1)]),_:1})]),_:1})):n("",!0)]),_:1}),r(p,{class:"card"},{default:s(()=>[r(f,{class:"card-title"},{default:s(()=>[i("Your Stats")]),_:1}),r(p,{class:"stats-row"},{default:s(()=>[r(p,{class:"stat"},{default:s(()=>[r(f,{class:"stat-value"},{default:s(()=>[i(d(g.value),1)]),_:1}),r(f,{class:"stat-label"},{default:s(()=>[i("Scratched")]),_:1})]),_:1}),r(p,{class:"stat"},{default:s(()=>[r(f,{class:"stat-value"},{default:s(()=>[i(d(A.value),1)]),_:1}),r(f,{class:"stat-label"},{default:s(()=>[i("Won (GAS)")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-0c75f699"]]);export{y as default};
