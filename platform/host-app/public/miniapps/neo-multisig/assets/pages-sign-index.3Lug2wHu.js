import{z as a,A as e,O as s,B as t,d as l,r as i,c as u,a as n,w as d,i as r,b as c,e as o,q as v,f as g,l as f,h as _,t as p,u as b,n as h,C as y,D as m,j as k,F as w,k as x,E as S,v as C,g as K,x as N}from"./index-BexB3Vvo.js";import{u as T,_ as j}from"./Fireworks.vue_vue_type_style_index_0_scoped_c40424c2_lang.BXY8EL1u.js";import{N as B,a as F}from"./NeoCard.C-GbTsqI.js";import{u as M,a as z,d as E,g as I,T as O,e as L,h as P,j as R,k as J,l as U}from"./multisig.AJIWypmK.js";import"minimalistic-assert";import"minimalistic-crypto-utils";import"brorand";import"inherits";import"hash.js";import"hmac-drbg";const q=(s=>(l,i=a())=>{!t&&e(s,l,i)})(s),A=j(l({__name:"index",setup(a){const{t:e}=T(),{address:s,invoke:t}=M(),l=i(null),j=i(!0),A=i(""),D=i(!1),G=i("");q(a=>{a.id?H(a.id):(A.value=e("toastNoId"),j.value=!1)});const H=async a=>{var s;try{l.value=await z.get(a),G.value=(null==(s=l.value)?void 0:s.broadcast_txid)||""}catch(t){console.error(t),A.value=e("toastLoadFailed")}finally{j.value=!1}},Q=u(()=>l.value?"neo-n3-testnet"===l.value.chain_id?e("chainTestnet"):e("chainMainnet"):""),V=u(()=>{if(!l.value)return[];try{const a=E(l.value.threshold,l.value.signers);return a.publicKeys.map(a=>({publicKey:a,address:I(a)}))}catch(a){return console.error(a),[]}}),W=u(()=>{var a;return Object.keys((null==(a=l.value)?void 0:a.signatures)||{}).length}),X=u(()=>l.value?Math.min(100,W.value/l.value.threshold*100):0),Y=u(()=>{var a;return W.value>=((null==(a=l.value)?void 0:a.threshold)||1)}),Z=u(()=>{var a;if(!l.value||!(null==s?void 0:s.value))return!1;const e=V.value.find(a=>a.address===s.value);return!!e&&!!(null==(a=l.value.signatures)?void 0:a[e.publicKey])}),$=()=>f({url:"/pages/index/index"}),aa=a=>{var e,s;return!!(null==(s=null==(e=l.value)?void 0:e.signatures)?void 0:s[a])},ea=a=>a?a.slice(0,6)+"..."+a.slice(-4):"",sa=a=>{S({data:a}),C({title:e("copied"),icon:"none"})},ta=a=>{switch(a){case"pending":return e("statusPending");case"ready":return e("statusReady");case"broadcasted":return e("statusBroadcasted");case"cancelled":return e("statusCancelled");case"expired":return e("statusExpired");default:return e("statusUnknown")}},la=async()=>{if(l.value){D.value=!0;try{const a=O.deserialize(l.value.transaction_hex),s=L(l.value.chain_id),i=a.getMessageForSigning(s),u=await t("wallet.signMessage",{message:i});if(!u||!u.publicKey||!u.data)return void C({title:e("toastSignFailed"),icon:"none"});const n=P(u.publicKey),d=String(u.data||"").replace(/^0x/i,"").toLowerCase();if(!l.value.signers.includes(n))return void C({title:e("toastNotSigner"),icon:"none"});if(!R(i,d,n))return void C({title:e("toastSignatureInvalid"),icon:"none"});const r=await z.addSignature(l.value.id,n,d);l.value=r,C({title:e("toastSignSuccess"),icon:"success"})}catch(a){console.error(a),C({title:e("toastSignFailed"),icon:"none"})}finally{D.value=!1}}},ia=async()=>{if(l.value){D.value=!0;try{if(!Y.value)return void C({title:e("toastNotEnoughSignatures"),icon:"none"});const a=O.deserialize(l.value.transaction_hex),s=J(l.value.chain_id);if(await s.getBlockCount()>=a.validUntilBlock)return await z.updateStatus(l.value.id,"expired"),l.value.status="expired",void C({title:e("toastExpired"),icon:"none"});const t=E(l.value.threshold,l.value.signers),i=t.publicKeys.map(a=>{var e,s;return null==(s=null==(e=l.value)?void 0:e.signatures)?void 0:s[a]}).filter(a=>!!a);if(i.length<l.value.threshold)return void C({title:e("toastNotEnoughSignatures"),icon:"none"});const u=U(t.script,i.slice(0,l.value.threshold));a.witnesses=[u];const n=await s.sendRawTransaction(a),d="string"==typeof n?n:a.hash();G.value=d;const r=await z.updateStatus(l.value.id,"broadcasted",d);l.value=r;const c=K("multisig_history")?JSON.parse(K("multisig_history")):[],o=c.findIndex(a=>{var e;return a.id===(null==(e=l.value)?void 0:e.id)});o>=0&&(c[o].status="broadcasted",N("multisig_history",JSON.stringify(c))),C({title:e("toastBroadcastSuccess"),icon:"success"})}catch(a){console.error(a),C({title:e("toastBroadcastFailed"),icon:"none"})}finally{D.value=!1}}};return(a,s)=>{const t=g,i=r,u=m;return c(),n(i,{class:"page-container"},{default:d(()=>[o(i,{class:"nav-header"},{default:d(()=>[o(t,{class:"back-btn",onClick:$},{default:d(()=>[_("â†")]),_:1}),o(i,{class:"nav-text"},{default:d(()=>[o(t,{class:"title"},{default:d(()=>[_(p(b(e)("signTitle")),1)]),_:1}),o(t,{class:"subtitle"},{default:d(()=>[_(p(b(e)("appSubtitle")),1)]),_:1})]),_:1})]),_:1}),j.value?(c(),n(i,{key:0,class:"loading"},{default:d(()=>[_(p(b(e)("loading")),1)]),_:1})):A.value?(c(),n(i,{key:1,class:"error"},{default:d(()=>[_(p(A.value),1)]),_:1})):l.value?(c(),n(i,{key:2,class:"content"},{default:d(()=>[o(b(B),{class:"status-card"},{default:d(()=>[o(i,{class:"status-row"},{default:d(()=>[o(t,{class:"status-label"},{default:d(()=>[_(p(b(e)("statusLabel")),1)]),_:1}),o(t,{class:h(["status-val",l.value.status])},{default:d(()=>[_(p(ta(l.value.status)),1)]),_:1},8,["class"])]),_:1}),o(i,{class:"progress-bar"},{default:d(()=>[o(i,{class:"progress-fill",style:y({width:X.value+"%"})},null,8,["style"])]),_:1}),o(t,{class:"progress-text"},{default:d(()=>[_(p(b(e)("signatureProgress",{count:W.value,total:l.value.threshold})),1)]),_:1})]),_:1}),o(b(B),{class:"details-card"},{default:d(()=>[o(t,{class:"card-title"},{default:d(()=>[_(p(b(e)("detailsTitle")),1)]),_:1}),o(i,{class:"detail-row"},{default:d(()=>[o(t,{class:"label"},{default:d(()=>[_(p(b(e)("detailId")),1)]),_:1}),o(t,{class:"value copy",onClick:s[0]||(s[0]=a=>sa(l.value.id))},{default:d(()=>[_(p(l.value.id)+" ("+p(b(e)("copy"))+")",1)]),_:1})]),_:1}),o(i,{class:"detail-row"},{default:d(()=>[o(t,{class:"label"},{default:d(()=>[_(p(b(e)("detailMemo")),1)]),_:1}),o(t,{class:"value"},{default:d(()=>[_(p(l.value.memo||b(e)("detailMemoNone")),1)]),_:1})]),_:1}),o(i,{class:"detail-row"},{default:d(()=>[o(t,{class:"label"},{default:d(()=>[_(p(b(e)("detailChain")),1)]),_:1}),o(t,{class:"value"},{default:d(()=>[_(p(Q.value),1)]),_:1})]),_:1}),o(i,{class:"raw-data"},{default:d(()=>[o(t,{class:"label"},{default:d(()=>[_(p(b(e)("detailRawTx")),1)]),_:1}),o(u,{class:"raw-input",value:l.value.transaction_hex,disabled:""},null,8,["value"])]),_:1})]),_:1}),o(b(B),{class:"signers-card"},{default:d(()=>[o(t,{class:"card-title"},{default:d(()=>[_(p(b(e)("signersTitle")),1)]),_:1}),o(i,{class:"signer-list"},{default:d(()=>[(c(!0),k(w,null,x(V.value,a=>(c(),n(i,{key:a.publicKey,class:"signer-row"},{default:d(()=>[o(i,{class:"signer-info"},{default:d(()=>[o(t,{class:"signer-key"},{default:d(()=>[_(p(ea(a.publicKey)),1)]),_:2},1024),o(t,{class:"signer-address"},{default:d(()=>[_(p(ea(a.address)),1)]),_:2},1024),aa(a.publicKey)?(c(),n(t,{key:0,class:"badge signed"},{default:d(()=>[_(p(b(e)("badgeSigned")),1)]),_:1})):(c(),n(t,{key:1,class:"badge pending"},{default:d(()=>[_(p(b(e)("badgePending")),1)]),_:1}))]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(i,{class:"actions"},{default:d(()=>[Y.value||Z.value?v("",!0):(c(),n(b(F),{key:0,variant:"primary",size:"lg",block:"",onClick:la,disabled:D.value},{default:d(()=>[_(p(D.value?b(e)("buttonSigning"):b(e)("buttonSign")),1)]),_:1},8,["disabled"])),Y.value&&"broadcasted"!==l.value.status?(c(),n(b(F),{key:1,variant:"success",size:"lg",block:"",onClick:ia,disabled:D.value},{default:d(()=>[_(p(D.value?b(e)("buttonBroadcasting"):b(e)("buttonBroadcast")),1)]),_:1},8,["disabled"])):v("",!0),G.value?(c(),n(i,{key:2,class:"broadcast-success"},{default:d(()=>[o(t,{class:"success-text"},{default:d(()=>[_(p(b(e)("broadcastedTitle")),1)]),_:1}),o(t,{class:"tx-id",onClick:s[1]||(s[1]=a=>sa(G.value))},{default:d(()=>[_(p(b(e)("broadcastedTxid"))+": "+p(G.value),1)]),_:1})]),_:1})):v("",!0)]),_:1})]),_:1})):v("",!0)]),_:1})}}}),[["__scopeId","data-v-2c648abb"]]);export{A as default};
