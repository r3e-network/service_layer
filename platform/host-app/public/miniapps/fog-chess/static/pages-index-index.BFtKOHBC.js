import{r as e,d as a,c as l,w as s,i as t,o as u,a as c,b as o,e as i,f as n,n as r,t as d,g as v,F as f,h as p,j as _,u as m}from"./index-BMfusCxO.js";function w(a){const l=e(!1),s=e(null);return{isLoading:l,error:s,payGAS:async(e,t)=>{l.value=!0,s.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const s=setTimeout(()=>{l(new Error("SDK timeout"))},e),t=()=>{clearTimeout(s),window.removeEventListener("miniapp-sdk-ready",t),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",t)})}();return await l.payments.payGAS(a,e,t)}catch(u){throw s.value=u,u}finally{l.value=!1}}}}const y=((e,a)=>{const l=e.__vccOpts||e;for(const[s,t]of a)l[s]=t;return l})(a({__name:"index",setup(a){const{payGAS:y,isLoading:h}=w("miniapp-fog-chess"),g=e("white"),b=e(0),k=e("1.0"),S=e(null),M=e([]),C=e(null),A=()=>{const e=[];for(let a=0;a<8;a++){const l=[];for(let e=0;e<8;e++){const s=a>=6||a<=1;let t="";1===a&&(t="♟"),6===a&&(t="♙"),0===a&&(0!==e&&7!==e||(t="♜"),1!==e&&6!==e||(t="♞"),2!==e&&5!==e||(t="♝"),3===e&&(t="♛"),4===e&&(t="♚")),7===a&&(0!==e&&7!==e||(t="♖"),1!==e&&6!==e||(t="♘"),2!==e&&5!==e||(t="♗"),3===e&&(t="♕"),4===e&&(t="♔")),l.push({piece:t,visible:s,selected:!1})}e.push(l)}return e},D=e(A()),x=(e,a)=>{for(let l=Math.max(0,e-1);l<=Math.min(7,e+1);l++)for(let e=Math.max(0,a-1);e<=Math.min(7,a+1);e++)D.value[l][e].visible=!0},G=async()=>{if(!h.value)try{S.value={msg:"Starting new game...",type:"loading"},await y(k.value,`fogchess:new:${Date.now()}`),D.value=A(),M.value=[],b.value=0,g.value="white",C.value=null,S.value={msg:"New game started!",type:"success"}}catch(e){S.value={msg:e.message||"Error starting game",type:"error"}}},K=()=>{S.value={msg:"Standard chess rules apply. You can only see squares near your pieces!",type:"success"}};return(e,a)=>{const w=i,y=t;return u(),l(y,{class:"app-container"},{default:s(()=>[c(y,{class:"header"},{default:s(()=>[c(w,{class:"title"},{default:s(()=>[n("Fog Chess")]),_:1}),c(w,{class:"subtitle"},{default:s(()=>[n("Hidden chess game")]),_:1})]),_:1}),S.value?(u(),l(y,{key:0,class:r(["status-msg",S.value.type])},{default:s(()=>[c(w,null,{default:s(()=>[n(d(S.value.msg),1)]),_:1})]),_:1},8,["class"])):o("",!0),c(y,{class:"card game-info"},{default:s(()=>[c(y,{class:"info-row"},{default:s(()=>[c(w,{class:"info-label"},{default:s(()=>[n("Turn")]),_:1}),c(w,{class:r(["info-value",g.value])},{default:s(()=>[n(d("white"===g.value?"White":"Black"),1)]),_:1},8,["class"])]),_:1}),c(y,{class:"info-row"},{default:s(()=>[c(w,{class:"info-label"},{default:s(()=>[n("Move")]),_:1}),c(w,{class:"info-value"},{default:s(()=>[n(d(b.value),1)]),_:1})]),_:1}),c(y,{class:"info-row"},{default:s(()=>[c(w,{class:"info-label"},{default:s(()=>[n("Stake")]),_:1}),c(w,{class:"info-value"},{default:s(()=>[n(d(k.value)+" GAS",1)]),_:1})]),_:1})]),_:1}),c(y,{class:"card board-card"},{default:s(()=>[c(y,{class:"chessboard"},{default:s(()=>[(u(!0),v(f,null,p(D.value,(e,a)=>(u(),l(y,{key:a,class:"board-row"},{default:s(()=>[(u(!0),v(f,null,p(e,(e,t)=>(u(),l(y,{key:t,class:r(["board-cell",(a+t)%2==0?"light":"dark",e.selected?"selected":"",e.visible?"":"fog"]),onClick:e=>((e,a)=>{if(D.value[e][a].visible)if(C.value){if(D.value[C.value.row][C.value.col].selected=!1,C.value.row!==e||C.value.col!==a){const l=D.value[C.value.row][C.value.col].piece;D.value[e][a].piece=l,D.value[C.value.row][C.value.col].piece="",x(e,a);const s=`${String.fromCharCode(97+C.value.col)}${8-C.value.row} → ${String.fromCharCode(97+a)}${8-e}`;M.value.unshift(s),M.value=M.value.slice(0,10),b.value++,g.value="white"===g.value?"black":"white",S.value={msg:"Move made!",type:"success"}}C.value=null}else D.value[e][a].piece&&(D.value[e][a].selected=!0,C.value={row:e,col:a});else S.value={msg:"Cannot see this square!",type:"error"}})(a,t)},{default:s(()=>[e.visible&&e.piece?(u(),l(w,{key:0,class:"piece"},{default:s(()=>[n(d(e.piece),1)]),_:2},1024)):o("",!0),e.visible?o("",!0):(u(),l(w,{key:1,class:"fog-icon"},{default:s(()=>[n("?")]),_:1}))]),_:2},1032,["class","onClick"]))),128))]),_:2},1024))),128))]),_:1})]),_:1}),c(y,{class:"card"},{default:s(()=>[c(w,{class:"card-title"},{default:s(()=>[n("Game Actions")]),_:1}),c(y,{class:"action-row"},{default:s(()=>[c(y,{class:"action-btn secondary",onClick:K},{default:s(()=>[c(w,null,{default:s(()=>[n("Rules")]),_:1})]),_:1}),c(y,{class:"action-btn",onClick:G,style:_({opacity:m(h)?.6:1})},{default:s(()=>[c(w,null,{default:s(()=>[n(d(m(h)?"Starting...":"New Game"),1)]),_:1})]),_:1},8,["style"])]),_:1})]),_:1}),c(y,{class:"card"},{default:s(()=>[c(w,{class:"card-title"},{default:s(()=>[n("Move History")]),_:1}),c(y,{class:"history-list"},{default:s(()=>[0===M.value.length?(u(),l(w,{key:0,class:"empty"},{default:s(()=>[n("No moves yet")]),_:1})):o("",!0),(u(!0),v(f,null,p(M.value,(e,a)=>(u(),l(y,{key:a,class:"history-item"},{default:s(()=>[c(w,{class:"move-number"},{default:s(()=>[n(d(a+1)+".",1)]),_:2},1024),c(w,{class:"move-text"},{default:s(()=>[n(d(e),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-7198e033"]]);export{y as default};
