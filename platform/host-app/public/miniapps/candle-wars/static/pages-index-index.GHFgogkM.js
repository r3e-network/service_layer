import{r as a,d as e,c as l,o as t,a as s,w as u,i as n,b as r,e as c,f as i,g as d,h as o,j as p,n as v,t as f,k as _,F as y,l as m,m as w}from"./index-O-KMB7se.js";function h(a=5e3){return new Promise((e,l)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},a),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?e(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}const g="miniapp-candlewars",b=((a,e)=>{const l=a.__vccOpts||a;for(const[t,s]of e)l[t]=s;return l})(e({__name:"index",setup(e){const{payGAS:b}=function(e){const l=a(!1),t=a(null);return{isLoading:l,error:t,payGAS:async(a,s)=>{l.value=!0,t.value=null;try{const l=await h();return await l.payments.payGAS(e,a,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}(g),{requestRandom:S}=function(e){const l=a(!1),t=a(null);return{isLoading:l,error:t,requestRandom:async()=>{l.value=!0,t.value=null;try{const a=await h();return await a.rng.requestRandom(e)}catch(a){throw t.value=a,a}finally{l.value=!1}}}}(g),M=a("1"),A=a("up"),k=a(42350),P=a(2.5),D=a(0),C=a(0),F=a(!1),G=a(null),K=a([{type:"up",height:60},{type:"down",height:40},{type:"up",height:70},{type:"up",height:80},{type:"down",height:50},{type:"up",height:65}]),x=l(()=>D.value>0?Math.round(C.value/D.value*100):0),E=async()=>{if(F.value)return;const a=parseFloat(M.value);if(a<.1)G.value={msg:"Min bet: 0.1 GAS",type:"error"};else{F.value=!0;try{await b(M.value,`candle:${A.value}`);const e=await S(),l=parseInt(e.randomness.slice(0,2),16)%2==0,t=l&&"up"===A.value||!l&&"down"===A.value;D.value++,t?(C.value++,G.value={msg:`Correct! Won ${1.8*a} GAS`,type:"success"}):G.value={msg:"Wrong prediction",type:"error"};const s=(5*Math.random()-2.5).toFixed(2);P.value=parseFloat(s),k.value=Math.round(k.value*(1+P.value/100))}catch(e){G.value={msg:e.message||"Error",type:"error"}}finally{F.value=!1}}};return t(()=>{setInterval(()=>{const a=(2*Math.random()-1).toFixed(2);P.value=parseFloat(a),k.value=Math.round(k.value*(1+P.value/100))},3e3)}),(a,e)=>{const l=o,t=n,h=r("uni-easyinput");return c(),s(t,{class:"app-container"},{default:u(()=>[i(t,{class:"header"},{default:u(()=>[i(l,{class:"title"},{default:u(()=>[p("Candle Wars")]),_:1}),i(l,{class:"subtitle"},{default:u(()=>[p("Price prediction battles")]),_:1})]),_:1}),G.value?(c(),s(t,{key:0,class:v(["status-msg",G.value.type])},{default:u(()=>[i(l,null,{default:u(()=>[p(f(G.value.msg),1)]),_:1})]),_:1},8,["class"])):d("",!0),i(t,{class:"card"},{default:u(()=>[i(l,{class:"card-title"},{default:u(()=>[p("Current Price")]),_:1}),i(t,{class:"price-display"},{default:u(()=>[i(l,{class:"price-value"},{default:u(()=>[p("$"+f(k.value),1)]),_:1}),i(l,{class:v(["price-change",P.value>=0?"up":"down"])},{default:u(()=>[p(f(P.value>=0?"â†‘":"â†“")+" "+f(Math.abs(P.value))+"% ",1)]),_:1},8,["class"])]),_:1}),i(t,{class:"candle-chart"},{default:u(()=>[(c(!0),_(y,null,m(K.value,(a,e)=>(c(),s(t,{key:e,class:v(["candle",a.type]),style:w({height:a.height+"%"})},null,8,["class","style"]))),128))]),_:1})]),_:1}),i(t,{class:"card"},{default:u(()=>[i(l,{class:"card-title"},{default:u(()=>[p("Place Prediction")]),_:1}),i(h,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=a=>M.value=a),type:"number",placeholder:"Bet amount (GAS)"},null,8,["modelValue"]),i(t,{class:"prediction-row"},{default:u(()=>[i(t,{class:v(["pred-btn","up","up"===A.value&&"active"]),onClick:e[1]||(e[1]=a=>A.value="up")},{default:u(()=>[i(l,null,{default:u(()=>[p("ðŸ“ˆ Price Up")]),_:1})]),_:1},8,["class"]),i(t,{class:v(["pred-btn","down","down"===A.value&&"active"]),onClick:e[2]||(e[2]=a=>A.value="down")},{default:u(()=>[i(l,null,{default:u(()=>[p("ðŸ“‰ Price Down")]),_:1})]),_:1},8,["class"])]),_:1}),i(t,{class:"submit-btn",onClick:E,style:w({opacity:F.value?.6:1})},{default:u(()=>[i(l,null,{default:u(()=>[p(f(F.value?"Submitting...":"Submit Prediction"),1)]),_:1})]),_:1},8,["style"])]),_:1}),i(t,{class:"card"},{default:u(()=>[i(l,{class:"card-title"},{default:u(()=>[p("Battle Stats")]),_:1}),i(t,{class:"stats-grid"},{default:u(()=>[i(t,{class:"stat"},{default:u(()=>[i(l,{class:"stat-value"},{default:u(()=>[p(f(D.value),1)]),_:1}),i(l,{class:"stat-label"},{default:u(()=>[p("Battles")]),_:1})]),_:1}),i(t,{class:"stat"},{default:u(()=>[i(l,{class:"stat-value"},{default:u(()=>[p(f(C.value),1)]),_:1}),i(l,{class:"stat-label"},{default:u(()=>[p("Wins")]),_:1})]),_:1}),i(t,{class:"stat"},{default:u(()=>[i(l,{class:"stat-value"},{default:u(()=>[p(f(x.value)+"%",1)]),_:1}),i(l,{class:"stat-label"},{default:u(()=>[p("Win Rate")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-e4e4ac17"]]);export{b as default};
