import{r as a,o as e,d as l,c as t,a as s,w as n,i as u,b as c,e as o,f as i,g as r,h as d,j as v,t as f,n as p,I as w,k as _}from"./index-8ogPTnk7.js";function y(){return window.MiniAppSDK??null}const b="https://api.neo-service-layer.io";function k(){const l=a(null),t=a({GAS:"0",NEO:"0"}),s=a(!1),n=a(!1),u=a(null);return e(()=>{const a=y();a&&a.wallet.getAddress().then(a=>{l.value=a,s.value=!0}).catch(()=>{})}),{address:l,balances:t,isConnected:s,isLoading:n,error:u,connect:async()=>{n.value=!0,u.value=null;try{const a=await function(a=5e3){return new Promise((e,l)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},a),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?e(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();l.value=await a.wallet.getAddress(),s.value=!0}catch(a){u.value=a}finally{n.value=!1}},invokeIntent:async a=>{var e;const l=y();if(!(null==(e=null==l?void 0:l.wallet)?void 0:e.invokeIntent))throw new Error("invokeIntent not available");return l.wallet.invokeIntent(a)},getBalance:async()=>{var a;n.value=!0,u.value=null;try{const e=await fetch(`${b}/wallet-balance`,{method:"GET",credentials:"include"});if(!e.ok){const l=await e.json();throw new Error((null==(a=l.error)?void 0:a.message)||"Failed to get balance")}const l=await e.json();return t.value=l.balances,l.balances}catch(e){throw u.value=e,e}finally{n.value=!1}},getTransactions:async(a=20)=>{var e;n.value=!0,u.value=null;try{const l=await fetch(`${b}/wallet-transactions?limit=${a}`,{method:"GET",credentials:"include"});if(!l.ok){const a=await l.json();throw new Error((null==(e=a.error)?void 0:e.message)||"Failed to get transactions")}return(await l.json()).transactions}catch(l){throw u.value=l,l}finally{n.value=!1}}}}const h="0x48c40d4666f93408be1bef038b6722404d9a4c2a",g=((a,e)=>{const l=a.__vccOpts||a;for(const[t,s]of e)l[t]=s;return l})(l({__name:"index",setup(l){const{getAddress:y,invokeContract:b,getBalance:g}=k(),m=a("stake"),E=a(""),N=a(""),O=a(0),A=a(0),S=a(!1),F=a(""),I=a("success"),x=a("5.2"),C=t(()=>{const a=parseFloat(E.value);return a>0&&a<=O.value}),D=t(()=>{const a=parseFloat(N.value);return a>0&&a<=A.value}),K=t(()=>(.99*(parseFloat(E.value)||0)).toFixed(2)),U=t(()=>(1.01*(parseFloat(N.value)||0)).toFixed(2));function j(a){return a.toFixed(2)}function B(a,e){F.value=a,I.value=e,setTimeout(()=>F.value="",5e3)}async function H(){try{if(!(await y()))return;const a=await g("NEO"),e=await g(h);O.value=a||0,A.value=e||0}catch(a){console.error("Failed to load balances:",a)}}async function T(){if(C.value&&!S.value){S.value=!0;try{const a=parseFloat(E.value);await b({scriptHash:h,operation:"transfer",args:[{type:"Hash160",value:await y()},{type:"Hash160",value:h},{type:"Integer",value:1e8*a},{type:"Any",value:null}]}),B(`Staked ${a} NEO successfully!`,"success"),E.value="",await H()}catch(a){B(a.message||"Stake failed","error")}finally{S.value=!1}}}async function V(){if(D.value&&!S.value){S.value=!0;try{const a=parseFloat(N.value);await b({scriptHash:h,operation:"transfer",args:[{type:"Hash160",value:await y()},{type:"Hash160",value:h},{type:"Integer",value:1e8*a},{type:"ByteArray",value:""}]}),B(`Unstaked ${a} bNEO successfully!`,"success"),N.value="",await H()}catch(a){B(a.message||"Unstake failed","error")}finally{S.value=!1}}}return e(()=>{H()}),(a,e)=>{const l=r,t=d,y=u,b=w,k=_;return c(),s(y,{class:"container"},{default:n(()=>[o(y,{class:"header"},{default:n(()=>[o(l,{class:"logo",src:"/static/logo.png",mode:"aspectFit"}),o(t,{class:"title"},{default:n(()=>[v("NeoBurger")]),_:1}),o(t,{class:"subtitle"},{default:n(()=>[v("Liquid Staking for NEO")]),_:1})]),_:1}),o(y,{class:"stats-row"},{default:n(()=>[o(y,{class:"stat-card"},{default:n(()=>[o(t,{class:"stat-label"},{default:n(()=>[v("Your bNEO")]),_:1}),o(t,{class:"stat-value"},{default:n(()=>[v(f(j(A.value)),1)]),_:1})]),_:1}),o(y,{class:"stat-card"},{default:n(()=>[o(t,{class:"stat-label"},{default:n(()=>[v("Your NEO")]),_:1}),o(t,{class:"stat-value"},{default:n(()=>[v(f(j(O.value)),1)]),_:1})]),_:1})]),_:1}),o(y,{class:"apy-card"},{default:n(()=>[o(t,{class:"apy-label"},{default:n(()=>[v("Current APY")]),_:1}),o(t,{class:"apy-value"},{default:n(()=>[v("~"+f(x.value)+"%",1)]),_:1})]),_:1}),o(y,{class:"tabs"},{default:n(()=>[o(y,{class:p(["tab",{active:"stake"===m.value}]),onClick:e[0]||(e[0]=a=>m.value="stake")},{default:n(()=>[o(t,null,{default:n(()=>[v("Stake")]),_:1})]),_:1},8,["class"]),o(y,{class:p(["tab",{active:"unstake"===m.value}]),onClick:e[1]||(e[1]=a=>m.value="unstake")},{default:n(()=>[o(t,null,{default:n(()=>[v("Unstake")]),_:1})]),_:1},8,["class"])]),_:1}),"stake"===m.value?(c(),s(y,{key:0,class:"panel"},{default:n(()=>[o(y,{class:"input-group"},{default:n(()=>[o(t,{class:"input-label"},{default:n(()=>[v("Amount to Stake")]),_:1}),o(y,{class:"input-row"},{default:n(()=>[o(b,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a),type:"digit",placeholder:"0",class:"amount-input"},null,8,["modelValue"]),o(t,{class:"token-label"},{default:n(()=>[v("NEO")]),_:1})]),_:1}),o(t,{class:"balance-hint"},{default:n(()=>[v("Balance: "+f(j(O.value))+" NEO",1)]),_:1})]),_:1}),o(y,{class:"receive-info"},{default:n(()=>[o(t,{class:"receive-label"},{default:n(()=>[v("You will receive")]),_:1}),o(t,{class:"receive-value"},{default:n(()=>[v("~"+f(K.value)+" bNEO",1)]),_:1})]),_:1}),o(k,{class:"action-btn stake-btn",disabled:!C.value||S.value,onClick:T},{default:n(()=>[o(t,null,{default:n(()=>[v(f(S.value?"Processing...":"Stake NEO"),1)]),_:1})]),_:1},8,["disabled"])]),_:1})):i("",!0),"unstake"===m.value?(c(),s(y,{key:1,class:"panel"},{default:n(()=>[o(y,{class:"input-group"},{default:n(()=>[o(t,{class:"input-label"},{default:n(()=>[v("Amount to Unstake")]),_:1}),o(y,{class:"input-row"},{default:n(()=>[o(b,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=a=>N.value=a),type:"digit",placeholder:"0",class:"amount-input"},null,8,["modelValue"]),o(t,{class:"token-label"},{default:n(()=>[v("bNEO")]),_:1})]),_:1}),o(t,{class:"balance-hint"},{default:n(()=>[v("Balance: "+f(j(A.value))+" bNEO",1)]),_:1})]),_:1}),o(y,{class:"receive-info"},{default:n(()=>[o(t,{class:"receive-label"},{default:n(()=>[v("You will receive")]),_:1}),o(t,{class:"receive-value"},{default:n(()=>[v("~"+f(U.value)+" NEO",1)]),_:1})]),_:1}),o(k,{class:"action-btn unstake-btn",disabled:!D.value||S.value,onClick:V},{default:n(()=>[o(t,null,{default:n(()=>[v(f(S.value?"Processing...":"Unstake bNEO"),1)]),_:1})]),_:1},8,["disabled"])]),_:1})):i("",!0),F.value?(c(),s(y,{key:2,class:p(["status",I.value])},{default:n(()=>[o(t,null,{default:n(()=>[v(f(F.value),1)]),_:1})]),_:1},8,["class"])):i("",!0)]),_:1})}}}),[["__scopeId","data-v-325568a3"]]);export{g as default};
