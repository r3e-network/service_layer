import{w as a,a as e,b as t,_ as s}from"./index.Dsfy8XQV.js";import{e as n,c as l,g as o,d as r,i,s as c,f as d,u}from"./index.Dsfy8XQV.js";import{r as v,o as p,d as f,c as h,a as g,e as m,f as w,w as _,k as y,i as S,l as M,m as b,t as k,j as x,z as D,A as C,n as I,B as L,g as A,F as E,h as T,p as K}from"./index-8Cx3z0zF.js";function j(a){const e=v(!1),t=v(null);return{isLoading:e,error:t,execute:async(...s)=>{e.value=!0,t.value=null;try{return await a(...s)}catch(n){throw t.value=n,n}finally{e.value=!1}}}}function F(e){const{isLoading:t,error:s,execute:n}=j(async(t,s)=>{const n=await a();return await n.payments.payGAS(e,t,s)});return{isLoading:t,error:s,payGAS:n}}function N(e){const t=j(async(t,s,n)=>{const l=await a();return await l.governance.vote(e,t,s,n)}),s=j(async()=>{const e=await a();return await e.governance.getCandidates()});return{isVoting:t.isLoading,voteError:t.error,vote:t.execute,isLoadingCandidates:s.isLoading,candidatesError:s.error,getCandidates:s.execute}}function P(e){const{isLoading:t,error:s,execute:n}=j(async()=>{const t=await a();return await t.rng.requestRandom(e)});return{isLoading:t,error:s,requestRandom:n}}function B(){const{isLoading:e,error:t,execute:s}=j(async e=>{const t=await a();return await t.datafeed.getPrice(e)});return{isLoading:e,error:t,getPrice:s}}function G(){const{isLoading:e,error:t,execute:s}=j(async(e={})=>{var t;const s=await a();if(!(null==(t=s.events)?void 0:t.list))throw new Error("events.list not available");return await s.events.list(e)});return{isLoading:e,error:t,list:s}}function V(){const a=j(async()=>t("/gas-sponsor-check")),s=j(async a=>e("/gas-sponsor-request",{amount:a}));return{isCheckingEligibility:a.isLoading,eligibilityError:a.error,checkEligibility:a.execute,isRequestingSponsorship:s.isLoading,sponsorshipError:s.error,requestSponsorship:s.execute}}function q(e={}){const{slot:t="default",autoLoad:s=!1}=e,n=v([]),l=v(null),o=v(!1),r=v(!1),i=v(!1),c=v(null),d=v(null),u=async e=>{var s;o.value=!0,c.value=null;try{const o=await a(),r=await o.wallet.getAddress(),i=(null==(s=o.getConfig)?void 0:s.call(o).appId)||"unknown",c=await fetch(`/api/miniapps/${i}/cloud-saves`,{headers:{"x-wallet-address":r}});if(!c.ok)throw new Error("Failed to load saves");const u=await c.json();n.value=u.saves||[];const v=e||t;return l.value=n.value.find(a=>a.slot_name===v)||null,d.value=new Date,l.value}catch(r){return c.value=r,null}finally{o.value=!1}};return p(()=>{s&&u()}),{saves:n,currentSave:l,isLoading:o,isSaving:r,isDeleting:i,error:c,lastSyncedAt:d,load:u,save:async(e,s)=>{var n;r.value=!0,c.value=null;try{const o=await a(),r=await o.wallet.getAddress(),i=(null==(n=o.getConfig)?void 0:n.call(o).appId)||"unknown",c=await fetch(`/api/miniapps/${i}/cloud-saves`,{method:"PUT",headers:{"Content-Type":"application/json","x-wallet-address":r},body:JSON.stringify({slot_name:s||t,save_data:e,client_timestamp:(new Date).toISOString()})});if(!c.ok)throw new Error("Failed to save");const u=await c.json();return l.value=u.save,d.value=new Date,!0}catch(o){return c.value=o,!1}finally{r.value=!1}},deleteSave:async e=>{var s,o;i.value=!0,c.value=null;try{const r=await a(),i=await r.wallet.getAddress(),c=(null==(s=r.getConfig)?void 0:s.call(r).appId)||"unknown";if(!(await fetch(`/api/miniapps/${c}/cloud-saves`,{method:"DELETE",headers:{"Content-Type":"application/json","x-wallet-address":i},body:JSON.stringify({slot_name:e||t})})).ok)throw new Error("Failed to delete");return n.value=n.value.filter(a=>a.slot_name!==(e||t)),(null==(o=l.value)?void 0:o.slot_name)===(e||t)&&(l.value=null),!0}catch(r){return c.value=r,!1}finally{i.value=!1}}}}const O=()=>`mock-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,U={invoke:async(a,...e)=>(console.log("[MockSDK] invoke:",a,e),{}),getConfig:()=>({appId:"mock-app",contractHash:null,debug:!0}),wallet:{getAddress:async()=>(console.log("[MockSDK] getAddress called"),"NXV7ZhHiyM1aHXwpVsRZC6BwNFP2jghXAq"),invokeIntent:async a=>(console.log("[MockSDK] invokeIntent:",a),{txid:O()})},payments:{payGAS:async(a,e,t)=>(console.log("[MockSDK] payGAS:",{appId:a,amount:e,memo:t}),await new Promise(a=>setTimeout(a,800)),{request_id:O(),user_id:"mock-user",intent:"payments",constraints:{settlement:"GAS_ONLY"},invocation:{contract:"0x0bb8f09e6d3611bc5c8adbd79ff8af1e34f73193",method:"transfer",args:[e,t]}})},governance:{vote:async(a,e,t,s)=>(console.log("[MockSDK] vote:",{appId:a,proposalId:e,amount:t,support:s}),await new Promise(a=>setTimeout(a,800)),{request_id:O(),user_id:"mock-user",intent:"governance",constraints:{governance:"BNEO_ONLY"},invocation:{contract:"0xc8f3bbe1c205c932aab00b28f7df99f9bc788a05",method:"vote",args:[e,t,s]}}),getCandidates:async()=>(console.log("[MockSDK] getCandidates called"),await new Promise(a=>setTimeout(a,500)),{candidates:[{address:"NNShaEBGVBfmGWzGs6W5sCneKPBwmCA3Br",publicKey:"02a1",name:"NeoEconoLabs",votes:"5000000",active:!0},{address:"NdUL5oDPD159KeFpD5A9zw5xNF1xLX6nLT",publicKey:"03b2",name:"COZ",votes:"4500000",active:!0},{address:"NKuyBkoGdZZSLyPbJEetheRhMjeznFZszf",publicKey:"02c3",name:"AxLabs",votes:"3200000",active:!0}],totalVotes:"12700000",blockHeight:1234567})},rng:{async requestRandom(a){console.log("[MockSDK] requestRandom:",a),await new Promise(a=>setTimeout(a,500));const e=Array.from({length:32},()=>Math.floor(256*Math.random()).toString(16).padStart(2,"0")).join("");return{request_id:O(),app_id:a,randomness:e}}},datafeed:{async getPrice(a){console.log("[MockSDK] getPrice:",a);return{feed_id:O(),pair:a,price:{"NEO-USD":"12.45","GAS-USD":"4.32","BTC-USD":"43250.00","ETH-USD":"2280.50"}[a]||"100.00",decimals:8,timestamp:(new Date).toISOString(),sources:["mock"]}}}};function R(){"undefined"!=typeof window&&(window.MiniAppSDK=U,console.log("[MockSDK] Installed on window.MiniAppSDK"),window.dispatchEvent(new Event("miniapp-sdk-ready")))}function $(){const a=Date.now()+36e5+72e5*Math.random();return{type:"live_countdown",refreshInterval:1,endTime:Math.floor(a/1e3),jackpot:(1e3+9e3*Math.random()).toFixed(2),ticketsSold:Math.floor(100+500*Math.random()),ticketPrice:"0.1"}}function z(){return{type:"live_multiplier",refreshInterval:.1,currentMultiplier:1+5*Math.random(),status:["waiting","running","crashed"][Math.floor(3*Math.random())],playersCount:Math.floor(10+50*Math.random()),totalBets:(100+900*Math.random()).toFixed(2)}}function H(){return{type:"live_canvas",refreshInterval:5,pixels:W(32,32),width:32,height:32,activeUsers:Math.floor(5+20*Math.random())}}function W(a,e){const t=["#10b981","#3b82f6","#ec4899","#f59e0b","#8b5cf6"];let s="";for(let n=0;n<a*e;n++)s+=t[Math.floor(Math.random()*t.length)].slice(1);return s}function Z(){return{type:"live_stats",refreshInterval:10,stats:[{label:"Available",value:String(Math.floor(5+20*Math.random())),icon:"ðŸ§§"},{label:"Total GAS",value:(50+200*Math.random()).toFixed(1),change:12.5},{label:"Claimed",value:String(Math.floor(100+500*Math.random()))}]}}function J(){const a=Math.floor(1e3+5e3*Math.random()),e=Math.floor(a*(.3+.5*Math.random()));return{type:"live_voting",refreshInterval:30,proposalTitle:"Increase staking rewards",yesVotes:e,noVotes:a-e,totalVotes:a,endTime:Math.floor((Date.now()+2592e5)/1e3)}}function X(){const a=10+5*Math.random();return{type:"live_price",refreshInterval:5,symbol:"NEO-USD",price:a.toFixed(2),change24h:10*Math.random()-5,sparkline:Array.from({length:24},()=>a*(.95+.1*Math.random()))}}const Y=s(f({__name:"CardCountdown",props:{data:{}},setup(a){const e=a,t=v(Math.floor(Date.now()/1e3));let s;const n=h(()=>Math.max(0,e.data.endTime-t.value)),l=h(()=>String(Math.floor(n.value/3600)).padStart(2,"0")),o=h(()=>String(Math.floor(n.value%3600/60)).padStart(2,"0")),r=h(()=>String(n.value%60).padStart(2,"0")),i=h(()=>e.data.jackpot),c=h(()=>e.data.ticketsSold);return p(()=>{s=setInterval(()=>{t.value=Math.floor(Date.now()/1e3)},1e3)}),g(()=>clearInterval(s)),(a,e)=>{const t=M,s=S;return w(),m(s,{class:"card-countdown"},{default:_(()=>[y(s,{class:"countdown-timer"},{default:_(()=>[y(t,{class:"time-value"},{default:_(()=>[b(k(l.value),1)]),_:1}),y(t,{class:"time-sep"},{default:_(()=>[b(":")]),_:1}),y(t,{class:"time-value"},{default:_(()=>[b(k(o.value),1)]),_:1}),y(t,{class:"time-sep"},{default:_(()=>[b(":")]),_:1}),y(t,{class:"time-value"},{default:_(()=>[b(k(r.value),1)]),_:1})]),_:1}),y(s,{class:"jackpot"},{default:_(()=>[y(t,{class:"jackpot-label"},{default:_(()=>[b("Jackpot")]),_:1}),y(t,{class:"jackpot-value"},{default:_(()=>[b(k(i.value)+" GAS",1)]),_:1})]),_:1}),y(s,{class:"tickets"},{default:_(()=>[y(t,null,{default:_(()=>[b(k(c.value)+" tickets sold",1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-cb3ef45a"]]),Q=s(f({__name:"CardMultiplier",props:{data:{}},setup(a){const e=a,t=h(()=>e.data.currentMultiplier.toFixed(2)),s=h(()=>({waiting:"Starting...",running:"LIVE",crashed:"Crashed!"}[e.data.status]));return(a,e)=>{const n=M,l=S;return w(),m(l,{class:x(["card-multiplier",a.data.status])},{default:_(()=>[y(l,{class:"multiplier-display"},{default:_(()=>[y(n,{class:"multiplier-value"},{default:_(()=>[b(k(t.value)+"x",1)]),_:1}),y(n,{class:"status-badge"},{default:_(()=>[b(k(s.value),1)]),_:1})]),_:1}),y(l,{class:"game-info"},{default:_(()=>[y(n,null,{default:_(()=>[b(k(a.data.playersCount)+" players",1)]),_:1}),y(n,null,{default:_(()=>[b(k(a.data.totalBets)+" GAS",1)]),_:1})]),_:1})]),_:1},8,["class"])}}}),[["__scopeId","data-v-4d4c6070"]]),aa=s(f({__name:"CardCanvas",props:{data:{}},setup(a){const e=a,t=v(120);function s(){const a=L("preview-canvas"),{pixels:s,width:n,height:l}=e.data,o=t.value/n;for(let e=0;e<s.length/6;e++){const t="#"+s.slice(6*e,6*e+6),l=e%n*o,r=Math.floor(e/n)*o;a.setFillStyle(t),a.fillRect(l,r,o,o)}a.draw()}return p(()=>s()),D(()=>e.data.pixels,s),(a,e)=>{const s=C,n=S,l=M;return w(),m(n,{class:"card-canvas"},{default:_(()=>[y(n,{class:"canvas-preview"},{default:_(()=>[y(s,{"canvas-id":"preview-canvas",class:"preview-canvas",style:I({width:t.value+"px",height:t.value+"px"})},null,8,["style"])]),_:1}),y(n,{class:"canvas-info"},{default:_(()=>[y(l,{class:"active-users"},{default:_(()=>[b("ðŸŽ¨ "+k(a.data.activeUsers)+" active",1)]),_:1}),y(l,{class:"canvas-size"},{default:_(()=>[b(k(a.data.width)+"Ã—"+k(a.data.height),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-85b6f59e"]]),ea=s(f({__name:"CardStats",props:{data:{}},setup:a=>(a,e)=>{const t=M,s=S;return w(),m(s,{class:"card-stats"},{default:_(()=>[(w(!0),A(E,null,T(a.data.stats,(a,e)=>(w(),m(s,{key:e,class:"stat-item"},{default:_(()=>[a.icon?(w(),m(t,{key:0,class:"stat-icon"},{default:_(()=>[b(k(a.icon),1)]),_:2},1024)):K("",!0),y(s,{class:"stat-content"},{default:_(()=>[y(t,{class:"stat-value"},{default:_(()=>[b(k(a.value),1)]),_:2},1024),y(t,{class:"stat-label"},{default:_(()=>[b(k(a.label),1)]),_:2},1024)]),_:2},1024),a.change?(w(),m(t,{key:1,class:x(["stat-change",a.change>0?"up":"down"])},{default:_(()=>[b(k(a.change>0?"+":"")+k(a.change.toFixed(1))+"% ",1)]),_:2},1032,["class"])):K("",!0)]),_:2},1024))),128))]),_:1})}}),[["__scopeId","data-v-c3e3c1b2"]]),ta=s(f({__name:"CardVoting",props:{data:{}},setup(a){const e=a,t=h(()=>Math.round(e.data.yesVotes/e.data.totalVotes*100)),s=h(()=>100-t.value),n=h(()=>{const a=e.data.endTime-Math.floor(Date.now()/1e3);if(a<=0)return"Ended";const t=Math.floor(a/86400);return t>0?`${t}d left`:`${Math.floor(a/3600)}h left`});return(a,e)=>{const l=M,o=S;return w(),m(o,{class:"card-voting"},{default:_(()=>[y(l,{class:"proposal-title"},{default:_(()=>[b(k(a.data.proposalTitle),1)]),_:1}),y(o,{class:"vote-bars"},{default:_(()=>[y(o,{class:"vote-bar yes"},{default:_(()=>[y(o,{class:"bar-fill",style:I({width:t.value+"%"})},null,8,["style"]),y(l,{class:"bar-label"},{default:_(()=>[b("Yes "+k(t.value)+"%",1)]),_:1})]),_:1}),y(o,{class:"vote-bar no"},{default:_(()=>[y(o,{class:"bar-fill",style:I({width:s.value+"%"})},null,8,["style"]),y(l,{class:"bar-label"},{default:_(()=>[b("No "+k(s.value)+"%",1)]),_:1})]),_:1})]),_:1}),y(o,{class:"vote-footer"},{default:_(()=>[y(l,null,{default:_(()=>[b(k(a.data.totalVotes)+" votes",1)]),_:1}),y(l,null,{default:_(()=>[b(k(n.value),1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-ae1a2b5a"]]),sa=s(f({__name:"CardPrice",props:{data:{}},setup(a){const e=a,t=h(()=>{const{sparkline:a}=e.data,t=Math.min(...a),s=Math.max(...a)-t||1;return a.map(a=>20+(a-t)/s*80)});return(a,e)=>{const s=M,n=S;return w(),m(n,{class:"card-price"},{default:_(()=>[y(n,{class:"price-header"},{default:_(()=>[y(s,{class:"symbol"},{default:_(()=>[b(k(a.data.symbol),1)]),_:1}),y(s,{class:x(["change",a.data.change24h>=0?"up":"down"])},{default:_(()=>[b(k(a.data.change24h>=0?"+":"")+k(a.data.change24h.toFixed(2))+"% ",1)]),_:1},8,["class"])]),_:1}),y(s,{class:"price-value"},{default:_(()=>[b("$"+k(a.data.price),1)]),_:1}),y(n,{class:"sparkline"},{default:_(()=>[(w(!0),A(E,null,T(t.value,(e,t)=>(w(),m(n,{key:t,class:x(["spark-bar",a.data.change24h>=0?"up":"down"]),style:I({height:e+"%"})},null,8,["style","class"]))),128))]),_:1})]),_:1})}}}),[["__scopeId","data-v-4bc5fda9"]]);export{aa as CardCanvas,Y as CardCountdown,Q as CardMultiplier,sa as CardPrice,ea as CardStats,ta as CardVoting,n as callBridge,l as createH5Bridge,o as getSDKSync,r as getWalletState,i as initWalletStateListener,R as installMockSDK,H as mockCanvasData,$ as mockCountdownData,z as mockMultiplierData,X as mockPriceData,U as mockSDK,Z as mockStatsData,J as mockVotingData,c as subscribeToWalletState,j as useAsyncAction,q as useCloudSaves,B as useDatafeed,G as useEvents,V as useGasSponsor,N as useGovernance,d as useI18n,F as usePayments,P as useRNG,u as useWallet,a as waitForSDK};
