import{r as e,d as a,c as t,w as l,i as u,a as s,o as n,b as r,e as i,f as c,g as d,n as o,t as f,u as p}from"./index-3Mqhcqux.js";function v(a){const t=e(!1),l=e(null);return{isLoading:t,error:l,payGAS:async(e,u)=>{t.value=!0,l.value=null;try{const t=await function(e=5e3){return new Promise((a,t)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const l=setTimeout(()=>{t(new Error("SDK timeout"))},e),u=()=>{clearTimeout(l),window.removeEventListener("miniapp-sdk-ready",u),window.MiniAppSDK?a(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",u)})}();return await t.payments.payGAS(a,e,u)}catch(s){throw l.value=s,s}finally{t.value=!1}}}}const _="0.008",m=((e,a)=>{const t=e.__vccOpts||e;for(const[l,u]of a)t[l]=u;return t})(a({__name:"index",setup(a){const{payGAS:m,isLoading:y}=v("miniapp-dutch-auction"),w=e({currentPrice:8.5,startPrice:12,timeLeft:"18m 42s",item:"NEO Tokens",quantity:100,dropRate:"0.1 GAS"}),A=e(""),S=e(null),P=(e,a=2)=>function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,a),g=async()=>{if(y.value)return;const e=parseInt(A.value,10);if(!(e>0&&e<=w.value.quantity))return void(S.value={msg:`Enter 1-${w.value.quantity}`,type:"error"});const a=(e*w.value.currentPrice+parseFloat(_)).toFixed(3);try{await m(a,`auction:${w.value.item}:${e}:${w.value.currentPrice}`),S.value={msg:`Bid accepted: ${e} @ ${P(w.value.currentPrice,3)} GAS`,type:"success"}}catch(t){S.value={msg:(null==t?void 0:t.message)||"Payment failed",type:"error"}}};return(e,a)=>{const v=c,m=u,D=s("uni-easyinput");return n(),t(m,{class:"app-container"},{default:l(()=>[r(m,{class:"header"},{default:l(()=>[r(v,{class:"title"},{default:l(()=>[d("Dutch Auction")]),_:1}),r(v,{class:"subtitle"},{default:l(()=>[d("Descending price discovery")]),_:1})]),_:1}),S.value?(n(),t(m,{key:0,class:o(["status-msg",S.value.type])},{default:l(()=>[r(v,null,{default:l(()=>[d(f(S.value.msg),1)]),_:1})]),_:1},8,["class"])):i("",!0),r(m,{class:"card"},{default:l(()=>[r(v,{class:"card-title"},{default:l(()=>[d("Active Auction")]),_:1}),r(m,{class:"row"},{default:l(()=>[r(v,null,{default:l(()=>[d("Current price")]),_:1}),r(v,{class:"v"},{default:l(()=>[d(f(P(w.value.currentPrice,3))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"row"},{default:l(()=>[r(v,null,{default:l(()=>[d("Start price")]),_:1}),r(v,{class:"v"},{default:l(()=>[d(f(P(w.value.startPrice,3))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"row"},{default:l(()=>[r(v,null,{default:l(()=>[d("Time left")]),_:1}),r(v,{class:"v"},{default:l(()=>[d(f(w.value.timeLeft),1)]),_:1})]),_:1})]),_:1}),r(m,{class:"card"},{default:l(()=>[r(v,{class:"card-title"},{default:l(()=>[d("Auction Details")]),_:1}),r(m,{class:"row"},{default:l(()=>[r(v,null,{default:l(()=>[d("Item")]),_:1}),r(v,{class:"v"},{default:l(()=>[d(f(w.value.item),1)]),_:1})]),_:1}),r(m,{class:"row"},{default:l(()=>[r(v,null,{default:l(()=>[d("Quantity")]),_:1}),r(v,{class:"v"},{default:l(()=>[d(f(w.value.quantity),1)]),_:1})]),_:1}),r(m,{class:"row"},{default:l(()=>[r(v,null,{default:l(()=>[d("Price drop")]),_:1}),r(v,{class:"v"},{default:l(()=>[d(f(w.value.dropRate)+"/min",1)]),_:1})]),_:1})]),_:1}),r(m,{class:"card"},{default:l(()=>[r(v,{class:"card-title"},{default:l(()=>[d("Bid Now")]),_:1}),r(D,{modelValue:A.value,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value=e),type:"number",placeholder:"Quantity to buy"},null,8,["modelValue"]),r(m,{class:"price-display"},{default:l(()=>[r(v,null,{default:l(()=>[d("Total: "+f(P(parseFloat(A.value||"0")*w.value.currentPrice,3))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"action-btn",onClick:g},{default:l(()=>[r(v,null,{default:l(()=>[d(f(p(y)?"Processing...":"Accept Current Price"),1)]),_:1})]),_:1}),r(v,{class:"note"},{default:l(()=>[d("Mock auction fee: "+f(_)+" GAS")]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-cd7c557a"]]);export{m as default};
