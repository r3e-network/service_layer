import{r as e,d as a,c as t,w as l,i as n,a as s,o as i,b as u,e as c,f as r,g as d,n as o,t as p,h as m,F as v,j as f,k as w,u as y}from"./index-WN5TS2h5.js";function h(a){const t=e(!1),l=e(null);return{isLoading:t,error:l,payGAS:async(e,n)=>{t.value=!0,l.value=null;try{const t=await function(e=5e3){return new Promise((a,t)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const l=setTimeout(()=>{t(new Error("SDK timeout"))},e),n=()=>{clearTimeout(l),window.removeEventListener("miniapp-sdk-ready",n),window.MiniAppSDK?a(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",n)})}();return await t.payments.payGAS(a,e,n)}catch(s){throw l.value=s,s}finally{t.value=!1}}}}const _=((e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t})(a({__name:"index",setup(a){const{payGAS:_,isLoading:g}=h("miniapp-deadswitch"),S=e([{id:"1",name:"Emergency Fund",recipient:"NXXx...abc",amount:100,daysLeft:15,active:!0},{id:"2",name:"Backup Wallet",recipient:"NXXx...def",amount:50,daysLeft:7,active:!0}]),k=e({name:"",recipient:"",amount:"",interval:"30"}),V=e(null),C=async()=>{if(!g.value&&k.value.name&&k.value.recipient&&k.value.amount)try{V.value={msg:"Creating switch...",type:"loading"},await _(k.value.amount,`create:${Date.now()}`),S.value.push({id:Date.now().toString(),name:k.value.name,recipient:k.value.recipient,amount:parseFloat(k.value.amount),daysLeft:parseInt(k.value.interval),active:!0}),V.value={msg:"Switch created!",type:"success"},k.value={name:"",recipient:"",amount:"",interval:"30"}}catch(e){V.value={msg:e.message||"Error",type:"error"}}};return(e,a)=>{const h=r,D=n,A=s("uni-easyinput");return i(),t(D,{class:"app-container"},{default:l(()=>[u(D,{class:"header"},{default:l(()=>[u(h,{class:"title"},{default:l(()=>[d("Dead Switch")]),_:1}),u(h,{class:"subtitle"},{default:l(()=>[d("Dead man's switch protocol")]),_:1})]),_:1}),V.value?(i(),t(D,{key:0,class:o(["status-msg",V.value.type])},{default:l(()=>[u(h,null,{default:l(()=>[d(p(V.value.msg),1)]),_:1})]),_:1},8,["class"])):c("",!0),u(D,{class:"card"},{default:l(()=>[u(h,{class:"card-title"},{default:l(()=>[d("Active Switches")]),_:1}),(i(!0),m(v,null,f(S.value,e=>(i(),t(D,{key:e.id,class:"switch-item"},{default:l(()=>[u(h,{class:"switch-icon"},{default:l(()=>[d(p(e.active?"⏰":"⚠️"),1)]),_:2},1024),u(D,{class:"switch-info"},{default:l(()=>[u(h,{class:"switch-name"},{default:l(()=>[d(p(e.name),1)]),_:2},1024),u(h,{class:"switch-timer"},{default:l(()=>[d(p(e.active?`Check-in: ${e.daysLeft} days`:"TRIGGERED"),1)]),_:2},1024)]),_:2},1024),e.active?(i(),t(D,{key:0,class:"checkin-btn",onClick:a=>(async e=>{try{V.value={msg:"Checking in...",type:"loading"},await _("0.1",`checkin:${e.id}`),e.daysLeft=parseInt(k.value.interval)||30,V.value={msg:"Check-in successful!",type:"success"}}catch(a){V.value={msg:a.message||"Error",type:"error"}}})(e)},{default:l(()=>[u(h,null,{default:l(()=>[d("✓")]),_:1})]),_:2},1032,["onClick"])):c("",!0)]),_:2},1024))),128))]),_:1}),u(D,{class:"card"},{default:l(()=>[u(h,{class:"card-title"},{default:l(()=>[d("Create Switch")]),_:1}),u(A,{modelValue:k.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value.name=e),placeholder:"Switch name",class:"input-field"},null,8,["modelValue"]),u(A,{modelValue:k.value.recipient,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value.recipient=e),placeholder:"Recipient address",class:"input-field"},null,8,["modelValue"]),u(A,{modelValue:k.value.amount,"onUpdate:modelValue":a[2]||(a[2]=e=>k.value.amount=e),type:"number",placeholder:"Amount (GAS)",class:"input-field"},null,8,["modelValue"]),u(D,{class:"interval-row"},{default:l(()=>[u(h,{class:"interval-label"},{default:l(()=>[d("Check-in interval:")]),_:1}),u(A,{modelValue:k.value.interval,"onUpdate:modelValue":a[3]||(a[3]=e=>k.value.interval=e),type:"number",placeholder:"30",class:"interval-input"},null,8,["modelValue"]),u(h,{class:"interval-text"},{default:l(()=>[d("days")]),_:1})]),_:1}),u(D,{class:"create-btn",onClick:C,style:w({opacity:y(g)?.6:1})},{default:l(()=>[u(h,null,{default:l(()=>[d(p(y(g)?"Creating...":"Create Switch"),1)]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-ab7f1485"]]);export{_ as default};
