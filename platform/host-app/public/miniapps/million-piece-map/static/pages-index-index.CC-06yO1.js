import{r as e,d as a,c as l,a as t,w as s,i as u,o as n,b as r,e as i,f as d,g as c,n as o,t as f,h as v,F as p,j as _,k as w}from"./index-BAaPIU40.js";function m(a){const l=e(!1),t=e(null);return{isLoading:l,error:t,payGAS:async(e,s)=>{l.value=!0,t.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},e),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await l.payments.payGAS(a,e,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}const y=((e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l})(a({__name:"index",setup(a){const{payGAS:y}=m("miniapp-millionpiecemap"),g=e(Array.from({length:64},(e,a)=>({owned:a%7==0,owner:a%7==0?"ðŸ‘¤":"",selected:!1}))),h=e(0),S=e(.5),k=e(9),A=e(4.5),M=e(!1),x=e(null),T=l(()=>Math.round(k.value/64*100)),b=async()=>{if(!M.value)if(g.value[h.value].owned)x.value={msg:"Tile already owned",type:"error"};else{M.value=!0;try{await y(S.value.toString(),`map:tile:${h.value}`),g.value[h.value].owned=!0,g.value[h.value].owner="ðŸŽ¯",k.value++,A.value+=S.value,x.value={msg:`Tile #${h.value} purchased!`,type:"success"}}catch(e){x.value={msg:e.message||"Error",type:"error"}}finally{M.value=!1}}};return(e,a)=>{const l=d,m=u;return n(),t(m,{class:"app-container"},{default:s(()=>[r(m,{class:"header"},{default:s(()=>[r(l,{class:"title"},{default:s(()=>[c("Million Piece Map")]),_:1}),r(l,{class:"subtitle"},{default:s(()=>[c("Tile ownership game")]),_:1})]),_:1}),x.value?(n(),t(m,{key:0,class:o(["status-msg",x.value.type])},{default:s(()=>[r(l,null,{default:s(()=>[c(f(x.value.msg),1)]),_:1})]),_:1},8,["class"])):i("",!0),r(m,{class:"card"},{default:s(()=>[r(l,{class:"card-title"},{default:s(()=>[c("Map Grid")]),_:1}),r(m,{class:"map-grid"},{default:s(()=>[(n(!0),v(p,null,_(g.value,(e,a)=>(n(),t(m,{key:a,class:o(["tile",e.owned&&"owned",e.selected&&"selected"]),onClick:e=>{return l=a,g.value.forEach((e,a)=>e.selected=a===l),void(h.value=l);var l}},{default:s(()=>[e.owned?(n(),t(l,{key:0},{default:s(()=>[c(f(e.owner),1)]),_:2},1024)):i("",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),r(m,{class:"card"},{default:s(()=>[r(l,{class:"card-title"},{default:s(()=>[c("Purchase Tile")]),_:1}),r(m,{class:"tile-info"},{default:s(()=>[r(l,{class:"info-text"},{default:s(()=>[c("Selected: Tile #"+f(h.value),1)]),_:1}),r(l,{class:"info-text"},{default:s(()=>[c("Price: "+f(S.value)+" GAS",1)]),_:1})]),_:1}),r(m,{class:"purchase-btn",onClick:b,style:w({opacity:M.value?.6:1})},{default:s(()=>[r(l,null,{default:s(()=>[c(f(M.value?"Purchasing...":"Purchase Tile"),1)]),_:1})]),_:1},8,["style"])]),_:1}),r(m,{class:"card"},{default:s(()=>[r(l,{class:"card-title"},{default:s(()=>[c("Your Stats")]),_:1}),r(m,{class:"stats-grid"},{default:s(()=>[r(m,{class:"stat"},{default:s(()=>[r(l,{class:"stat-value"},{default:s(()=>[c(f(k.value),1)]),_:1}),r(l,{class:"stat-label"},{default:s(()=>[c("Owned")]),_:1})]),_:1}),r(m,{class:"stat"},{default:s(()=>[r(l,{class:"stat-value"},{default:s(()=>{return[c(f((e=A.value,function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,2))),1)];var e}),_:1}),r(l,{class:"stat-label"},{default:s(()=>[c("Spent")]),_:1})]),_:1}),r(m,{class:"stat"},{default:s(()=>[r(l,{class:"stat-value"},{default:s(()=>[c(f(T.value)+"%",1)]),_:1}),r(l,{class:"stat-label"},{default:s(()=>[c("Coverage")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-aa2ac6b7"]]);export{y as default};
