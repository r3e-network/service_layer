import{y as e,z as a,O as l,A as s,d as t,l as o,m as n,c as u,b as c,w as d,i,o as r,a as v,e as f,p as _,f as k,t as p,n as m,u as y,h,F as b,r as g,g as w,j as C,I as x,x as T,B as $}from"./index-CFRpd7m-.js";import{u as j,P as D}from"./piggy.0UabnB5s.js";import{u as I,_ as S}from"./_plugin-vue_export-helper.BHIM12RF.js";const V=(l=>(t,o=e())=>{!s&&a(l,t,o)})(l),A=S(t({__name:"detail",setup(e){const{t:a}=I(),l=j(),s=o(""),t=o(""),S=o(D.ETH),A=o(!1),E=o(null),B=o(!1),H=o(!1),N=o(!1),P=o(""),R=o(!1),U=n(()=>l.piggyBanks.find(e=>e.id===s.value)),W=n(()=>!U.value||Date.now()<U.value.unlockTime),z=n(()=>U.value?l.getBalances(s.value):{}),F=n(()=>l.getAllTokens().slice(0,6));V(e=>{e.id&&(s.value=e.id)});const L=()=>_(),O=async()=>{if(P.value){R.value=!0;try{const e=await l.lookupToken(P.value);e?(S.value=e,N.value=!1,P.value="",T({title:`Added ${e.symbol}`,icon:"success"})):T({title:"Invalid token address",icon:"none"})}catch(e){T({title:e.message||"Failed",icon:"none"})}finally{R.value=!1}}},q=async()=>{A.value=!0,E.value=null;try{const e=await l.checkGoalReached(s.value);E.value=e}finally{A.value=!1}},G=async()=>{if(t.value&&U.value&&S.value){B.value=!0;try{const e=await l.prepareDeposit(s.value,t.value,S.value);$({title:"‚ö†Ô∏è Important",content:`Depositing ${t.value} ${S.value.symbol}. Your note has been saved locally. If you clear app data, you will lose access to these funds forever!`,confirmText:"I Understand",success:async o=>{o.confirm&&(l.confirmDeposit(s.value,e.note.nullifier,"0x..."),T({title:a("detail.deposit_success"),icon:"success"}),t.value="",E.value=null)}})}catch(e){T({title:e.message||"Error",icon:"error"})}finally{B.value=!1}}},K=async()=>{if(U.value){H.value=!0;try{const e=await l.prepareWithdraw(s.value);if(0===e.length)return void T({title:"No confirmed deposits to withdraw",icon:"none"});const t=e.map(e=>`${e.note.amount} ${e.note.token.symbol}`).join("\n");$({title:"üî® Smash Piggy Bank!",content:`Withdrawing:\n${t}\n\nThis will send ZK proofs to the contract.`,success:async t=>{if(t.confirm){for(const a of e)l.markSpent(s.value,a.note.nullifier,"0x...");T({title:a("detail.smash_success"),icon:"success"})}}})}catch(e){T({title:e.message,icon:"none"})}finally{H.value=!1}}};return(e,l)=>{const s=f,o=i,n=w,_=x;return U.value?(r(),u(o,{key:0,class:"container"},{default:d(()=>[v(o,{class:"nav"},{default:d(()=>[v(s,{class:"back-btn",onClick:L},{default:d(()=>[k("‚Üê")]),_:1}),v(s,{class:"page-title"},{default:d(()=>[k(p(U.value.name),1)]),_:1})]),_:1}),v(o,{class:"hero-card",style:m({borderColor:U.value.themeColor,boxShadow:`0 0 20px ${U.value.themeColor}30`})},{default:d(()=>[v(o,{class:"lock-icon"},{default:d(()=>[k(p(W.value?"üîí":"üîì"),1)]),_:1}),v(s,{class:"status-text"},{default:d(()=>[k(p(W.value?y(a)("detail.locked"):y(a)("detail.unlocked")),1)]),_:1}),W.value?(r(),u(o,{key:0,class:"balance-hidden"},{default:d(()=>[v(s,{class:"hidden-label"},{default:d(()=>[k(p(y(a)("detail.balance_hidden")),1)]),_:1}),v(o,{class:"dots"},{default:d(()=>[v(o,{class:"dot"}),v(o,{class:"dot"}),v(o,{class:"dot"})]),_:1})]),_:1})):(r(),u(o,{key:1,class:"balance-revealed"},{default:d(()=>[(r(!0),h(b,null,g(z.value,(e,a)=>(r(),u(o,{key:a,class:"balance-row"},{default:d(()=>[v(s,{class:"token-icon"},{default:d(()=>[k(p(e.token.icon),1)]),_:2},1024),v(s,{class:"token-balance"},{default:d(()=>[k(p(e.amount)+" "+p(e.token.symbol),1)]),_:2},1024)]),_:2},1024))),128)),0===Object.keys(z.value).length?(r(),u(s,{key:0,class:"empty-balance"},{default:d(()=>[k("No deposits")]),_:1})):c("",!0)]),_:1})),v(s,{class:"unlock-date"},{default:d(()=>[k(p(y(a)("detail.unlocks_on",{date:new Date(U.value.unlockTime).toLocaleDateString()})),1)]),_:1})]),_:1},8,["style"]),v(o,{class:"section"},{default:d(()=>[v(o,{class:"section-header"},{default:d(()=>[v(s,{class:"section-title"},{default:d(()=>[k(p(y(a)("detail.goal"))+": "+p(U.value.targetAmount)+" "+p(U.value.targetToken.symbol),1)]),_:1}),v(n,{class:"zk-btn",onClick:q,loading:A.value},{default:d(()=>[k(p(A.value?"...":y(a)("detail.check_goal")),1)]),_:1},8,["loading"])]),_:1}),null!==E.value?(r(),u(o,{key:0,class:C(["goal-feedback",{success:E.value}])},{default:d(()=>[k(p(E.value?y(a)("detail.goal_reached"):y(a)("detail.goal_not_reached")),1)]),_:1},8,["class"])):c("",!0)]),_:1}),W.value?(r(),u(o,{key:0,class:"section deposit-section"},{default:d(()=>[v(s,{class:"section-title"},{default:d(()=>[k(p(y(a)("detail.deposit")),1)]),_:1}),v(o,{class:"token-selector"},{default:d(()=>[(r(!0),h(b,null,g(F.value,e=>{var a;return r(),u(o,{key:e.address,class:C(["token-option",{active:(null==(a=S.value)?void 0:a.address)===e.address}]),onClick:a=>S.value=e},{default:d(()=>[v(s,{class:"token-icon"},{default:d(()=>[k(p(e.icon),1)]),_:2},1024),v(s,{class:"token-name"},{default:d(()=>[k(p(e.symbol),1)]),_:2},1024)]),_:2},1032,["class","onClick"])}),128)),v(o,{class:"token-option add-token",onClick:l[0]||(l[0]=e=>N.value=!0)},{default:d(()=>[v(s,{class:"add-icon"},{default:d(()=>[k("+")]),_:1})]),_:1})]),_:1}),N.value?(r(),u(o,{key:0,class:"custom-token-input"},{default:d(()=>[v(_,{class:"address-input",modelValue:P.value,"onUpdate:modelValue":l[1]||(l[1]=e=>P.value=e),placeholder:"Enter any ERC-20 token address (0x...)","placeholder-class":"placeholder"},null,8,["modelValue"]),v(o,{class:"btn-row"},{default:d(()=>[v(n,{class:"cancel-btn",onClick:l[2]||(l[2]=e=>N.value=!1)},{default:d(()=>[k("Cancel")]),_:1}),v(n,{class:"add-btn",onClick:O,disabled:R.value},{default:d(()=>[k(p(R.value?"Loading...":"Add Token"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):c("",!0),v(o,{class:"input-row"},{default:d(()=>{var e;return[v(_,{class:"amount-input",type:"digit",modelValue:t.value,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value=e),placeholder:`0.0 ${(null==(e=S.value)?void 0:e.symbol)||""}`},null,8,["modelValue","placeholder"]),v(n,{class:"deposit-btn",onClick:G,disabled:!t.value||!S.value||B.value},{default:d(()=>[k(p(B.value?y(a)("common.loading"):y(a)("detail.deposit")),1)]),_:1},8,["disabled"])]}),_:1}),S.value&&!S.value.isNative?(r(),u(s,{key:1,class:"deposit-hint"},{default:d(()=>[k(" ‚ö†Ô∏è ERC-20 tokens require approval before deposit ")]),_:1})):c("",!0)]),_:1})):c("",!0),W.value?c("",!0):(r(),u(o,{key:1,class:"section smash-section"},{default:d(()=>[v(n,{class:"smash-btn",onClick:K,disabled:H.value},{default:d(()=>[k(p(H.value?y(a)("common.loading"):`üî® ${y(a)("detail.smash")}`),1)]),_:1},8,["disabled"])]),_:1})),U.value.notes.length>0?(r(),u(o,{key:2,class:"section history-section"},{default:d(()=>[v(s,{class:"section-title"},{default:d(()=>[k(p(y(a)("detail.deposits"))+" ("+p(U.value.notes.length)+")",1)]),_:1}),v(o,{class:"note-list"},{default:d(()=>[(r(!0),h(b,null,g(U.value.notes,(e,a)=>(r(),u(o,{key:a,class:"note-item"},{default:d(()=>[v(o,{class:"note-info"},{default:d(()=>[v(o,{class:"note-token"},{default:d(()=>[v(s,{class:"note-icon"},{default:d(()=>[k(p(e.token.icon),1)]),_:2},1024),v(s,{class:"note-amount"},{default:d(()=>[k(p(e.amount)+" "+p(e.token.symbol),1)]),_:2},1024)]),_:2},1024),v(s,{class:C(["note-status",{confirmed:e.depositTxHash,spent:e.isSpent}])},{default:d(()=>[k(p(e.isSpent?"‚úì Withdrawn":e.depositTxHash?"‚úì Confirmed":"‚è≥ Pending"),1)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):c("",!0)]),_:1})):c("",!0)}}}),[["__scopeId","data-v-4ddf518a"]]);export{A as default};
