import{r as e,d as a,o as l,a as t,c as s,w as u,i as n,b as i,e as d,f as r,g as c,h as o,j as h,n as v,t as f,k as m,l as g,F as _,m as p,u as y}from"./index-C7Ewe-Uo.js";function w(a){const l=e(!1),t=e(null);return{isLoading:l,error:t,payGAS:async(e,s)=>{l.value=!0,t.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},e),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await l.payments.payGAS(a,e,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}const b=((e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l})(a({__name:"index",setup(a){const{payGAS:b,isLoading:S}=w("miniapp-algo-battle"),k=e("1.0"),M=e("quicksort"),A=e("idle"),x=e(30),B=e(null),$=e({name:"QuickSort",health:100}),D=e({name:"MergeSort",health:100}),E=[{id:"quicksort",name:"QuickSort",desc:"Fast & aggressive"},{id:"mergesort",name:"MergeSort",desc:"Stable & balanced"},{id:"heapsort",name:"HeapSort",desc:"Memory efficient"},{id:"bubblesort",name:"BubbleSort",desc:"Simple but slow"}],K=e([]),L=async()=>{if(!S.value&&"idle"===A.value)try{B.value={msg:"Entering arena...",type:"loading"},await b(k.value,`battle:${M.value}:${Date.now()}`),A.value="fighting",$.value.health=100,D.value.health=100,K.value=[],x.value=30,B.value={msg:"Battle started!",type:"success"},K.value.push(`${$.value.name} enters the arena!`),K.value.push(`${D.value.name} accepts the challenge!`)}catch(e){B.value={msg:e.message||"Error starting battle",type:"error"}}};let V;return l(()=>{V=setInterval(()=>{if("fighting"===A.value){if(x.value--,Math.random()<.3){const e=Math.floor(15*Math.random())+5;Math.random()<.5?(D.value.health=Math.max(0,D.value.health-e),K.value.unshift(`${$.value.name} deals ${e} damage!`)):($.value.health=Math.max(0,$.value.health-e),K.value.unshift(`${D.value.name} deals ${e} damage!`)),K.value=K.value.slice(0,8)}if($.value.health<=0||D.value.health<=0||x.value<=0){const e=$.value.health>D.value.health?$.value.name:D.value.name;K.value.unshift(`ðŸ† ${e} wins the battle!`),B.value={msg:e===$.value.name?"Victory! You won!":"Defeat! Better luck next time.",type:e===$.value.name?"success":"error"},A.value="idle",x.value=30}}},1e3)}),t(()=>clearInterval(V)),(e,a)=>{const l=o,t=n,w=i("uni-easyinput");return d(),s(t,{class:"app-container"},{default:u(()=>[r(t,{class:"header"},{default:u(()=>[r(l,{class:"title"},{default:u(()=>[h("Algo Battle")]),_:1}),r(l,{class:"subtitle"},{default:u(()=>[h("Code gladiator arena")]),_:1})]),_:1}),B.value?(d(),s(t,{key:0,class:v(["status-msg",B.value.type])},{default:u(()=>[r(l,null,{default:u(()=>[h(f(B.value.msg),1)]),_:1})]),_:1},8,["class"])):c("",!0),r(t,{class:"card battle-card"},{default:u(()=>[r(t,{class:"battle-header"},{default:u(()=>[r(l,{class:"battle-title"},{default:u(()=>[h(f("idle"===A.value?"Ready to Battle":"Battle in Progress"),1)]),_:1}),r(l,{class:"timer"},{default:u(()=>[h(f(x.value),1)]),_:1})]),_:1}),r(t,{class:"fighters"},{default:u(()=>[r(t,{class:"fighter"},{default:u(()=>[r(l,{class:"fighter-name"},{default:u(()=>[h(f($.value.name),1)]),_:1}),r(t,{class:"health-bar"},{default:u(()=>[r(t,{class:"health-fill",style:m({width:$.value.health+"%"})},null,8,["style"])]),_:1}),r(l,{class:"health-text"},{default:u(()=>[h(f($.value.health)+"%",1)]),_:1})]),_:1}),r(l,{class:"vs"},{default:u(()=>[h("VS")]),_:1}),r(t,{class:"fighter"},{default:u(()=>[r(l,{class:"fighter-name"},{default:u(()=>[h(f(D.value.name),1)]),_:1}),r(t,{class:"health-bar"},{default:u(()=>[r(t,{class:"health-fill",style:m({width:D.value.health+"%"})},null,8,["style"])]),_:1}),r(l,{class:"health-text"},{default:u(()=>[h(f(D.value.health)+"%",1)]),_:1})]),_:1})]),_:1})]),_:1}),r(t,{class:"card"},{default:u(()=>[r(l,{class:"card-title"},{default:u(()=>[h("Your Algorithm")]),_:1}),r(t,{class:"algo-selector"},{default:u(()=>[(d(),g(_,null,p(E,e=>r(t,{key:e.id,class:v(["algo-item",M.value===e.id?"selected":""]),onClick:a=>(e=>{if("idle"===A.value){M.value=e;const a=E.find(a=>a.id===e);a&&($.value.name=a.name)}})(e.id)},{default:u(()=>[r(l,{class:"algo-name"},{default:u(()=>[h(f(e.name),1)]),_:2},1024),r(l,{class:"algo-desc"},{default:u(()=>[h(f(e.desc),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),64))]),_:1})]),_:1}),r(t,{class:"card"},{default:u(()=>[r(l,{class:"card-title"},{default:u(()=>[h("Entry Fee")]),_:1}),r(t,{class:"fee-row"},{default:u(()=>[r(w,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=e=>k.value=e),type:"digit",placeholder:"1.0",class:"fee-input"},null,8,["modelValue"]),r(l,{class:"fee-label"},{default:u(()=>[h("GAS")]),_:1})]),_:1}),r(t,{class:"action-btn",onClick:L,style:m({opacity:y(S)||"idle"!==A.value?.6:1})},{default:u(()=>[r(l,null,{default:u(()=>[h(f("idle"===A.value?"Start Battle":"Battle Running..."),1)]),_:1})]),_:1},8,["style"])]),_:1}),r(t,{class:"card"},{default:u(()=>[r(l,{class:"card-title"},{default:u(()=>[h("Battle Log")]),_:1}),r(t,{class:"log-list"},{default:u(()=>[0===K.value.length?(d(),s(l,{key:0,class:"empty"},{default:u(()=>[h("No battles yet")]),_:1})):c("",!0),(d(!0),g(_,null,p(K.value,(e,a)=>(d(),s(t,{key:a,class:"log-item"},{default:u(()=>[r(l,{class:"log-text"},{default:u(()=>[h(f(e),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-dfe2f0c1"]]);export{b as default};
