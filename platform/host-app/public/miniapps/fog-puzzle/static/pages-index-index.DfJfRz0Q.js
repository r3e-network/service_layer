import{r as e,d as a,c as t,w as l,i as s,a as u,o as r,b as n,e as d,f as c,g as o,n as i,t as f,h as p,F as v,j as y,k as m,u as _}from"./index-0oNVf4HA.js";function g(a){const t=e(!1),l=e(null);return{isLoading:t,error:l,payGAS:async(e,s)=>{t.value=!0,l.value=null;try{const t=await function(e=5e3){return new Promise((a,t)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const l=setTimeout(()=>{t(new Error("SDK timeout"))},e),s=()=>{clearTimeout(l),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await t.payments.payGAS(a,e,s)}catch(u){throw l.value=u,u}finally{t.value=!1}}}}const h=((e,a)=>{const t=e.__vccOpts||e;for(const[l,s]of a)t[l]=s;return t})(a({__name:"index",setup(a){const{payGAS:h,isLoading:w}=g("miniapp-fog-puzzle"),S=e("0.5"),A=e(0),M=e(0),k=e(5),x=e(0),G=e(!1),b=e(null),z=()=>{const e=[];for(let l=0;l<6;l++){const a=[];for(let e=0;e<6;e++)a.push({type:"empty",revealed:!1});e.push(a)}let a=0;for(;a<k.value;){const t=Math.floor(6*Math.random()),l=Math.floor(6*Math.random());"empty"===e[t][l].type&&(e[t][l].type="treasure",a++)}let t=0;for(;t<3;){const a=Math.floor(6*Math.random()),l=Math.floor(6*Math.random());"empty"===e[a][l].type&&(e[a][l].type="trap",t++)}for(let l=0;l<6;l++)for(let a=0;a<6;a++)if("empty"===e[l][a].type){let t=0;for(let s=-1;s<=1;s++)for(let u=-1;u<=1;u++){const r=l+s,n=a+u;r>=0&&r<6&&n>=0&&n<6&&"treasure"===e[r][n].type&&t++}t>0&&(e[l][a].type="hint")}return e},E=e(z()),F=(e,a=2)=>function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,a),D=e=>{switch(e){case"treasure":return"ðŸ’Ž";case"trap":return"ðŸ’¥";case"hint":return"ðŸ’¡";default:return"Â·"}},K=()=>{for(let e=0;e<6;e++)for(let a=0;a<6;a++)E.value[e][a].revealed=!0},T=async()=>{if(!w.value&&!G.value)try{b.value={msg:"Starting treasure hunt...",type:"loading"},await h(S.value,`fogpuzzle:start:${Date.now()}`),E.value=z(),A.value=0,M.value=0,x.value=0,G.value=!0,b.value={msg:"Hunt started! Find all treasures!",type:"success"}}catch(e){b.value={msg:e.message||"Error starting game",type:"error"}}};return(e,a)=>{const g=c,h=s,z=u("uni-easyinput");return r(),t(h,{class:"app-container"},{default:l(()=>[n(h,{class:"header"},{default:l(()=>[n(g,{class:"title"},{default:l(()=>[o("Fog Puzzle")]),_:1}),n(g,{class:"subtitle"},{default:l(()=>[o("Hidden treasure hunt")]),_:1})]),_:1}),b.value?(r(),t(h,{key:0,class:i(["status-msg",b.value.type])},{default:l(()=>[n(g,null,{default:l(()=>[o(f(b.value.msg),1)]),_:1})]),_:1},8,["class"])):d("",!0),n(h,{class:"card stats-card"},{default:l(()=>[n(h,{class:"stat-item"},{default:l(()=>[n(g,{class:"stat-label"},{default:l(()=>[o("Moves")]),_:1}),n(g,{class:"stat-value"},{default:l(()=>[o(f(A.value),1)]),_:1})]),_:1}),n(h,{class:"stat-item"},{default:l(()=>[n(g,{class:"stat-label"},{default:l(()=>[o("Found")]),_:1}),n(g,{class:"stat-value"},{default:l(()=>[o(f(M.value)+"/"+f(k.value),1)]),_:1})]),_:1}),n(h,{class:"stat-item"},{default:l(()=>[n(g,{class:"stat-label"},{default:l(()=>[o("Prize")]),_:1}),n(g,{class:"stat-value success"},{default:l(()=>[o(f(F(x.value))+" GAS",1)]),_:1})]),_:1})]),_:1}),n(h,{class:"card grid-card"},{default:l(()=>[n(h,{class:"puzzle-grid"},{default:l(()=>[(r(!0),p(v,null,y(E.value,(e,a)=>(r(),t(h,{key:a,class:"grid-row"},{default:l(()=>[(r(!0),p(v,null,y(e,(e,s)=>(r(),t(h,{key:s,class:i(["grid-cell",e.revealed?"revealed":"hidden",e.type]),onClick:e=>((e,a)=>{if(!G.value)return void(b.value={msg:"Start a game first!",type:"error"});if(E.value[e][a].revealed)return void(b.value={msg:"Already revealed!",type:"error"});E.value[e][a].revealed=!0,A.value++;const t=E.value[e][a].type;"treasure"===t?(M.value++,x.value+=.5,b.value={msg:"Treasure found! +0.5 GAS",type:"success"},M.value===k.value&&(b.value={msg:`Victory! All treasures found! Won ${F(x.value)} GAS`,type:"success"},G.value=!1)):"trap"===t?(b.value={msg:"Trap! Game over. Better luck next time.",type:"error"},G.value=!1,K()):b.value="hint"===t?{msg:"Hint: Treasure nearby!",type:"success"}:{msg:"Empty space",type:"success"}})(a,s)},{default:l(()=>[e.revealed?(r(),t(g,{key:0,class:"cell-icon"},{default:l(()=>[o(f(D(e.type)),1)]),_:2},1024)):(r(),t(g,{key:1,class:"fog-text"},{default:l(()=>[o("?")]),_:1}))]),_:2},1032,["class","onClick"]))),128))]),_:2},1024))),128))]),_:1})]),_:1}),n(h,{class:"card"},{default:l(()=>[n(g,{class:"card-title"},{default:l(()=>[o("Game Controls")]),_:1}),n(h,{class:"control-row"},{default:l(()=>[n(g,{class:"label"},{default:l(()=>[o("Entry Fee")]),_:1}),n(z,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),type:"digit",placeholder:"0.5",class:"fee-input"},null,8,["modelValue"]),n(g,{class:"label"},{default:l(()=>[o("GAS")]),_:1})]),_:1}),n(h,{class:"action-btn",onClick:T,style:m({opacity:_(w)||G.value?.6:1})},{default:l(()=>[n(g,null,{default:l(()=>[o(f(G.value?"Game Active":_(w)?"Starting...":"Start Hunt"),1)]),_:1})]),_:1},8,["style"])]),_:1}),n(h,{class:"card"},{default:l(()=>[n(g,{class:"card-title"},{default:l(()=>[o("Legend")]),_:1}),n(h,{class:"legend-list"},{default:l(()=>[n(h,{class:"legend-item"},{default:l(()=>[n(g,{class:"legend-icon treasure"},{default:l(()=>[o("ðŸ’Ž")]),_:1}),n(g,{class:"legend-text"},{default:l(()=>[o("Treasure (+0.5 GAS)")]),_:1})]),_:1}),n(h,{class:"legend-item"},{default:l(()=>[n(g,{class:"legend-icon hint"},{default:l(()=>[o("ðŸ’¡")]),_:1}),n(g,{class:"legend-text"},{default:l(()=>[o("Hint (nearby treasure)")]),_:1})]),_:1}),n(h,{class:"legend-item"},{default:l(()=>[n(g,{class:"legend-icon trap"},{default:l(()=>[o("ðŸ’¥")]),_:1}),n(g,{class:"legend-text"},{default:l(()=>[o("Trap (game over)")]),_:1})]),_:1}),n(h,{class:"legend-item"},{default:l(()=>[n(g,{class:"legend-icon empty"},{default:l(()=>[o("Â·")]),_:1}),n(g,{class:"legend-text"},{default:l(()=>[o("Empty space")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-58563e41"]]);export{h as default};
