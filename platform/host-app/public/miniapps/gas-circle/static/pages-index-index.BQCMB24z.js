import{r as e,d as a,c as l,w as t,i as s,a as u,o as n,b as o,e as i,f as r,g as d,n as c,t as f,u as p}from"./index-DZoUfoBX.js";function v(a){const l=e(!1),t=e(null);return{isLoading:l,error:t,payGAS:async(e,s)=>{l.value=!0,t.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},e),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await l.payments.payGAS(a,e,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}const m="0.005",_=((e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l})(a({__name:"index",setup(a){const{payGAS:_,isLoading:w}=v("miniapp-gas-circle"),y=e({members:8,maxMembers:12,contribution:50,nextPayout:"3 days"}),b=e({position:5,contributed:50,received:!1}),S=e("50"),g=e("12"),A=e(null),h=async()=>{if(w.value)return;const e=parseFloat(S.value),a=parseInt(g.value,10);if(e>0&&a>=3&&a<=24)try{await _(m,`circle:join:${e}:${a}`),A.value={msg:`Joined circle (${e} GAS/month)`,type:"success"}}catch(l){A.value={msg:(null==l?void 0:l.message)||"Payment failed",type:"error"}}else A.value={msg:"Invalid parameters",type:"error"}};return(e,a)=>{const v=r,_=s,G=u("uni-easyinput");return n(),l(_,{class:"app-container"},{default:t(()=>[o(_,{class:"header"},{default:t(()=>[o(v,{class:"title"},{default:t(()=>[d("GAS Circle")]),_:1}),o(v,{class:"subtitle"},{default:t(()=>[d("Rotating savings group")]),_:1})]),_:1}),A.value?(n(),l(_,{key:0,class:c(["status-msg",A.value.type])},{default:t(()=>[o(v,null,{default:t(()=>[d(f(A.value.msg),1)]),_:1})]),_:1},8,["class"])):i("",!0),o(_,{class:"card"},{default:t(()=>[o(v,{class:"card-title"},{default:t(()=>[d("Active Circle")]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[d("Members")]),_:1}),o(v,{class:"v"},{default:t(()=>[d(f(y.value.members)+"/"+f(y.value.maxMembers),1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[d("Contribution")]),_:1}),o(v,{class:"v"},{default:t(()=>[d(f(y.value.contribution)+" GAS",1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[d("Next payout")]),_:1}),o(v,{class:"v"},{default:t(()=>[d(f(y.value.nextPayout),1)]),_:1})]),_:1})]),_:1}),o(_,{class:"card"},{default:t(()=>[o(v,{class:"card-title"},{default:t(()=>[d("Your Status")]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[d("Position")]),_:1}),o(v,{class:"v"},{default:t(()=>[d("#"+f(b.value.position),1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[d("Contributed")]),_:1}),o(v,{class:"v"},{default:t(()=>[d(f(b.value.contributed)+"/"+f(y.value.contribution)+" GAS",1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[d("Received")]),_:1}),o(v,{class:"v"},{default:t(()=>[d(f(b.value.received?"Yes":"Pending"),1)]),_:1})]),_:1})]),_:1}),o(_,{class:"card"},{default:t(()=>[o(v,{class:"card-title"},{default:t(()=>[d("Join Circle")]),_:1}),o(G,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),type:"number",placeholder:"Monthly contribution (GAS)"},null,8,["modelValue"]),o(G,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),type:"number",placeholder:"Duration (months)"},null,8,["modelValue"]),o(_,{class:"action-btn",onClick:h},{default:t(()=>[o(v,null,{default:t(()=>[d(f(p(w)?"Processing...":"Join Circle"),1)]),_:1})]),_:1}),o(v,{class:"note"},{default:t(()=>[d("Mock setup fee: "+f(m)+" GAS")]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-60ecbad7"]]);export{_ as default};
