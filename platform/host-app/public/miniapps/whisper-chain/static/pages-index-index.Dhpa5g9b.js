import{r as a,d as e,c as s,w as t,i as n,a as i,o as l,b as u,e as o,f as r,g as d,n as c,t as h,h as m,F as p,j as f,u as g}from"./index-C1hzQiUv.js";function w(a=5e3){return new Promise((e,s)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const t=setTimeout(()=>{s(new Error("SDK timeout"))},a),n=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",n),window.MiniAppSDK?e(window.MiniAppSDK):s(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",n)})}const v="miniapp-whisperchain",_=((a,e)=>{const s=a.__vccOpts||a;for(const[t,n]of e)s[t]=n;return s})(e({__name:"index",setup(e){const{payGAS:_,isLoading:y}=function(e){const s=a(!1),t=a(null);return{isLoading:s,error:t,payGAS:async(a,n)=>{s.value=!0,t.value=null;try{const s=await w();return await s.payments.payGAS(e,a,n)}catch(i){throw t.value=i,i}finally{s.value=!1}}}}(v),{generateRandom:S}=function(e){const s=a(!1),t=a(null);return{isLoading:s,error:t,requestRandom:async()=>{s.value=!0,t.value=null;try{const a=await w();return await a.rng.requestRandom(e)}catch(a){throw t.value=a,a}finally{s.value=!1}}}}(v),A=a(""),D=a(null),b=a([{id:"1",author:"7342",message:"The truth is out there...",hops:5,time:"2h ago"},{id:"2",author:"9128",message:"Follow the white rabbit",hops:3,time:"1h ago"},{id:"3",author:"4567",message:"Nothing is as it seems",hops:1,time:"30m ago"}]),K=async()=>{if(A.value.trim()&&!y.value)try{const a=await S(1e3,9999);await _("0.3",`chain:${A.value.slice(0,20)}`),b.value.push({id:Date.now().toString(),author:a.toString(),message:A.value,hops:0,time:"Just now"}),D.value={msg:"Message added to chain!",type:"success"},A.value=""}catch(a){D.value={msg:a.message||"Error",type:"error"}}};return(a,e)=>{const w=r,v=n,_=i("uni-easyinput");return l(),s(v,{class:"app-container"},{default:t(()=>[u(v,{class:"header"},{default:t(()=>[u(w,{class:"title"},{default:t(()=>[d("Whisper Chain")]),_:1}),u(w,{class:"subtitle"},{default:t(()=>[d("Anonymous messaging")]),_:1})]),_:1}),D.value?(l(),s(v,{key:0,class:c(["status-msg",D.value.type])},{default:t(()=>[u(w,null,{default:t(()=>[d(h(D.value.msg),1)]),_:1})]),_:1},8,["class"])):o("",!0),u(v,{class:"card"},{default:t(()=>[u(w,{class:"card-title"},{default:t(()=>[d("Message Chain")]),_:1}),(l(!0),m(p,null,f(b.value,a=>(l(),s(v,{key:a.id,class:"chain-item"},{default:t(()=>[u(v,{class:"chain-header"},{default:t(()=>[u(w,{class:"chain-author"},{default:t(()=>[d("Anonymous #"+h(a.author),1)]),_:2},1024),u(w,{class:"chain-time"},{default:t(()=>[d(h(a.time),1)]),_:2},1024)]),_:2},1024),u(w,{class:"chain-message"},{default:t(()=>[d(h(a.message),1)]),_:2},1024),u(w,{class:"chain-hops"},{default:t(()=>[d(h(a.hops)+" hops",1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),u(v,{class:"card"},{default:t(()=>[u(w,{class:"card-title"},{default:t(()=>[d("Add to Chain")]),_:1}),u(_,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),placeholder:"Your anonymous message..."},null,8,["modelValue"]),u(v,{class:"action-btn",onClick:K},{default:t(()=>[u(w,null,{default:t(()=>[d(h(g(y)?"Sending...":"Add to Chain"),1)]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-589b5853"]]);export{_ as default};
