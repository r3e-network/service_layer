import{r as e,d as a,c as l,w as t,i as s,a as u,o as n,b as r,e as o,f as d,g as i,n as c,t as p,h as f,F as v,j as _,k as m,u as w}from"./index-D7BE_9AY.js";function y(a){const l=e(!1),t=e(null);return{isLoading:l,error:t,payGAS:async(e,s)=>{l.value=!0,t.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},e),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await l.payments.payGAS(a,e,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}const g=((e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l})(a({__name:"index",setup(a){const{payGAS:g,isLoading:b}=y("miniapp-gov-merc"),h=e("100"),V=e("0.5"),k=e(24),S=e(1e3),x=e(12.5),A=e(2),L=e(null),R=[{hours:6,label:"6h"},{hours:24,label:"24h"},{hours:72,label:"3d"},{hours:168,label:"7d"}],E=e([{id:1,power:500,price:2.5,duration:"24h",owner:"0x1a2b...3c4d"},{id:2,power:1e3,price:4,duration:"3d",owner:"0x5e6f...7g8h"}]),K=e=>function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,1),M=async()=>{if(b.value)return;if(parseFloat(h.value)<10)L.value={msg:"Min: 10 VP",type:"error"};else try{L.value={msg:"Listing votes...",type:"loading"},await g("0.1",`list:${h.value}:${V.value}:${k.value}`),A.value++,L.value={msg:"Listed successfully!",type:"success"}}catch(e){L.value={msg:e.message||"Error",type:"error"}}};return(e,a)=>{const y=d,D=s,P=u("uni-easyinput");return n(),l(D,{class:"app-container"},{default:t(()=>[r(D,{class:"header"},{default:t(()=>[r(y,{class:"title"},{default:t(()=>[i("Vote Mercenary")]),_:1}),r(y,{class:"subtitle"},{default:t(()=>[i("Rent your voting power")]),_:1})]),_:1}),L.value?(n(),l(D,{key:0,class:c(["status-msg",L.value.type])},{default:t(()=>[r(y,null,{default:t(()=>[i(p(L.value.msg),1)]),_:1})]),_:1},8,["class"])):o("",!0),r(D,{class:"card"},{default:t(()=>[r(D,{class:"stats-grid"},{default:t(()=>[r(D,{class:"stat-box"},{default:t(()=>[r(y,{class:"stat-value"},{default:t(()=>[i(p(K(S.value)),1)]),_:1}),r(y,{class:"stat-label"},{default:t(()=>[i("Your VP")]),_:1})]),_:1}),r(D,{class:"stat-box"},{default:t(()=>[r(y,{class:"stat-value"},{default:t(()=>[i(p(K(x.value)),1)]),_:1}),r(y,{class:"stat-label"},{default:t(()=>[i("Earned")]),_:1})]),_:1}),r(D,{class:"stat-box"},{default:t(()=>[r(y,{class:"stat-value"},{default:t(()=>[i(p(A.value),1)]),_:1}),r(y,{class:"stat-label"},{default:t(()=>[i("Rentals")]),_:1})]),_:1})]),_:1})]),_:1}),r(D,{class:"card"},{default:t(()=>[r(y,{class:"card-title"},{default:t(()=>[i("Rent Out Your Votes")]),_:1}),r(P,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e),type:"number",placeholder:"Voting power to rent"},null,8,["modelValue"]),r(P,{modelValue:V.value,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value=e),type:"number",placeholder:"Price per vote (GAS)"},null,8,["modelValue"]),r(D,{class:"duration-row"},{default:t(()=>[(n(),f(v,null,_(R,e=>r(D,{key:e.hours,class:c(["duration-btn",k.value===e.hours&&"active"]),onClick:a=>k.value=e.hours},{default:t(()=>[r(y,null,{default:t(()=>[i(p(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),64))]),_:1}),r(D,{class:"list-btn",onClick:M,style:m({opacity:w(b)?.6:1})},{default:t(()=>[r(y,null,{default:t(()=>[i(p(w(b)?"Listing...":"List for Rent"),1)]),_:1})]),_:1},8,["style"])]),_:1}),r(D,{class:"card"},{default:t(()=>[r(y,{class:"card-title"},{default:t(()=>[i("Available Rentals")]),_:1}),r(D,{class:"rentals-list"},{default:t(()=>[0===E.value.length?(n(),l(y,{key:0,class:"empty"},{default:t(()=>[i("No rentals available")]),_:1})):o("",!0),(n(!0),f(v,null,_(E.value,(e,a)=>(n(),l(D,{key:a,class:"rental-item"},{default:t(()=>[r(D,{class:"rental-header"},{default:t(()=>[r(y,{class:"rental-power"},{default:t(()=>[i(p(e.power)+" VP",1)]),_:2},1024),r(y,{class:"rental-price"},{default:t(()=>[i(p(e.price)+" GAS",1)]),_:2},1024)]),_:2},1024),r(D,{class:"rental-meta"},{default:t(()=>[r(y,{class:"rental-duration"},{default:t(()=>[i(p(e.duration),1)]),_:2},1024),r(y,{class:"rental-owner"},{default:t(()=>[i(p(e.owner),1)]),_:2},1024)]),_:2},1024),r(D,{class:"rent-btn",onClick:a=>(async e=>{try{L.value={msg:"Renting votes...",type:"loading"};const a=E.value.find(a=>a.id===e);a&&(await g(String(a.price),`rent:${e}`),S.value+=a.power,L.value={msg:`Rented ${a.power} VP!`,type:"success"})}catch(a){L.value={msg:a.message||"Error",type:"error"}}})(e.id)},{default:t(()=>[r(y,null,{default:t(()=>[i("Rent Now")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-afe45b4e"]]);export{g as default};
