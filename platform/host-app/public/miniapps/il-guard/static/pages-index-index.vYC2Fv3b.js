import{r as e,d as a,c as l,w as t,i as s,a as u,o as n,b as o,e as r,f as d,g as i,n as c,t as f,u as p}from"./index-C9-Q059R.js";function v(a){const l=e(!1),t=e(null);return{isLoading:l,error:t,payGAS:async(e,s)=>{l.value=!0,t.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},e),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await l.payments.payGAS(a,e,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}const _=((e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l})(a({__name:"index",setup(a){const{payGAS:_,isLoading:m}=v("miniapp-il-guard"),w=e({pair:"NEO/GAS",tvl:125e3,ilRisk:8.3}),A=e({deposited:1e3,currentValue:917,ilAmount:83}),y=e(""),S=e(null),g=(e,a=2)=>function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,a),G=async()=>{if(m.value)return;const e=parseFloat(y.value);if(!(e>0&&e<=A.value.deposited))return void(S.value={msg:`Enter 0.01-${A.value.deposited}`,type:"error"});const a=(.02*e).toFixed(3);try{await _(a,`ilguard:${w.value.pair}:${e}`),S.value={msg:`IL protection activated for ${g(e,2)} GAS`,type:"success"}}catch(l){S.value={msg:(null==l?void 0:l.message)||"Payment failed",type:"error"}}};return(e,a)=>{const v=d,_=s,L=u("uni-easyinput");return n(),l(_,{class:"app-container"},{default:t(()=>[o(_,{class:"header"},{default:t(()=>[o(v,{class:"title"},{default:t(()=>[i("IL Guard")]),_:1}),o(v,{class:"subtitle"},{default:t(()=>[i("Impermanent loss protection")]),_:1})]),_:1}),S.value?(n(),l(_,{key:0,class:c(["status-msg",S.value.type])},{default:t(()=>[o(v,null,{default:t(()=>[i(f(S.value.msg),1)]),_:1})]),_:1},8,["class"])):r("",!0),o(_,{class:"card"},{default:t(()=>[o(v,{class:"card-title"},{default:t(()=>[i("Pool Info")]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[i("Pair")]),_:1}),o(v,{class:"v"},{default:t(()=>[i(f(w.value.pair),1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[i("TVL")]),_:1}),o(v,{class:"v"},{default:t(()=>[i(f(g(w.value.tvl,0))+" GAS",1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[i("IL Risk")]),_:1}),o(v,{class:"v risk"},{default:t(()=>[i(f(w.value.ilRisk)+"%",1)]),_:1})]),_:1})]),_:1}),o(_,{class:"card"},{default:t(()=>[o(v,{class:"card-title"},{default:t(()=>[i("Your Position")]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[i("Deposited")]),_:1}),o(v,{class:"v"},{default:t(()=>[i(f(g(A.value.deposited,2))+" GAS",1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[i("Current value")]),_:1}),o(v,{class:"v"},{default:t(()=>[i(f(g(A.value.currentValue,2))+" GAS",1)]),_:1})]),_:1}),o(_,{class:"row"},{default:t(()=>[o(v,null,{default:t(()=>[i("IL Amount")]),_:1}),o(v,{class:"v loss"},{default:t(()=>[i("-"+f(g(A.value.ilAmount,2))+" GAS",1)]),_:1})]),_:1})]),_:1}),o(_,{class:"card"},{default:t(()=>[o(v,{class:"card-title"},{default:t(()=>[i("Activate Protection")]),_:1}),o(L,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),type:"number",placeholder:"Amount to protect"},null,8,["modelValue"]),o(_,{class:"fee-row"},{default:t(()=>[o(v,null,{default:t(()=>[i("Protection fee (2%)")]),_:1}),o(v,{class:"fee"},{default:t(()=>[i(f((.02*parseFloat(y.value||"0")).toFixed(3))+" GAS",1)]),_:1})]),_:1}),o(_,{class:"action-btn",onClick:G},{default:t(()=>[o(v,null,{default:t(()=>[i(f(p(m)?"Processing...":"Activate IL Guard"),1)]),_:1})]),_:1}),o(v,{class:"note"},{default:t(()=>[i("Coverage: 90% of IL up to "+f(y.value||"0")+" GAS",1)]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-b962d8e7"]]);export{_ as default};
