import{r as e,d as a,c as l,w as t,i as s,a as o,o as u,b as r,e as n,f as d,g as c,n as i,t as f,u as p}from"./index-D8abM2oU.js";function _(a){const l=e(!1),t=e(null);return{isLoading:l,error:t,payGAS:async(e,s)=>{l.value=!0,t.value=null;try{const l=await function(e=5e3){return new Promise((a,l)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},e),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await l.payments.payGAS(a,e,s)}catch(o){throw t.value=o,o}finally{l.value=!1}}}}const m=((e,a)=>{const l=e.__vccOpts||e;for(const[t,s]of a)l[t]=s;return l})(a({__name:"index",setup(a){const{payGAS:m,isLoading:w}=_("miniapp-self-loan"),v=e({maxBorrow:5e3,interestRate:8.5,repaymentSchedule:"Monthly"}),y=e({borrowed:0,collateralLocked:0,nextPayment:0,nextPaymentDue:"N/A"}),S=e(""),A=e(null),x=(e,a=2)=>function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,a),b=async()=>{if(w.value)return;const e=parseFloat(S.value);if(!(e>0&&e<=v.value.maxBorrow))return void(A.value={msg:`Enter 1-${v.value.maxBorrow}`,type:"error"});const a=(1.5*e).toFixed(2);try{await m("0.015",`selfloan:borrow:${e}:collateral:${a}`),A.value={msg:`Loan approved: ${x(e,2)} GAS borrowed`,type:"success"}}catch(l){A.value={msg:(null==l?void 0:l.message)||"Payment failed",type:"error"}}};return(e,a)=>{const _=d,m=s,g=o("uni-easyinput");return u(),l(m,{class:"app-container"},{default:t(()=>[r(m,{class:"header"},{default:t(()=>[r(_,{class:"title"},{default:t(()=>[c("Self Loan")]),_:1}),r(_,{class:"subtitle"},{default:t(()=>[c("Borrow against future deposits")]),_:1})]),_:1}),A.value?(u(),l(m,{key:0,class:i(["status-msg",A.value.type])},{default:t(()=>[r(_,null,{default:t(()=>[c(f(A.value.msg),1)]),_:1})]),_:1},8,["class"])):n("",!0),r(m,{class:"card"},{default:t(()=>[r(_,{class:"card-title"},{default:t(()=>[c("Loan Terms")]),_:1}),r(m,{class:"row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Max borrow")]),_:1}),r(_,{class:"v"},{default:t(()=>[c(f(x(v.value.maxBorrow,0))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Interest rate")]),_:1}),r(_,{class:"v"},{default:t(()=>[c(f(v.value.interestRate)+"% APR",1)]),_:1})]),_:1}),r(m,{class:"row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Repayment")]),_:1}),r(_,{class:"v"},{default:t(()=>[c(f(v.value.repaymentSchedule),1)]),_:1})]),_:1})]),_:1}),r(m,{class:"card"},{default:t(()=>[r(_,{class:"card-title"},{default:t(()=>[c("Your Loan")]),_:1}),r(m,{class:"row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Borrowed")]),_:1}),r(_,{class:"v"},{default:t(()=>[c(f(x(y.value.borrowed,2))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Collateral locked")]),_:1}),r(_,{class:"v"},{default:t(()=>[c(f(x(y.value.collateralLocked,2))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Next payment")]),_:1}),r(_,{class:"v"},{default:t(()=>[c(f(x(y.value.nextPayment,2))+" GAS in "+f(y.value.nextPaymentDue),1)]),_:1})]),_:1})]),_:1}),r(m,{class:"card"},{default:t(()=>[r(_,{class:"card-title"},{default:t(()=>[c("Take Self-Loan")]),_:1}),r(g,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),type:"number",placeholder:"Amount to borrow"},null,8,["modelValue"]),r(m,{class:"detail-row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Collateral required (150%)")]),_:1}),r(_,{class:"collateral"},{default:t(()=>[c(f(x(1.5*parseFloat(S.value||"0"),2))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"detail-row"},{default:t(()=>[r(_,null,{default:t(()=>[c("Monthly payment")]),_:1}),r(_,{class:"payment"},{default:t(()=>[c(f(x(.085*parseFloat(S.value||"0"),3))+" GAS",1)]),_:1})]),_:1}),r(m,{class:"action-btn",onClick:b},{default:t(()=>[r(_,null,{default:t(()=>[c(f(p(w)?"Processing...":"Borrow Now"),1)]),_:1})]),_:1}),r(_,{class:"note"},{default:t(()=>[c("12-month term. Auto-deduct from future deposits.")]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-ef1db7cf"]]);export{m as default};
