import{r as a,d as e,c as l,w as t,i as s,a as u,o as n,b as o,e as c,f as i,g as r,n as d,t as v,h as f}from"./index-CHhzGqgx.js";function p(a=5e3){return new Promise((e,l)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},a),s=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?e(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}const _="miniapp-coinflip",m=((a,e)=>{const l=a.__vccOpts||a;for(const[t,s]of e)l[t]=s;return l})(e({__name:"index",setup(e){const{payGAS:m}=function(e){const l=a(!1),t=a(null);return{isLoading:l,error:t,payGAS:async(a,s)=>{l.value=!0,t.value=null;try{const l=await p();return await l.payments.payGAS(e,a,s)}catch(u){throw t.value=u,u}finally{l.value=!1}}}}(_),{requestRandom:w}=function(e){const l=a(!1),t=a(null);return{isLoading:l,error:t,requestRandom:async()=>{l.value=!0,t.value=null;try{const a=await p();return await a.rng.requestRandom(e)}catch(a){throw t.value=a,a}finally{l.value=!1}}}}(_),y=a("1"),h=a("heads"),b=a(0),g=a(0),S=a(0),A=a(!1),k=a(null),x=a(null),F=async()=>{if(A.value)return;const a=parseFloat(y.value);if(a<.1)k.value={msg:"Min bet: 0.1 GAS",type:"error"};else{A.value=!0,x.value=null;try{await m(y.value,`coinflip:${h.value}`);const e=await w(),l=parseInt(e.randomness.slice(0,2),16)%2==0?"heads":"tails",t=l===h.value;x.value={won:t,outcome:l.toUpperCase()},t?(b.value++,S.value+=a,k.value={msg:`Won ${2*a} GAS!`,type:"success"}):(g.value++,k.value={msg:"Better luck next time",type:"error"})}catch(e){k.value={msg:e.message||"Error",type:"error"}}finally{A.value=!1}}};return(a,e)=>{const p=i,_=s,m=u("uni-easyinput");return n(),l(_,{class:"app-container"},{default:t(()=>[o(_,{class:"header"},{default:t(()=>[o(p,{class:"title"},{default:t(()=>[r("Coin Flip")]),_:1}),o(p,{class:"subtitle"},{default:t(()=>[r("50/50 chance to double")]),_:1})]),_:1}),k.value?(n(),l(_,{key:0,class:d(["status-msg",k.value.type])},{default:t(()=>[o(p,null,{default:t(()=>[r(v(k.value.msg),1)]),_:1})]),_:1},8,["class"])):c("",!0),o(_,{class:"card"},{default:t(()=>[o(_,{class:"stats-row"},{default:t(()=>[o(_,{class:"stat"},{default:t(()=>[o(p,{class:"stat-value"},{default:t(()=>[r(v(b.value),1)]),_:1}),o(p,{class:"stat-label"},{default:t(()=>[r("Wins")]),_:1})]),_:1}),o(_,{class:"stat"},{default:t(()=>[o(p,{class:"stat-value"},{default:t(()=>[r(v(g.value),1)]),_:1}),o(p,{class:"stat-label"},{default:t(()=>[r("Losses")]),_:1})]),_:1}),o(_,{class:"stat"},{default:t(()=>[o(p,{class:"stat-value"},{default:t(()=>{return[r(v((a=S.value,function(a,e=2){return a>=1e6?(a/1e6).toFixed(e)+"M":a>=1e3?(a/1e3).toFixed(e)+"K":a.toFixed(e)}(a,2))),1)];var a}),_:1}),o(p,{class:"stat-label"},{default:t(()=>[r("Won")]),_:1})]),_:1})]),_:1})]),_:1}),o(_,{class:"card"},{default:t(()=>[o(p,{class:"card-title"},{default:t(()=>[r("Place Bet")]),_:1}),o(m,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),type:"number",placeholder:"Bet amount (GAS)"},null,8,["modelValue"]),o(_,{class:"choice-row"},{default:t(()=>[o(_,{class:d(["choice-btn","heads"===h.value&&"active"]),onClick:e[1]||(e[1]=a=>h.value="heads")},{default:t(()=>[o(p,null,{default:t(()=>[r("ðŸª™ Heads")]),_:1})]),_:1},8,["class"]),o(_,{class:d(["choice-btn","tails"===h.value&&"active"]),onClick:e[2]||(e[2]=a=>h.value="tails")},{default:t(()=>[o(p,null,{default:t(()=>[r("ðŸ”´ Tails")]),_:1})]),_:1},8,["class"])]),_:1}),o(_,{class:"flip-btn",onClick:F,style:f({opacity:A.value?.6:1})},{default:t(()=>[o(p,null,{default:t(()=>[r(v(A.value?"Flipping...":"Flip Coin"),1)]),_:1})]),_:1},8,["style"])]),_:1}),x.value?(n(),l(_,{key:1,class:"result-card"},{default:t(()=>[o(p,{class:"result-text"},{default:t(()=>[r(v(x.value.won?"ðŸŽ‰ You Won!":"ðŸ˜¢ You Lost"),1)]),_:1}),o(p,{class:"result-outcome"},{default:t(()=>[r(v(x.value.outcome),1)]),_:1})]),_:1})):c("",!0)]),_:1})}}}),[["__scopeId","data-v-7c8603b2"]]);export{m as default};
