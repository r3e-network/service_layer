import{r as e,d as a,c as t,w as l,i as s,a as o,o as u,b as i,e as d,f as n,g as r,n as c,t as f,u as p}from"./index-BP7AS605.js";function _(a){const t=e(!1),l=e(null);return{isLoading:t,error:l,payGAS:async(e,s)=>{t.value=!0,l.value=null;try{const t=await function(e=5e3){return new Promise((a,t)=>{if(window.MiniAppSDK)return void a(window.MiniAppSDK);const l=setTimeout(()=>{t(new Error("SDK timeout"))},e),s=()=>{clearTimeout(l),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?a(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}();return await t.payments.payGAS(a,e,s)}catch(o){throw l.value=o,o}finally{t.value=!1}}}}const v=((e,a)=>{const t=e.__vccOpts||e;for(const[l,s]of a)t[l]=s;return t})(a({__name:"index",setup(a){const{payGAS:v,isLoading:w}=_("miniapp-no-loss-lottery"),m=e({totalDeposits:85e4,prizePool:127.5,nextDraw:"2d 14h"}),y=e({deposit:500,tickets:50,yieldSacrificed:.875}),S=e(""),A=e(null),D=(e,a=2)=>function(e,a=2){return e>=1e6?(e/1e6).toFixed(a)+"M":e>=1e3?(e/1e3).toFixed(a)+"K":e.toFixed(a)}(e,a),k=async()=>{if(w.value)return;const e=parseFloat(S.value);if(e>=10)try{await v(e.toFixed(2),`noloss:deposit:${e}`);const a=Math.floor(e/10);A.value={msg:`Deposited ${D(e,2)} GAS, earned ${a} tickets`,type:"success"}}catch(a){A.value={msg:(null==a?void 0:a.message)||"Payment failed",type:"error"}}else A.value={msg:"Minimum deposit: 10 GAS",type:"error"}};return(e,a)=>{const _=n,v=s,g=o("uni-easyinput");return u(),t(v,{class:"app-container"},{default:l(()=>[i(v,{class:"header"},{default:l(()=>[i(_,{class:"title"},{default:l(()=>[r("No-Loss Lottery")]),_:1}),i(_,{class:"subtitle"},{default:l(()=>[r("Prize savings account")]),_:1})]),_:1}),A.value?(u(),t(v,{key:0,class:c(["status-msg",A.value.type])},{default:l(()=>[i(_,null,{default:l(()=>[r(f(A.value.msg),1)]),_:1})]),_:1},8,["class"])):d("",!0),i(v,{class:"card"},{default:l(()=>[i(_,{class:"card-title"},{default:l(()=>[r("Pool Stats")]),_:1}),i(v,{class:"row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Total deposits")]),_:1}),i(_,{class:"v"},{default:l(()=>[r(f(D(m.value.totalDeposits,0))+" GAS",1)]),_:1})]),_:1}),i(v,{class:"row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Prize pool")]),_:1}),i(_,{class:"v"},{default:l(()=>[r(f(D(m.value.prizePool,2))+" GAS",1)]),_:1})]),_:1}),i(v,{class:"row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Next draw")]),_:1}),i(_,{class:"v"},{default:l(()=>[r(f(m.value.nextDraw),1)]),_:1})]),_:1})]),_:1}),i(v,{class:"card"},{default:l(()=>[i(_,{class:"card-title"},{default:l(()=>[r("Your Stats")]),_:1}),i(v,{class:"row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Deposit")]),_:1}),i(_,{class:"v"},{default:l(()=>[r(f(D(y.value.deposit,2))+" GAS",1)]),_:1})]),_:1}),i(v,{class:"row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Tickets")]),_:1}),i(_,{class:"v"},{default:l(()=>[r(f(y.value.tickets),1)]),_:1})]),_:1}),i(v,{class:"row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Yield sacrificed")]),_:1}),i(_,{class:"v"},{default:l(()=>[r(f(D(y.value.yieldSacrificed,3))+" GAS",1)]),_:1})]),_:1})]),_:1}),i(v,{class:"card"},{default:l(()=>[i(_,{class:"card-title"},{default:l(()=>[r("Join Lottery")]),_:1}),i(g,{modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value=e),type:"number",placeholder:"Amount to deposit"},null,8,["modelValue"]),i(v,{class:"info-row"},{default:l(()=>[i(_,null,{default:l(()=>[r("Tickets earned")]),_:1}),i(_,{class:"tickets"},{default:l(()=>[r(f(Math.floor(parseFloat(S.value||"0")/10)),1)]),_:1})]),_:1}),i(v,{class:"action-btn",onClick:k},{default:l(()=>[i(_,null,{default:l(()=>[r(f(p(w)?"Processing...":"Deposit & Get Tickets"),1)]),_:1})]),_:1}),i(_,{class:"note"},{default:l(()=>[r("1 ticket per 10 GAS. Principal always withdrawable.")]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-adcd65bb"]]);export{v as default};
