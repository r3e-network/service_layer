import{r as a,o as e,d as l,c as t,a as n,w as s,i as o,b as u,e as c,f as i,g as d,h as r,t as v,I as f,j as p,n as w,k as m,l as b,F as y,m as _}from"./index-esAzSt0N.js";function k(){return window.MiniAppSDK??null}const h="https://api.neo-service-layer.io";function g(){const l=a(null),t=a({GAS:"0",NEO:"0"}),n=a(!1),s=a(!1),o=a(null);return e(()=>{const a=k();a&&a.wallet.getAddress().then(a=>{l.value=a,n.value=!0}).catch(()=>{})}),{address:l,balances:t,isConnected:n,isLoading:s,error:o,connect:async()=>{s.value=!0,o.value=null;try{const a=await function(a=5e3){return new Promise((e,l)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const t=setTimeout(()=>{l(new Error("SDK timeout"))},a),n=()=>{clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",n),window.MiniAppSDK?e(window.MiniAppSDK):l(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",n)})}();l.value=await a.wallet.getAddress(),n.value=!0}catch(a){o.value=a}finally{s.value=!1}},invokeIntent:async a=>{var e;const l=k();if(!(null==(e=null==l?void 0:l.wallet)?void 0:e.invokeIntent))throw new Error("invokeIntent not available");return l.wallet.invokeIntent(a)},getBalance:async()=>{var a;s.value=!0,o.value=null;try{const e=await fetch(`${h}/wallet-balance`,{method:"GET",credentials:"include"});if(!e.ok){const l=await e.json();throw new Error((null==(a=l.error)?void 0:a.message)||"Failed to get balance")}const l=await e.json();return t.value=l.balances,l.balances}catch(e){throw o.value=e,e}finally{s.value=!1}},getTransactions:async(a=20)=>{var e;s.value=!0,o.value=null;try{const l=await fetch(`${h}/wallet-transactions?limit=${a}`,{method:"GET",credentials:"include"});if(!l.ok){const a=await l.json();throw new Error((null==(e=a.error)?void 0:e.message)||"Failed to get transactions")}return(await l.json()).transactions}catch(l){throw o.value=l,l}finally{s.value=!1}}}}const S=((a,e)=>{const l=a.__vccOpts||a;for(const[t,n]of e)l[t]=n;return l})(l({__name:"index",setup(l){const{getAddress:k,invokeContract:h,getBalance:S}=g(),E=[{symbol:"NEO",icon:"ðŸ’š",hash:"0xef4073a0f2b305a38ec4050e4d3d28bc40ea63f5",balance:0,decimals:0},{symbol:"GAS",icon:"â›½",hash:"0xd2a4cff31913016155e38e474a2c06d08be276cf",balance:0,decimals:8}],F=a({...E[0]}),A=a({...E[1]}),x=a(""),C=a(""),I=a(""),T=a(!1),D=a(null),K=a(!1),M=a("from"),$=t(()=>E),j=t(()=>{const a=parseFloat(x.value);return a>0&&a<=F.value.balance}),G=t(()=>T.value?"Swapping...":x.value?parseFloat(x.value)>F.value.balance?"Insufficient balance":`Swap ${F.value.symbol} â†’ ${A.value.symbol}`:"Enter amount");function O(a){return a.toFixed(4)}function V(a,e){D.value={msg:a,type:e},setTimeout(()=>D.value=null,5e3)}async function N(){try{const a=await S("NEO"),e=await S("GAS");E[0].balance=a||0,E[1].balance=e||0,F.value={...E[0]},A.value={...E[1]}}catch(a){console.error("Failed to load balances:",a)}}async function B(){const a="NEO"===F.value.symbol?"8.5":"0.118";I.value=a}function H(){const a=parseFloat(x.value)||0,e=parseFloat(I.value)||0;C.value=(a*e).toFixed(4)}function L(){const a=F.value;F.value=A.value,A.value=a,x.value="",C.value="",B()}function U(){M.value="from",K.value=!0}function P(){M.value="to",K.value=!0}function R(){K.value=!1}async function q(){if(j.value&&!T.value){T.value=!0;try{const a=parseFloat(x.value),e=F.value.decimals,l=Math.floor(a*Math.pow(10,e));await h({scriptHash:"0xf970f4ccecd765b63732b821775dc38c25d74f23",operation:"swap",args:[{type:"Hash160",value:await k()},{type:"Hash160",value:F.value.hash},{type:"Hash160",value:A.value.hash},{type:"Integer",value:l},{type:"Integer",value:0}]}),V(`Swapped ${a} ${F.value.symbol}!`,"success"),x.value="",C.value="",await N()}catch(a){V(a.message||"Swap failed","error")}finally{T.value=!1}}}return e(()=>{N(),B()}),(a,e)=>{const l=d,t=o,k=f,h=p;return u(),n(t,{class:"container"},{default:s(()=>[c(t,{class:"header"},{default:s(()=>[c(l,{class:"title"},{default:s(()=>[r("Flamingo Swap")]),_:1}),c(l,{class:"subtitle"},{default:s(()=>[r("Swap NEO â†” GAS instantly")]),_:1})]),_:1}),c(t,{class:"swap-card"},{default:s(()=>[c(t,{class:"token-section"},{default:s(()=>[c(l,{class:"section-label"},{default:s(()=>[r("From")]),_:1}),c(t,{class:"token-row"},{default:s(()=>[c(t,{class:"token-select",onClick:U},{default:s(()=>[c(l,{class:"token-icon"},{default:s(()=>[r(v(F.value.icon),1)]),_:1}),c(l,{class:"token-symbol"},{default:s(()=>[r(v(F.value.symbol),1)]),_:1}),c(l,{class:"dropdown-arrow"},{default:s(()=>[r("â–¼")]),_:1})]),_:1}),c(k,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),type:"digit",placeholder:"0.0",class:"amount-input",onInput:H},null,8,["modelValue"])]),_:1}),c(l,{class:"balance-text"},{default:s(()=>[r("Balance: "+v(O(F.value.balance)),1)]),_:1})]),_:1}),c(t,{class:"swap-direction",onClick:L},{default:s(()=>[c(l,{class:"swap-icon"},{default:s(()=>[r("â‡…")]),_:1})]),_:1}),c(t,{class:"token-section"},{default:s(()=>[c(l,{class:"section-label"},{default:s(()=>[r("To")]),_:1}),c(t,{class:"token-row"},{default:s(()=>[c(t,{class:"token-select",onClick:P},{default:s(()=>[c(l,{class:"token-icon"},{default:s(()=>[r(v(A.value.icon),1)]),_:1}),c(l,{class:"token-symbol"},{default:s(()=>[r(v(A.value.symbol),1)]),_:1}),c(l,{class:"dropdown-arrow"},{default:s(()=>[r("â–¼")]),_:1})]),_:1}),c(k,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),type:"digit",placeholder:"0.0",class:"amount-input",disabled:""},null,8,["modelValue"])]),_:1}),c(l,{class:"balance-text"},{default:s(()=>[r("Balance: "+v(O(A.value.balance)),1)]),_:1})]),_:1})]),_:1}),I.value?(u(),n(t,{key:0,class:"price-info"},{default:s(()=>[c(l,{class:"price-label"},{default:s(()=>[r("Exchange Rate")]),_:1}),c(l,{class:"price-value"},{default:s(()=>[r("1 "+v(F.value.symbol)+" â‰ˆ "+v(I.value)+" "+v(A.value.symbol),1)]),_:1})]),_:1})):i("",!0),c(h,{class:"swap-btn",disabled:!j.value||T.value,onClick:q},{default:s(()=>[c(l,null,{default:s(()=>[r(v(G.value),1)]),_:1})]),_:1},8,["disabled"]),D.value?(u(),n(t,{key:1,class:w(["status-msg",D.value.type])},{default:s(()=>[c(l,null,{default:s(()=>[r(v(D.value.msg),1)]),_:1})]),_:1},8,["class"])):i("",!0),K.value?(u(),n(t,{key:2,class:"modal-overlay",onClick:R},{default:s(()=>[c(t,{class:"modal-content",onClick:e[2]||(e[2]=m(()=>{},["stop"]))},{default:s(()=>[c(l,{class:"modal-title"},{default:s(()=>[r("Select Token")]),_:1}),(u(!0),b(y,null,_($.value,a=>(u(),n(t,{key:a.symbol,class:"token-option",onClick:e=>function(a){"from"===M.value?a.symbol===A.value.symbol?L():F.value={...a}:a.symbol===F.value.symbol?L():A.value={...a},R(),B()}(a)},{default:s(()=>[c(l,{class:"token-icon"},{default:s(()=>[r(v(a.icon),1)]),_:2},1024),c(t,{class:"token-info"},{default:s(()=>[c(l,{class:"token-name"},{default:s(()=>[r(v(a.symbol),1)]),_:2},1024),c(l,{class:"token-balance"},{default:s(()=>[r(v(O(a.balance)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):i("",!0)]),_:1})}}}),[["__scopeId","data-v-cb6d87a5"]]);export{S as default};
