import{r as a,d as e,o as t,c as l,w as s,i as n,a as d,b as u,e as i,f as o,g as c,n as r,t as f,h as v,F as _,j as w,k as p,u as y}from"./index-DCSUlbRq.js";function g(a=5e3){return new Promise((e,t)=>{if(window.MiniAppSDK)return void e(window.MiniAppSDK);const l=setTimeout(()=>{t(new Error("SDK timeout"))},a),s=()=>{clearTimeout(l),window.removeEventListener("miniapp-sdk-ready",s),window.MiniAppSDK?e(window.MiniAppSDK):t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",s)})}const m=((a,e)=>{const t=a.__vccOpts||a;for(const[l,s]of e)t[l]=s;return t})(e({__name:"index",setup(e){const{isLoading:m,getCandidates:k,vote:h}=function(e){const t=a(!1),l=a(null);return{isLoading:t,error:l,vote:async(a,s,n)=>{t.value=!0,l.value=null;try{const t=await g();return await t.governance.vote(e,a,s,n)}catch(d){throw l.value=d,d}finally{t.value=!1}},getCandidates:async()=>{t.value=!0,l.value=null;try{const a=await g();return await a.governance.getCandidates()}catch(a){throw l.value=a,a}finally{t.value=!1}}}}("miniapp-candidate-vote"),b=a([]),C=a(null),S=a("0"),V=a(0),D=a(!0),K=a(null),L=a=>`${a.slice(0,6)}...${a.slice(-4)}`,A=a=>parseInt(a).toLocaleString(),E=(a,e)=>{K.value={msg:a,type:e},setTimeout(()=>K.value=null,5e3)},M=async()=>{D.value=!0;try{const a=await k();b.value=a.candidates,S.value=a.totalVotes,V.value=a.blockHeight}catch(a){E(a.message||"Failed to load candidates","error")}finally{D.value=!1}},N=async()=>{if(C.value&&!m.value)try{E("Submitting vote...","loading"),await h(C.value,"1",!0),E("Vote submitted!","success"),await M()}catch(a){E(a.message||"Vote failed","error")}};return t(()=>{M()}),(a,e)=>{const t=o,g=n;return d(),l(g,{class:"app-container"},{default:s(()=>[u(g,{class:"header"},{default:s(()=>[u(t,{class:"title"},{default:s(()=>[c("Candidate Vote")]),_:1}),u(t,{class:"subtitle"},{default:s(()=>[c("Neo Governance Voting")]),_:1})]),_:1}),K.value?(d(),l(g,{key:0,class:r(["status-msg",K.value.type])},{default:s(()=>[u(t,null,{default:s(()=>[c(f(K.value.msg),1)]),_:1})]),_:1},8,["class"])):i("",!0),u(g,{class:"card"},{default:s(()=>[u(t,{class:"card-title"},{default:s(()=>[c("Candidates")]),_:1}),D.value?(d(),l(g,{key:0,class:"loading"},{default:s(()=>[u(t,null,{default:s(()=>[c("Loading candidates...")]),_:1})]),_:1})):0===b.value.length?(d(),l(g,{key:1,class:"empty"},{default:s(()=>[u(t,null,{default:s(()=>[c("No candidates found")]),_:1})]),_:1})):(d(),l(g,{key:2,class:"candidate-list"},{default:s(()=>[(d(!0),v(_,null,w(b.value,a=>(d(),l(g,{key:a.address,class:r(["candidate-row",{selected:C.value===a.address}]),onClick:e=>{return t=a.address,void(C.value=t);var t}},{default:s(()=>[u(g,{class:"candidate-info"},{default:s(()=>[u(t,{class:"candidate-name"},{default:s(()=>[c(f(a.name||L(a.address)),1)]),_:2},1024),u(t,{class:"candidate-votes"},{default:s(()=>[c(f(A(a.votes))+" votes",1)]),_:2},1024)]),_:2},1024),a.active?(d(),l(g,{key:0,class:"active-badge"},{default:s(()=>[u(t,null,{default:s(()=>[c("Active")]),_:1})]),_:1})):i("",!0)]),_:2},1032,["class","onClick"]))),128))]),_:1}))]),_:1}),u(g,{class:"card"},{default:s(()=>[u(t,{class:"card-title"},{default:s(()=>[c("Cast Your Vote")]),_:1}),u(g,{class:"vote-info"},{default:s(()=>[u(t,{class:"vote-label"},{default:s(()=>[c("Selected Candidate")]),_:1}),u(t,{class:"vote-value"},{default:s(()=>[c(f(C.value?L(C.value):"None"),1)]),_:1})]),_:1}),u(g,{class:"action-btn",onClick:N,style:p({opacity:!C.value||y(m)?.6:1})},{default:s(()=>[u(t,null,{default:s(()=>[c(f(y(m)?"Processing...":"Vote"),1)]),_:1})]),_:1},8,["style"])]),_:1}),u(g,{class:"card"},{default:s(()=>[u(t,{class:"card-title"},{default:s(()=>[c("Network Info")]),_:1}),u(g,{class:"info-row"},{default:s(()=>[u(t,{class:"info-label"},{default:s(()=>[c("Total Votes")]),_:1}),u(t,{class:"info-value"},{default:s(()=>[c(f(A(S.value)),1)]),_:1})]),_:1}),u(g,{class:"info-row"},{default:s(()=>[u(t,{class:"info-label"},{default:s(()=>[c("Block Height")]),_:1}),u(t,{class:"info-value"},{default:s(()=>[c(f(V.value),1)]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-6f760ddd"]]);export{m as default};
