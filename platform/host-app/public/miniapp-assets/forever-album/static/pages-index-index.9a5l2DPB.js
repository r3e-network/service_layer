import{r as e,a,o as t,b as l,c as o,d as s,e as n,f as r,i,w as u,g as c,h as d,j as p,t as v,k as f,u as y,n as m,l as h,I as b,m as g,p as w,q as _,s as k,v as C,x as $,y as A,F as I,z as P,A as x,B as E,C as T,D as S,E as M,G as B,H as D,J as K,K as F}from"./index-BhHNJHbR.js";import{A as N,s as U,w as z,g as V,a as R,N as H,b as q,_ as O,c as W,u as L,d as j,e as G,f as J,h as X,i as Y}from"./useStatusMessage.BiBbMrhd.js";function Q(e){return e instanceof Error?e:"string"==typeof e?new Error(e):new Error(String(e))}class Z extends Error{constructor(e,a){super(e),this.statusCode=a,this.name="HttpError"}}const ee={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function ae(e,a){return Math.min(a.baseDelayMs*Math.pow(2,e),a.maxDelayMs)*(.75+.5*Math.random())}function te(e,a){if(a&&a>=500)return!0;if(429===a)return!0;if(e instanceof Error){const a=e.message.toLowerCase();return a.includes("network")||a.includes("timeout")||a.includes("abort")}return!1}async function le(a,t){var l;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((l,o)=>{const s=(e=>{if(e){if(e instanceof Headers){const a={};return e.forEach((e,t)=>{a[t]=e}),a}return Array.isArray(e)?Object.fromEntries(e):e}})(t.headers),n=String((null==s?void 0:s["Content-Type"])||(null==s?void 0:s["content-type"])||"");let r=t.body;if("string"==typeof r&&n.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:a,method:t.method||"GET",data:r,header:s,success:e=>{if((e.statusCode??0)>=200&&(e.statusCode??0)<300)l(e.data);else{const a=e.data,t=null==a?void 0:a.error,l=("string"==typeof(null==t?void 0:t.message)?t.message:null)||`Request failed: ${e.statusCode}`;o(new Z(l,e.statusCode??0))}},fail:e=>{o(new Error(e.errMsg||"Network error"))}})});const o="undefined"!=typeof window&&a.startsWith(window.location.origin),s=await fetch(a,{credentials:o?"include":"same-origin",...t});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Z((null==(l=e.error)?void 0:l.message)||`Request failed: ${a}`,s.status)}return s.json()}async function oe(e){return async function(e,a={}){var t,l;const o=e.startsWith("http")?e:`${N}${e}`,s={...ee,...a.retryConfig};let n=null;for(let i=0;i<=s.maxRetries;i++){if(null==(t=a.signal)?void 0:t.aborted)throw new Error("Request cancelled");try{return await le(o,a)}catch(r){n=r instanceof Error?r:new Error(String(r));const e=r instanceof Z?r.statusCode:void 0;if(null==(l=a.signal)?void 0:l.aborted)throw n;if(i>=s.maxRetries)break;if(!te(r,e))break;const t=ae(i,s);await new Promise(e=>setTimeout(e,t))}}throw n||new Error("Request failed")}(e,{method:"GET"})}let se=null,ne=null;function re(){const e=a(null),o=a({}),s=a(null),n=a(null),r=a(null),i=a([]),u=a(!1),c=a(!1),d=a(null),p=a(!1),v=a(null),f=a=>{a.connected&&a.address?(e.value=a.address,u.value=!0):(e.value=null,u.value=!1),s.value=a.chainId??null,n.value=a.chainType??null,o.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const a={};return a[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(a[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),a}return{}})(a)},y=e=>{e&&(r.value=e.chainId??null,i.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},m=async()=>{var e;const a=await z(),t=null==(e=a.getConfig)?void 0:e.call(a);return y(t),t},h=async e=>{const a=await z();if(!a.wallet.switchChain)throw new Error("switchChain not supported by SDK");await a.wallet.switchChain(e),s.value=e};let b=null;return t(()=>{const a=R();f(a),b=U(e=>{f(e)});const t=V();(null==t?void 0:t.getConfig)&&y(t.getConfig()),t&&!u.value&&(e=>e?(se&&ne!==e&&(se=null,ne=null),se||(ne=e,se=e.wallet.getAddress().then(e=>e||null).catch(e=>{const a=e instanceof Error?e.message:String(e);return console.debug("[MiniApp SDK] Fallback wallet connection failed:",a),null}).finally(()=>{se=null,ne=null})),se):Promise.resolve(null))(t).then(a=>{var l;if(!u.value&&a){e.value=a,u.value=!0;const o=null==(l=t.getConfig)?void 0:l.call(t);s.value=(null==o?void 0:o.chainId)??null,n.value=(null==o?void 0:o.chainType)??null,y(o)}}),z().then(e=>{var a;return y(null==(a=e.getConfig)?void 0:a.call(e))}).catch(()=>{})}),l(()=>{b&&b()}),{address:e,chainId:s,chainType:n,appChainId:r,supportedChains:i,balances:o,isConnected:u,isLoading:c,error:d,showConnectionPrompt:p,connectionPromptMessage:v,connect:async()=>{var a;c.value=!0,d.value=null;try{const t=await z(),l=await t.wallet.getAddress();if(!l)throw new Error("wallet returned empty address");e.value=l,u.value=!0;const o=null==(a=t.getConfig)?void 0:a.call(t);s.value=(null==o?void 0:o.chainId)??null,n.value=(null==o?void 0:o.chainType)??null,y(o)}catch(t){d.value=Q(t)}finally{c.value=!1}},invokeIntent:async e=>{var a;const t=V();if(!(null==(a=null==t?void 0:t.wallet)?void 0:a.invokeIntent))throw new Error("invokeIntent not available");return t.wallet.invokeIntent(e)},invokeContract:async e=>{var a;const t=await z(),l=null==(a=t.getConfig)?void 0:a.call(t),o=e.contractAddress||e.scriptHash||e.contractHash,s=e.method||e.operation;if(!o||!s)throw new Error("contract address and method required");return t.invoke("invokeFunction",{contract:o,method:s,args:e.args,chainId:null==l?void 0:l.chainId,chainType:null==l?void 0:l.chainType})},invokeRead:async e=>{var a;const t=await z(),l=null==(a=t.getConfig)?void 0:a.call(t),o=e.contractAddress||e.scriptHash||e.contractHash||(null==l?void 0:l.contractAddress),s=e.method||e.operation;if(!o)throw new Error("contract address not configured");if(!s)throw new Error("method required");return t.invoke("invokeRead",{contract:o,method:s,args:e.args||[],chainId:e.chainId||(null==l?void 0:l.chainId),chainType:e.chainType||(null==l?void 0:l.chainType)})},getContractAddress:async()=>{var e,a,t,l,o;const s=await z(),n=null==(e=s.getConfig)?void 0:e.call(s);if(null==n?void 0:n.contractAddress)return n.contractAddress;if((null==n?void 0:n.chainId)&&(null==(t=null==(a=null==n?void 0:n.chainContracts)?void 0:a[n.chainId])?void 0:t.address))return n.chainContracts[n.chainId].address||null;if(s.invoke)try{const e=await s.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(o=null==(l=null==e?void 0:e.chainContracts)?void 0:l[e.chainId])?void 0:o.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:m,getAddress:async()=>(await z()).wallet.getAddress(),signMessage:async e=>{var a;const t=await z();if(!(null==(a=t.wallet)?void 0:a.signMessage))throw new Error("signMessage not available");return t.wallet.signMessage(e)},switchChain:h,switchToAppChain:async e=>{const a=await m(),t=(null==a?void 0:a.chainId)||(Array.isArray(null==a?void 0:a.supportedChains)&&a.supportedChains.length>0?a.supportedChains[0]:null)||e||null;if(!t)throw new Error("app chain not configured");await h(t)},getBalance:async e=>{var a;c.value=!0,d.value=null;try{const t=await z(),l=null==(a=t.getConfig)?void 0:a.call(t),n=(null==l?void 0:l.chainId)||s.value,r=n?`?chain_id=${encodeURIComponent(n)}`:"",i=await oe(`/wallet-balance${r}`),u=(null==i?void 0:i.balances)??{};return o.value=u,e?u[e]||"0":u}catch(t){throw d.value=Q(t),t}finally{c.value=!1}},getTransactions:async(e=20)=>{var a;c.value=!0,d.value=null;try{const t=Number.isNaN(e)||e<1?20:Math.min(e,100),l=await z(),o=null==(a=l.getConfig)?void 0:a.call(l),n=(null==o?void 0:o.chainId)||s.value,r=new URLSearchParams({limit:String(t)});n&&r.set("chain_id",n);const i=await oe(`/wallet-transactions?${r.toString()}`);return(null==i?void 0:i.transactions)??[]}catch(t){throw d.value=Q(t),t}finally{c.value=!1}},invoke:async(e,a)=>(await z()).invoke(e,a),requireConnection:(e={})=>{const{showPrompt:a=!0,errorMessage:t}=e;return!!u.value||(a&&(v.value=t||null,p.value=!0),!1)},closeConnectionPrompt:()=>{p.value=!1,v.value=null},clearError:()=>{d.value=null}}}function ie(){const{switchToAppChain:e}=re(),a=o(()=>!1),t=async()=>{try{await e()}catch(a){throw console.error("[useChainValidation] Failed to switch chain:",a),a}},l=o(()=>({show:a.value,onSwitch:t}));return{showWarning:a,switchToAppChain:t,chainWarningProps:l}}const ue=O(s({__name:"ChainWarning",props:{title:{default:"Wrong Network"},message:{default:"Switch to Neo N3 Mainnet to continue."},buttonText:{default:"Switch Network"},show:{type:Boolean,default:void 0}},emits:["switch","switch-complete","switch-error"],setup(e,{emit:t}){const l=e,s=t,{showWarning:m,switchToAppChain:h}=ie(),b=a(!1),g=o(()=>void 0!==l.show?l.show:m.value),w=async()=>{if(!b.value){b.value=!0,s("switch");try{await h(),s("switch-complete")}catch(e){const a=e instanceof Error?e:new Error(String(e));s("switch-error",a),console.error("[ChainWarning] Failed to switch chain:",a)}finally{b.value=!1}}};return(e,a)=>{const t=d,l=i;return g.value?(n(),r(l,{key:0,class:"chain-warning mb-4 px-4",role:"alert","aria-live":"assertive"},{default:u(()=>[c(y(q),{variant:"danger"},{default:u(()=>[c(l,{class:"flex flex-col items-center gap-2 py-1"},{default:u(()=>[c(t,{class:"text-center font-bold text-red-400"},{default:u(()=>[p(v(e.title),1)]),_:1}),e.message?(n(),r(t,{key:0,class:"text-center text-xs text-white opacity-80"},{default:u(()=>[p(v(e.message),1)]),_:1})):f("",!0),c(y(H),{size:"sm",variant:"secondary",class:"mt-2",loading:b.value,onClick:w},{default:u(()=>[p(v(e.buttonText),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):f("",!0)}}}),[["__scopeId","data-v-8876cefe"]]),ce=O(s({__name:"NeoInput",props:{modelValue:{},type:{},label:{},placeholder:{},suffix:{},suffixIcon:{},hint:{},error:{},disabled:{type:Boolean},required:{type:Boolean},ariaLabel:{}},emits:["update:modelValue","focus","blur"],setup(e){let a=0;const t="neo-input-"+ ++a;return(e,a)=>{const l=d,o=h,s=b,g=i;return n(),r(g,{class:m(["neo-input",{"neo-input--error":e.error,"neo-input--disabled":e.disabled}])},{default:u(()=>[e.label?(n(),r(l,{key:0,id:`${t}-label`,class:"neo-input__label"},{default:u(()=>[p(v(e.label),1)]),_:1},8,["id"])):f("",!0),c(g,{class:"neo-input__wrapper"},{default:u(()=>["textarea"===e.type?(n(),r(o,{key:0,id:t,value:e.modelValue,placeholder:e.placeholder,disabled:e.disabled,"aria-label":e.ariaLabel||(e.label?void 0:e.placeholder),"aria-labelledby":e.label?`${t}-label`:void 0,"aria-describedby":e.error?`${t}-error`:e.hint?`${t}-hint`:void 0,"aria-invalid":!!e.error||void 0,"aria-required":e.required||void 0,class:"neo-input__field neo-input__textarea",onInput:a[0]||(a[0]=a=>e.$emit("update:modelValue",a.target.value)),onFocus:a[1]||(a[1]=a=>e.$emit("focus",a)),onBlur:a[2]||(a[2]=a=>e.$emit("blur",a))},null,8,["value","placeholder","disabled","aria-label","aria-labelledby","aria-describedby","aria-invalid","aria-required"])):(n(),r(s,{key:1,id:t,value:e.modelValue,type:e.type,placeholder:e.placeholder,disabled:e.disabled,"aria-label":e.ariaLabel||(e.label?void 0:e.placeholder),"aria-labelledby":e.label?`${t}-label`:void 0,"aria-describedby":e.error?`${t}-error`:e.hint?`${t}-hint`:void 0,"aria-invalid":!!e.error||void 0,"aria-required":e.required||void 0,class:"neo-input__field",onInput:a[3]||(a[3]=a=>e.$emit("update:modelValue",a.target.value)),onFocus:a[4]||(a[4]=a=>e.$emit("focus",a)),onBlur:a[5]||(a[5]=a=>e.$emit("blur",a))},null,8,["value","type","placeholder","disabled","aria-label","aria-labelledby","aria-describedby","aria-invalid","aria-required"])),e.suffixIcon||e.suffix?(n(),r(g,{key:2,class:"neo-input__suffix"},{default:u(()=>[e.suffixIcon?(n(),r(y(W),{key:0,name:e.suffixIcon,size:18},null,8,["name"])):f("",!0),e.suffix?(n(),r(l,{key:1},{default:u(()=>[p(v(e.suffix),1)]),_:1})):f("",!0)]),_:1})):f("",!0)]),_:1}),e.error?(n(),r(l,{key:1,id:`${t}-error`,class:"neo-input__error",role:"alert"},{default:u(()=>[p(v(e.error),1)]),_:1},8,["id"])):e.hint?(n(),r(l,{key:2,id:`${t}-hint`,class:"neo-input__hint"},{default:u(()=>[p(v(e.hint),1)]),_:1},8,["id"])):f("",!0)]),_:1},8,["class"])}}}),[["__scopeId","data-v-39374a76"]]),de=O(s({__name:"NeoModal",props:{visible:{type:Boolean},title:{},variant:{},closeable:{type:Boolean}},emits:["close"],setup(e){const t=e,o=a(null);let s=null,y=0;const h="neo-modal-"+ ++y;return g(()=>t.visible,async e=>{var a,t,l,n;if(e){s="undefined"!=typeof document?document.activeElement:null,await C();null==(l=null==(t=(null==(a=o.value)?void 0:a.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))||o.value)?void 0:t.focus)||l.call(t)}else s&&(null==(n=s.focus)||n.call(s),s=null)}),l(()=>{s=null}),(e,a)=>{const t=d,l=i;return e.visible?(n(),r(l,{key:0,class:"neo-modal",role:"dialog","aria-modal":"true","aria-labelledby":e.title?`${h}-title`:void 0,"aria-label":e.title?void 0:"Dialog",onClick:a[3]||(a[3]=_(a=>e.closeable&&e.$emit("close"),["self"])),onKeydown:a[4]||(a[4]=w(a=>e.closeable&&e.$emit("close"),["escape"]))},{default:u(()=>[c(l,{ref_key:"contentRef",ref:o,class:m(["neo-modal__content",`neo-modal--${e.variant}`])},{default:u(()=>[e.title?(n(),r(l,{key:0,class:"neo-modal__header"},{default:u(()=>[c(t,{id:`${h}-title`,class:"neo-modal__title"},{default:u(()=>[p(v(e.title),1)]),_:1},8,["id"]),e.closeable?(n(),r(l,{key:0,class:"neo-modal__close",role:"button",tabindex:"0","aria-label":"Close dialog",onClick:a[0]||(a[0]=a=>e.$emit("close")),onKeydown:[a[1]||(a[1]=w(a=>e.$emit("close"),["enter"])),a[2]||(a[2]=w(_(a=>e.$emit("close"),["prevent"]),["space"]))]},{default:u(()=>[c(W,{name:"x",size:20})]),_:1})):f("",!0)]),_:1})):f("",!0),c(l,{class:"neo-modal__body"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3}),e.$slots.footer?(n(),r(l,{key:1,class:"neo-modal__footer"},{default:u(()=>[k(e.$slots,"footer",{},void 0,!0)]),_:3})):f("",!0)]),_:3},8,["class"])]),_:3},8,["aria-labelledby","aria-label"])):f("",!0)}}}),[["__scopeId","data-v-d9565316"]]),pe=O(s({__name:"NeoStats",props:{stats:{}},setup:e=>(e,a)=>{const t=d,l=i;return n(),r(l,{class:"neo-stats",role:"list","aria-label":"Statistics"},{default:u(()=>[(n(!0),$(I,null,A(e.stats,e=>(n(),r(l,{key:e.label,class:m(["neo-stats__item",`neo-stats__item--${e.variant||"default"}`]),role:"listitem","aria-label":`${e.label}: ${e.value}`},{default:u(()=>[c(t,{class:"neo-stats__value","aria-hidden":"true"},{default:u(()=>[p(v(e.value),1)]),_:2},1024),c(t,{class:"neo-stats__label","aria-hidden":"true"},{default:u(()=>[p(v(e.label),1)]),_:2},1024)]),_:2},1032,["class","aria-label"]))),128))]),_:1})}}),[["__scopeId","data-v-46509ca9"]]),ve=O(s({__name:"WalletPrompt",props:{visible:{type:Boolean},message:{}},emits:["close","connect"],setup(e,{emit:t}){const{t:l}=L(),o=t,s=a(!1),f=async()=>{s.value=!0,o("connect")};return(e,a)=>{const t=d,o=i;return n(),r(de,{visible:e.visible,title:y(l)("wpTitle"),variant:"warning",closeable:!0,onClose:a[1]||(a[1]=a=>e.$emit("close"))},{footer:u(()=>[c(H,{variant:"ghost",size:"sm",onClick:a[0]||(a[0]=a=>e.$emit("close"))},{default:u(()=>[p(v(y(l)("wpCancel")),1)]),_:1})]),default:u(()=>[c(o,{class:"wallet-prompt",role:"alert","aria-live":"polite"},{default:u(()=>[c(t,{class:"wallet-prompt__desc"},{default:u(()=>[p(v(e.message||y(l)("wpDescription")),1)]),_:1}),c(H,{variant:"primary",size:"lg",class:"wallet-prompt__btn",loading:s.value,onClick:f},{default:u(()=>[c(W,{name:"wallet",size:18}),p(" "+v(y(l)("wpConnect")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["visible","title"])}}}),[["__scopeId","data-v-751b0664"]]),fe=O(s({__name:"ErrorBoundary",props:{showDetails:{type:Boolean,default:!1},onError:{},fallback:{}},emits:["retry","reset","error"],setup(e,{expose:t,emit:l}){const o=e,s=l,y=a(!1),m=a(null),h=a(""),b=e=>({errorTitle:"Something went wrong",retry:"Try Again",reset:"Reset"}[e]||e);P(e=>{var a;const t=e instanceof Error?e:new Error(String(e));return m.value=t,h.value=o.fallback||t.message||"An unexpected error occurred",y.value=!0,s("error",t),null==(a=o.onError)||a.call(o,t),!1});const g=()=>{y.value=!1,m.value=null,s("retry")},w=()=>{y.value=!1,m.value=null,h.value="",s("reset")};return t({setError:e=>{const a=e instanceof Error?e:new Error(e);m.value=a,h.value=a.message,y.value=!0,s("error",a)},clearError:w}),(e,a)=>{const t=d,l=i;return y.value?(n(),r(l,{key:0,class:"error-boundary",role:"alert","aria-live":"assertive"},{default:u(()=>[c(l,{class:"error-container"},{default:u(()=>[c(t,{class:"error-icon"},{default:u(()=>[p("âš ï¸")]),_:1}),c(t,{class:"error-title"},{default:u(()=>[p(v(b("errorTitle")||"Something went wrong"),1)]),_:1}),c(t,{class:"error-message"},{default:u(()=>[p(v(h.value),1)]),_:1}),c(l,{class:"error-actions"},{default:u(()=>[c(H,{variant:"primary",onClick:g},{default:u(()=>[p(v(b("retry")||"Try Again"),1)]),_:1}),c(H,{variant:"secondary",onClick:w},{default:u(()=>[p(v(b("reset")||"Reset"),1)]),_:1})]),_:1}),e.showDetails?(n(),r(l,{key:0,class:"error-details"},{default:u(()=>[c(t,{class:"error-stack"},{default:u(()=>{var e,a;return[p(v((null==(e=m.value)?void 0:e.stack)||(null==(a=m.value)?void 0:a.message)),1)]}),_:1})]),_:1})):f("",!0)]),_:1})]),_:1})):k(e.$slots,"default",{key:1},void 0,!0)}}}),[["__scopeId","data-v-34155aa3"]]),ye=O(s({__name:"Fireworks",props:{active:{type:Boolean,default:!1},duration:{default:3e3}},emits:["complete"],setup(e,{emit:a}){const t=e,o=a;let s=null;const d=e=>{const a=["#ff6b6b","#ffd93d","#6bcb77","#4d96ff","#ff6bd6","#a855f7"];return{left:`${10+80*Math.random()}%`,top:`${10+60*Math.random()}%`,animationDelay:`${.5*Math.random()}s`,"--firework-color":a[(e-1)%a.length]}};return g(()=>t.active,e=>{e&&(s=setTimeout(()=>{o("complete")},t.duration))}),l(()=>{s&&clearTimeout(s)}),(e,a)=>{const t=i;return e.active?(n(),r(t,{key:0,class:"fireworks-container","aria-hidden":"true"},{default:u(()=>[(n(),$(I,null,A(12,e=>c(t,{key:e,class:m(`firework firework-${e}`),style:x(d(e))},{default:u(()=>[(n(),$(I,null,A(8,e=>c(t,{key:e,class:m(`spark spark-${e}`)},null,8,["class"])),64))]),_:2},1032,["class","style"])),64))]),_:1})):f("",!0)}}}),[["__scopeId","data-v-8a253f7e"]]),me=O(s({__name:"SidebarPanel",props:{title:{default:""},description:{default:""},items:{default:()=>[]}},setup:e=>(e,a)=>{const t=d,l=i;return n(),r(l,{class:"sidebar-panel-content"},{default:u(()=>[e.title?(n(),r(t,{key:0,class:"sidebar-title"},{default:u(()=>[p(v(e.title),1)]),_:1})):f("",!0),e.description?(n(),r(t,{key:1,class:"sidebar-desc"},{default:u(()=>[p(v(e.description),1)]),_:1})):f("",!0),e.items.length?(n(),r(l,{key:2,class:"sidebar-items"},{default:u(()=>[(n(!0),$(I,null,A(e.items,e=>(n(),r(l,{key:e.label,class:"sidebar-item"},{default:u(()=>[c(t,{class:"sidebar-item-label"},{default:u(()=>[p(v(e.label),1)]),_:2},1024),c(t,{class:"sidebar-value"},{default:u(()=>[p(v(e.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):f("",!0),k(e.$slots,"default",{},void 0,!0)]),_:3})}}),[["__scopeId","data-v-0f03dbb3"]]),he=O(s({__name:"game-board",emits:["ready"],setup:e=>(e,a)=>{const t=i;return n(),r(t,{class:"game-board-slot"},{default:u(()=>[c(t,{class:"game-arena"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3})]),_:3})}}),[["__scopeId","data-v-865ce7b3"]]),be=O(s({__name:"market-list",emits:["ready"],setup:e=>(e,a)=>{const t=i;return n(),r(t,{class:"market-list-slot"},{default:u(()=>[e.$slots.filters?(n(),r(t,{key:0,class:"list-filters"},{default:u(()=>[k(e.$slots,"filters",{},void 0,!0)]),_:3})):f("",!0),c(t,{class:"list-container"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3})]),_:3})}}),[["__scopeId","data-v-7bb016db"]]),ge=O(s({__name:"form-panel",emits:["ready"],setup:e=>(e,a)=>{const t=i;return n(),r(t,{class:"form-panel-slot"},{default:u(()=>[c(t,{class:"form-card"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3}),e.$slots.footer?(n(),r(t,{key:0,class:"form-footer"},{default:u(()=>[k(e.$slots,"footer",{},void 0,!0)]),_:3})):f("",!0)]),_:3})}}),[["__scopeId","data-v-dc99375e"]]),we=O(s({__name:"dashboard",emits:["ready"],setup:e=>(e,a)=>{const t=i;return n(),r(t,{class:"dashboard-slot"},{default:u(()=>[e.$slots.hero?(n(),r(t,{key:0,class:"dashboard-hero"},{default:u(()=>[k(e.$slots,"hero",{},void 0,!0)]),_:3})):f("",!0),c(t,{class:"dashboard-panels"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3})]),_:3})}}),[["__scopeId","data-v-094f7c79"]]),_e=O(s({__name:"swap-interface",emits:["ready"],setup:e=>(e,a)=>{const t=i;return n(),r(t,{class:"swap-interface-slot"},{default:u(()=>[c(t,{class:"swap-container"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3})]),_:3})}}),[["__scopeId","data-v-172c680c"]]),ke=O(s({__name:"timer-hero",emits:["ready"],setup:e=>(e,a)=>{const t=i;return n(),r(t,{class:"timer-hero-slot"},{default:u(()=>[c(t,{class:"timer-display"},{default:u(()=>[k(e.$slots,"timer",{},void 0,!0)]),_:3}),c(t,{class:"timer-action"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3})]),_:3})}}),[["__scopeId","data-v-b3a2b09d"]]),Ce=O(s({__name:"two-column",emits:["ready"],setup(e){const a=E(),t=o(()=>!!a.operation);return(e,a)=>{const l=i;return n(),r(l,{class:m(["two-column-slot",{"single-column":!t.value}])},{default:u(()=>[c(l,{class:"two-column-info"},{default:u(()=>[k(e.$slots,"default",{},void 0,!0)]),_:3}),t.value?(n(),r(l,{key:0,class:"two-column-operation"},{default:u(()=>[k(e.$slots,"operation",{},void 0,!0)]),_:3})):f("",!0)]),_:3},8,["class"])}}}),[["__scopeId","data-v-34a617ab"]]),$e=O(s({__name:"MiniAppTemplate",props:{config:{},state:{},t:{type:Function},statusMessage:{},fireworksActive:{type:Boolean}},emits:["tab-change"],setup(e,{emit:t}){const l=e,s=t,m=E(),{showWarning:h}=ie(),b=o(()=>{var e;return!1!==(null==(e=l.config.features)?void 0:e.chainWarning)&&h.value}),g=o(()=>{var e;const a=l.config.tabs.find(e=>e.default);return(null==a?void 0:a.key)??(null==(e=l.config.tabs[0])?void 0:e.key)??""}),w=a(g.value),_=o(()=>l.config.tabs.map(e=>({id:e.key,label:l.t(e.labelKey),icon:e.icon??""}))),C=o(()=>l.config.tabs.filter(e=>e.key!==g.value)),P=e=>{w.value=e,s("tab-change",e)},x={"game-board":he,"market-list":be,"form-panel":ge,dashboard:we,"swap-interface":_e,"timer-hero":ke,"two-column":Ce,custom:"view"},S=o(()=>x[l.config.contentType]??"view"),M=o(()=>{var e;return((null==(e=l.config.stats)?void 0:e.length)??0)>0}),B=(e,a)=>{const t=a??0;switch(e.format){case"currency":return`${Number(t).toFixed(2)} GAS`;case"percent":return`${Number(t).toFixed(1)}%`;case"duration":return String(t);default:return"number"==typeof t?t:Number(t)||0}},D=o(()=>(l.config.stats??[]).map(e=>({label:l.t(e.labelKey),value:B(e,l.state[e.valueKey]),variant:e.variant??"default"}))),K=o(()=>{var e;return null==(e=l.config.features)?void 0:e.docs}),F=o(()=>!!K.value),N=o(()=>{var e;return((null==(e=K.value)?void 0:e.stepKeys)??[]).map(e=>l.t(e))}),U=o(()=>{var e;return((null==(e=K.value)?void 0:e.featureKeys)??[]).map(e=>({name:l.t(e.nameKey),desc:l.t(e.descKey)}))}),z=o(()=>{var e;return!1!==(null==(e=l.config.features)?void 0:e.fireworks)}),V=o(()=>{var e;return!1!==(null==(e=l.config.features)?void 0:e.statusMessages)}),R=e=>!!m[e];return(e,a)=>{const t=d,l=i;return n(),r(y(j),{"desktop-breakpoint":1024,tabs:_.value,"active-tab":w.value,onTabChange:P},{"desktop-sidebar":u(()=>[k(e.$slots,"desktop-sidebar",{},void 0,!0)]),default:u(()=>[b.value?(n(),r(y(ue),{key:0,title:e.t("wrongChain"),message:e.t("wrongChainMessage"),"button-text":e.t("switchToNeo")},null,8,["title","message","button-text"])):f("",!0),V.value&&e.statusMessage?(n(),r(y(q),{key:1,variant:"error"===e.statusMessage.type?"danger":"erobo-neo",class:"template-status mb-4"},{default:u(()=>[c(t,{class:"text-center font-bold"},{default:u(()=>[p(v(e.statusMessage.msg),1)]),_:1})]),_:1},8,["variant"])):f("",!0),w.value===g.value?(n(),r(l,{key:2,class:"tab-content",role:"tabpanel",id:`tabpanel-${g.value}`,"aria-labelledby":`tab-${g.value}`},{default:u(()=>[(n(),r(T(S.value),null,{operation:u(()=>[k(e.$slots,"operation",{},void 0,!0)]),default:u(()=>[k(e.$slots,"content",{},void 0,!0)]),_:3}))]),_:3},8,["id","aria-labelledby"])):f("",!0),(n(!0),$(I,null,A(C.value,a=>(n(),$(I,{key:a.key},[w.value===a.key?(n(),r(l,{key:0,class:"tab-content scrollable",role:"tabpanel",id:`tabpanel-${a.key}`,"aria-labelledby":`tab-${a.key}`},{default:u(()=>["stats"===a.key&&M.value&&!R("tab-stats")?(n(),r(y(q),{key:0,variant:"erobo"},{default:u(()=>[c(y(pe),{stats:D.value},null,8,["stats"])]),_:1})):"docs"===a.key&&F.value&&!R("tab-docs")?(n(),r(y(G),{key:1,title:e.t(K.value.titleKey),subtitle:K.value.subtitleKey?e.t(K.value.subtitleKey):void 0,steps:N.value,features:U.value},null,8,["title","subtitle","steps","features"])):k(e.$slots,`tab-${a.key}`,{key:2},void 0,!0)]),_:2},1032,["id","aria-labelledby"])):f("",!0)],64))),128)),z.value?(n(),r(ye,{key:3,active:e.fireworksActive,duration:3e3},null,8,["active"])):f("",!0)]),_:3},8,["tabs","active-tab"])}}}),[["__scopeId","data-v-07ef5641"]]);class Ae extends Error{constructor(e,a,t,l){super(e),this.code=a,this.userMessage=t,this.details=l,this.name="MiniAppError"}}function Ie(e,a="An error occurred"){return function(e){return e instanceof Ae}(e)?e.userMessage||e.message:e instanceof Error?e.message:a}const Pe=new Set(["neo-n3","neo-n3-mainnet","neo-n3-testnet"]);function xe(e,a,t,l){const o=function(e){if("string"==typeof e)return e;const a=null==e?void 0:e.value;return"string"==typeof a?a:""}(e);if(Pe.has(o))return!0;let s="";if(!s&&"function"==typeof a){const e=a("wrongChainMessage");s=e&&"wrongChainMessage"!==e?e:a("wrongChain")}s||(s="Wrong network");const n=globalThis.uni;return(null==n?void 0:n.showToast)&&n.showToast({title:s,icon:"none"}),!1}function Ee(e){const{chainType:t,getContractAddress:l}=re(),o=a(null);return{contractAddress:o,ensure:async()=>{if(!xe(t,e))throw new Error(e("wrongChain"));if(o.value||(o.value=await l()),!o.value)throw new Error(e("contractUnavailable")||"Contract address unavailable");return o.value},ensureSafe:async()=>!!xe(t,e)&&(o.value||(o.value=await l()),!!o.value)}}function Te(){var e;const t=a("undefined"!=typeof window&&!!(null==(e=window.crypto)?void 0:e.subtle)),l=()=>{if(!t.value)throw new Error("Crypto API not available")},o=e=>{let a="";return e.forEach(e=>{a+=String.fromCharCode(e)}),btoa(a)},s=e=>{const a=atob(e),t=new Uint8Array(a.length);for(let l=0;l<a.length;l+=1)t[l]=a.charCodeAt(l);return t},n=async(e,a)=>{l();const t=new TextEncoder,o=await window.crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:a,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])};return{isAvailable:t,encryptPayload:async(e,a)=>{l();const t=new TextEncoder,s=window.crypto.getRandomValues(new Uint8Array(16)),r=window.crypto.getRandomValues(new Uint8Array(12)),i=await n(a,s),u=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,t.encode(e));return JSON.stringify({v:1,alg:"AES-GCM",salt:o(s),iv:o(r),data:o(new Uint8Array(u))})},decryptPayload:async(e,a)=>{l();const t=JSON.parse(e);if(!t||1!==t.v||"AES-GCM"!==t.alg)throw new Error("Invalid payload format");const o=s(t.salt||""),r=s(t.iv||""),i=s(t.data||""),u=await n(a,o),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},u,i);return(new TextDecoder).decode(c)}}}function Se(e){if(null==e)return null;if("object"==typeof e&&"type"in e){const a=e;switch(a.type){case"ByteArray":case"Buffer":case"InteropInterface":default:return a.value;case"Integer":return"string"==typeof a.value?a.value.startsWith("0x")?BigInt(a.value).toString():parseInt(a.value,10):Number(a.value);case"Array":case"Struct":return Array.isArray(a.value)?a.value.map(Se):a.value;case"Map":if(Array.isArray(a.value)){const e=new Map;for(const t of a.value)Array.isArray(t)&&2===t.length&&e.set(Se(t[0]),Se(t[1]));return Object.fromEntries(e)}return a.value;case"Boolean":return Boolean(a.value);case"String":case"Hash160":case"Hash256":return String(a.value)}}return Array.isArray(e)?e.map(Se):e}function Me(e){if(!e)return null;if("object"==typeof e&&null!==e){const a=e;return"stack"in a&&Array.isArray(a.stack)?0===a.stack.length?null:1===a.stack.length?Se(a.stack[0]):a.stack.map(Se):"state"in a?Se(a.state):"txid"in a||"txHash"in a?e:Se(e)}return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?e:Se(e)}function Be(e){const{address:l,invokeRead:o}=J(),{ensure:s}=Ee(e),{decryptPayload:n}=Te(),{status:r,setStatus:i}=X(5e3),u=a(!1),c=a([]),d=a(!1),p=a(null),v=a(!1),f=a(null),y=a(!1),m=a(""),h=async()=>{if(l.value){u.value=!0;try{const e=await s(),a=await o({scriptHash:e,operation:"getUserPhotoCount",args:[{type:"Hash160",value:l.value}]}),t=Number(Me(a)||0);if(!t)return void(c.value=[]);const n=Math.min(t,50),r=Me(await o({scriptHash:e,operation:"getUserPhotoIds",args:[{type:"Hash160",value:l.value},{type:"Integer",value:"0"},{type:"Integer",value:String(n)}]})),i=Array.isArray(r)?r.map(e=>String(e)).filter(Boolean):[],u=await Promise.all(i.map(async a=>(e=>{if(!Array.isArray(e)||e.length<5)return null;const[a,t,l,o,s]=e;return a&&o?{id:String(a),data:String(o),encrypted:Boolean(l),createdAt:Number(s||0)}:null})(Me(await o({scriptHash:e,operation:"getPhoto",args:[{type:"ByteArray",value:a}]})))));c.value=u.filter(e=>!!e).sort((e,a)=>a.createdAt-e.createdAt)}catch(a){i(Ie(a,e("loadFailed")),"error")}finally{u.value=!1}}else c.value=[]};return t(()=>{l.value&&h()}),g(l,()=>h()),{status:r,setStatus:i,loadingPhotos:u,photos:c,showViewer:d,viewingPhoto:p,showDecrypt:v,decryptTarget:f,decrypting:y,decryptedPreview:m,loadPhotos:h,viewPhoto:e=>{if(e.encrypted)return f.value=e,m.value="",void(v.value=!0);p.value=e,d.value=!0},closeViewer:()=>{d.value=!1,p.value=null},openDecrypt:()=>{d.value=!1,v.value=!0},closeDecrypt:()=>{v.value=!1,f.value=null,m.value=""},handleDecrypt:async a=>{if(f.value&&a){y.value=!0;try{const t=await n(f.value.data,a);if(!t.startsWith("data:image"))throw new Error(e("invalidPayload"));m.value=t}catch(t){i(Ie(t,e("decryptFailed")),"error")}finally{y.value=!1}}else i(e("passwordRequired"),"error")},previewDecrypted:()=>{m.value&&S({urls:[m.value]})}}}const De=6e4;const Ke=O(s({__name:"AlbumGrid",props:{t:{type:Function},photos:{},loading:{type:Boolean}},emits:["view","upload"],setup:e=>(e,a)=>{const t=d,l=i,o=D;return n(),r(y(q),{variant:"erobo",class:"gallery-card"},{default:u(()=>[e.loading?(n(),r(l,{key:0,class:"loading-state"},{default:u(()=>[c(t,null,{default:u(()=>[p(v(e.t("loading")),1)]),_:1})]),_:1})):(n(),r(l,{key:1,class:"gallery-grid"},{default:u(()=>[(n(!0),$(I,null,A(e.photos,a=>(n(),r(l,{key:a.id,class:"photo-item",role:"button",tabindex:"0","aria-label":a.encrypted?e.t("encrypted"):e.t("albumPhoto"),onClick:t=>e.$emit("view",a)},{default:u(()=>[a.encrypted?(n(),r(l,{key:1,class:"photo-locked"},{default:u(()=>[c(t,{class:"lock-label"},{default:u(()=>[p(v(e.t("encrypted")),1)]),_:1})]),_:1})):(n(),r(o,{key:0,src:a.data,mode:"aspectFill",class:"photo-img",alt:e.t("albumPhoto")},null,8,["src","alt"])),a.encrypted?(n(),r(l,{key:2,class:"lock-icon","aria-hidden":"true"},{default:u(()=>[p(v(e.t("encrypted")),1)]),_:1})):f("",!0)]),_:2},1032,["aria-label","onClick"]))),128)),c(l,{class:"photo-item placeholder",role:"button",tabindex:"0","aria-label":e.t("addPhoto"),onClick:a[0]||(a[0]=a=>e.$emit("upload"))},{default:u(()=>[c(t,{class:"plus-icon","aria-hidden":"true"},{default:u(()=>[p("+")]),_:1}),c(t,{class:"add-label"},{default:u(()=>[p(v(e.t("addPhoto")),1)]),_:1})]),_:1},8,["aria-label"])]),_:1})),e.loading||0!==e.photos.length?f("",!0):(n(),r(l,{key:2,class:"empty-state"},{default:u(()=>[c(t,{class:"empty-title"},{default:u(()=>[p(v(e.t("emptyTitle")),1)]),_:1}),c(t,{class:"empty-desc"},{default:u(()=>[p(v(e.t("emptyDesc")),1)]),_:1})]),_:1}))]),_:1})}}),[["__scopeId","data-v-f1706276"]]),Fe=O(s({__name:"PhotoUpload",props:{t:{type:Function},visible:{type:Boolean},images:{},maxPhotos:{},maxBytes:{},totalSize:{},encrypted:{type:Boolean},password:{},uploading:{type:Boolean}},emits:["close","remove","choose","confirm","update:encrypted","update:password"],setup(e,{emit:t}){const l=t,o=a(e.password);g(o,e=>{l("update:password",e)});const s=e=>e<1024?`${e}B`:`${(e/1024).toFixed(1)}KB`;return(e,a)=>{const t=D,l=i,m=d,h=K;return n(),r(y(de),{visible:e.visible,title:e.t("uploadPhoto"),closeable:"",onClose:a[5]||(a[5]=a=>e.$emit("close"))},{footer:u(()=>[c(y(H),{variant:"ghost",size:"sm",onClick:a[3]||(a[3]=a=>e.$emit("close"))},{default:u(()=>[p(v(e.t("cancel")),1)]),_:1}),c(y(H),{variant:"primary",size:"sm",disabled:0===e.images.length||e.uploading,loading:e.uploading,onClick:a[4]||(a[4]=a=>e.$emit("confirm"))},{default:u(()=>[p(v(e.uploading?e.t("uploading"):e.t("confirm")),1)]),_:1},8,["disabled","loading"])]),default:u(()=>[c(l,{class:"upload-body"},{default:u(()=>[c(l,{class:"upload-grid"},{default:u(()=>[(n(!0),$(I,null,A(e.images,a=>(n(),r(l,{key:a.id,class:"upload-item"},{default:u(()=>[c(t,{src:a.dataUrl,mode:"aspectFill",class:"upload-img",alt:e.t("uploadPreview")},null,8,["src","alt"]),c(l,{class:"remove-btn",role:"button","aria-label":e.t("cancel"),onClick:_(t=>e.$emit("remove",a.id),["stop"])},{default:u(()=>[p("Ã—")]),_:2},1032,["aria-label","onClick"])]),_:2},1024))),128)),e.images.length<e.maxPhotos?(n(),r(l,{key:0,class:"upload-item upload-placeholder",role:"button",tabindex:"0","aria-label":e.t("selectMore"),onClick:a[0]||(a[0]=a=>e.$emit("choose"))},{default:u(()=>[c(m,{class:"upload-plus"},{default:u(()=>[p("+")]),_:1}),c(m,{class:"upload-tip"},{default:u(()=>[p(v(e.t("selectMore")),1)]),_:1})]),_:1},8,["aria-label"])):f("",!0)]),_:1}),c(l,{class:"upload-meta"},{default:u(()=>[c(m,null,{default:u(()=>[p(v(e.t("uploadHint",{count:e.images.length,max:e.maxPhotos})),1)]),_:1}),c(m,{class:"upload-meta__size"},{default:u(()=>[p(v(e.t("sizeHint",{size:s(e.totalSize),max:s(e.maxBytes)})),1)]),_:1})]),_:1}),c(l,{class:"form-group"},{default:u(()=>[c(m,{class:"label"},{default:u(()=>[p(v(e.t("encryptPhoto")),1)]),_:1}),c(h,{checked:e.encrypted,onChange:a[1]||(a[1]=a=>e.$emit("update:encrypted",a.detail.value))},null,8,["checked"])]),_:1}),e.encrypted?(n(),r(l,{key:0,class:"form-group column"},{default:u(()=>[c(y(ce),{modelValue:o.value,"onUpdate:modelValue":a[2]||(a[2]=e=>o.value=e),type:"password",placeholder:e.t("enterPassword")},null,8,["modelValue","placeholder"]),c(m,{class:"hint"},{default:u(()=>[p(v(e.t("encryptionNote")),1)]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1},8,["visible","title"])}}}),[["__scopeId","data-v-28b73d81"]]),Ne=O(s({__name:"AlbumViewer",props:{t:{type:Function},visible:{type:Boolean},photo:{},showShare:{type:Boolean}},emits:["close","decrypt","share"],setup:(e,{emit:a})=>(e,a)=>{const t=D,l=d,o=i;return n(),r(y(de),{visible:e.visible,title:e.t("photoViewer"),closeable:!0,onClose:a[3]||(a[3]=a=>e.$emit("close"))},{footer:u(()=>[e.showShare?(n(),r(y(H),{key:0,size:"sm",variant:"secondary",onClick:a[1]||(a[1]=a=>e.$emit("share"))},{default:u(()=>[p(v(e.t("share")),1)]),_:1})):f("",!0),c(y(H),{size:"sm",variant:"ghost",onClick:a[2]||(a[2]=a=>e.$emit("close"))},{default:u(()=>[p(v(e.t("close")),1)]),_:1})]),default:u(()=>[c(o,{class:"viewer-body"},{default:u(()=>[e.photo&&!e.photo.encrypted?(n(),r(t,{key:0,src:e.photo.data,mode:"aspectFit",class:"viewer-img",alt:e.t("viewingPhoto")},null,8,["src","alt"])):e.photo?(n(),r(o,{key:1,class:"encrypted-notice"},{default:u(()=>[c(l,{class:"notice-text"},{default:u(()=>[p(v(e.t("encryptedPhotoNotice")),1)]),_:1}),c(y(H),{size:"sm",variant:"primary",onClick:a[0]||(a[0]=a=>e.$emit("decrypt"))},{default:u(()=>[p(v(e.t("decryptToView")),1)]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1},8,["visible","title"])}}),[["__scopeId","data-v-a6a33607"]]),Ue=O(s({__name:"DecryptModal",props:{t:{type:Function},visible:{type:Boolean},decrypting:{type:Boolean},preview:{}},emits:["close","decrypt","preview"],setup(e,{emit:t}){const l=e,o=a("");return g(()=>l.visible,e=>{e||(o.value="")}),(e,a)=>{const t=D,l=i;return n(),r(y(de),{visible:e.visible,title:e.t("decryptTitle"),closeable:"",onClose:a[3]||(a[3]=a=>e.$emit("close"))},{default:u(()=>[c(l,{class:"decrypt-body"},{default:u(()=>[c(y(ce),{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),type:"password",placeholder:e.t("enterPassword")},null,8,["modelValue","placeholder"]),c(y(H),{variant:"secondary",size:"sm",class:"decrypt-btn",loading:e.decrypting,onClick:a[1]||(a[1]=a=>e.$emit("decrypt",o.value))},{default:u(()=>[p(v(e.decrypting?e.t("decrypting"):e.t("decryptConfirm")),1)]),_:1},8,["loading"]),e.preview?(n(),r(l,{key:0,class:"decrypt-preview"},{default:u(()=>[c(t,{src:e.preview,mode:"aspectFit",class:"decrypt-img",alt:e.t("decryptedPhoto")},null,8,["src","alt"]),c(y(H),{size:"sm",variant:"ghost",onClick:a[2]||(a[2]=a=>e.$emit("preview"))},{default:u(()=>[p(v(e.t("openPreview")),1)]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1},8,["visible","title"])}}}),[["__scopeId","data-v-c8588176"]]),ze=O(s({__name:"index",setup(e){const{t:t}=Y(),{address:l,connect:s}=J(),m={contentType:"two-column",tabs:[{key:"album",labelKey:"albumTab",icon:"ðŸ“¸",default:!0},{key:"docs",labelKey:"docsTab",icon:"ðŸ“–"}],features:{fireworks:!1,chainWarning:!0,statusMessages:!0,docs:{titleKey:"title",subtitleKey:"docSubtitle",stepKeys:["step1","step2","step3","step4"],featureKeys:[{nameKey:"feature1Name",descKey:"feature1Desc"},{nameKey:"feature2Name",descKey:"feature2Desc"},{nameKey:"feature3Name",descKey:"feature3Desc"}]}}},h=a("album"),b=a(!1),{status:g,setStatus:w,loadingPhotos:_,photos:k,showViewer:C,viewingPhoto:$,showDecrypt:A,decrypting:I,decryptedPreview:P,loadPhotos:x,viewPhoto:E,closeViewer:T,openDecrypt:S,closeDecrypt:D,handleDecrypt:K,previewDecrypted:N}=Be(t),U=()=>b.value=!0,z=()=>b.value=!1,{MAX_PHOTOS_PER_UPLOAD:V,MAX_TOTAL_BYTES:R,showUpload:O,selectedImages:W,isEncrypted:L,password:j,uploading:G,totalPayloadSize:X,openUpload:Q,closeUpload:Z,chooseImages:ee,removeImage:ae,uploadPhotos:te}=function(e,t,l,s){const{address:n,invokeContract:r}=J(),{ensure:i}=Ee(e),{encryptPayload:u}=Te(),c=a(!1),d=a([]),p=a(!1),v=a(""),f=a(!1),y=o(()=>d.value.reduce((e,a)=>e+a.size,0)),m=()=>c.value=!1,h=e=>new Promise((a,t)=>{B({src:e,success:l=>{const o=b(null==l?void 0:l.type,e);uni.getFileSystemManager().readFile({filePath:e,encoding:"base64",success:e=>a(`data:${o};base64,${e.data}`),fail:t})},fail:t})}),b=(e,a)=>{const t=(e||a.split(".").pop()||"").toLowerCase();return"png"===t?"image/png":"gif"===t?"image/gif":"webp"===t?"image/webp":"image/jpeg"};return{MAX_PHOTOS_PER_UPLOAD:5,MAX_TOTAL_BYTES:De,showUpload:c,selectedImages:d,isEncrypted:p,password:v,uploading:f,totalPayloadSize:y,openUpload:async()=>{n.value?(c.value=!0,d.value=[],p.value=!1,v.value=""):s()},closeUpload:m,chooseImages:()=>{const a=5-d.value.length;a<=0?t(e("maxPhotosReached"),"error"):M({count:a,sizeType:["compressed"],sourceType:["album","camera"],success:async a=>{const l=a.tempFilePaths||[];for(const o of l){const a=await h(o),l=a.length;if(l>45e3)t(e("imageTooLarge"),"error");else{if(y.value+l>De){t(e("totalTooLarge"),"error");break}d.value.push({id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,dataUrl:a,size:l})}}}})},removeImage:e=>{d.value=d.value.filter(a=>a.id!==e)},uploadPhotos:async()=>{if(!f.value&&0!==d.value.length)if(n.value)if(!p.value||v.value){f.value=!0;try{const a=await i(),o=[];let s=0;for(const t of d.value){const a=p.value?await u(t.dataUrl,v.value):t.dataUrl;if(a.length>45e3)throw new Error(e("encryptedTooLarge"));if(s+=a.length,s>De)throw new Error(e("totalTooLarge"));o.push(a)}await r({scriptHash:a,operation:"uploadPhotos",args:[{type:"Array",value:o.map(e=>({type:"String",value:e}))},{type:"Array",value:o.map(()=>({type:"Boolean",value:p.value}))}]}),t(e("uploadSuccess"),"success"),m(),d.value=[],await l()}catch(a){t(Ie(a,e("uploadFailed")),"error")}finally{f.value=!1}}else t(e("passwordRequired"),"error");else s()}}}(t,w,x,U),le=o(()=>({activeTab:h.value,address:l.value,photosCount:k.value.length,loadingPhotos:_.value,uploading:G.value})),oe=o(()=>[{label:t("albumTab"),value:k.value.length},{label:t("sidebarEncrypted"),value:k.value.filter(e=>e.encrypted).length},{label:t("sidebarPublic"),value:k.value.filter(e=>!e.encrypted).length}]),se=e=>{"docs"===e?F({url:"/pages/docs/index"}):h.value=e},ne=e=>{console.error("[forever-album] boundary error:",e)},re=async()=>{await x()},ie=async()=>{try{await s(),b.value=!1}catch{b.value=!1}};return(e,a)=>{const o=d,s=i;return n(),r(s,{class:"theme-forever-album"},{default:u(()=>[c(y($e),{config:m,state:le.value,t:y(t),"status-message":y(g),onTabChange:se},{"desktop-sidebar":u(()=>[c(y(me),{title:y(t)("overview"),items:oe.value},null,8,["title","items"])]),content:u(()=>[c(y(fe),{onError:ne,onRetry:re,"fallback-message":y(t)("errorFallback")},{default:u(()=>[c(s,{class:"header"},{default:u(()=>[c(o,{class:"title"},{default:u(()=>[p(v(y(t)("title")),1)]),_:1}),c(o,{class:"subtitle"},{default:u(()=>[p(v(y(t)("subtitle")),1)]),_:1})]),_:1}),y(l)?f("",!0):(n(),r(y(q),{key:0,variant:"warning",class:"connect-card"},{default:u(()=>[c(s,{class:"connect-card__content"},{default:u(()=>[c(o,{class:"connect-card__title"},{default:u(()=>[p(v(y(t)("connectPromptTitle")),1)]),_:1}),c(o,{class:"connect-card__desc"},{default:u(()=>[p(v(y(t)("connectPromptDesc")),1)]),_:1}),c(y(H),{size:"sm",variant:"primary",onClick:U},{default:u(()=>[p(v(y(t)("connectWallet")),1)]),_:1})]),_:1})]),_:1})),c(Ke,{t:y(t),photos:y(k),loading:y(_),onView:y(E),onUpload:y(Q)},null,8,["t","photos","loading","onView","onUpload"]),c(s,{class:"helper-note"},{default:u(()=>[c(o,null,{default:u(()=>[p(v(y(t)("tapToSelect")),1)]),_:1})]),_:1}),c(Ne,{t:y(t),visible:y(C),photo:y($),onClose:y(T),onDecrypt:y(S)},null,8,["t","visible","photo","onClose","onDecrypt"]),c(y(ve),{visible:b.value,onClose:z,onConnect:ie},null,8,["visible"])]),_:1},8,["fallback-message"])]),operation:u(()=>[c(Fe,{t:y(t),visible:y(O),images:y(W),"max-photos":y(V),"max-bytes":y(R),"total-size":y(X),encrypted:y(L),password:y(j),uploading:y(G),onClose:y(Z),onRemove:y(ae),onChoose:y(ee),onConfirm:y(te),"onUpdate:encrypted":a[0]||(a[0]=e=>L.value=e),"onUpdate:password":a[1]||(a[1]=e=>j.value=e)},null,8,["t","visible","images","max-photos","max-bytes","total-size","encrypted","password","uploading","onClose","onRemove","onChoose","onConfirm"]),c(Ue,{t:y(t),visible:y(A),decrypting:y(I),preview:y(P),onClose:y(D),onDecrypt:y(K),onPreview:y(N)},null,8,["t","visible","decrypting","preview","onClose","onDecrypt","onPreview"])]),_:1},8,["state","t","status-message"])]),_:1})}}}),[["__scopeId","data-v-a462fbfe"]]);export{ze as default};
