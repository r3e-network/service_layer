import{u as e,w as t,a as n,b as a}from"./index.BGPP9qu0.js";import{c as o,d as s,e as r,f as i,g as l,h as c,i as d,r as u,j as m,s as p,k as g,l as h,m as v}from"./index.BGPP9qu0.js";import{r as w,o as f}from"./index-B7MqONTz.js";function y(n){const{isLoading:a,error:o,execute:s}=e(async(e,a)=>{const o=parseFloat(e);if(Number.isNaN(o)||o<=0)throw new Error("Invalid amount: must be a positive number");const s=await t();return s.payments.payGASAndInvoke?await s.payments.payGASAndInvoke(n,e,a):await s.payments.payGAS(n,e,a)});return{isLoading:a,error:o,payGAS:s}}function S(n){const a=e(async(e,a,o)=>{if(!e||"string"!=typeof e)throw new Error("Invalid proposalId: must be a non-empty string");const s=parseFloat(a);if(Number.isNaN(s)||s<=0)throw new Error("Invalid amount: must be a positive number");const r=await t();return await r.governance.vote(n,e,a,o)}),o=e(async()=>{const e=await t();return await e.governance.getCandidates()});return{isVoting:a.isLoading,voteError:a.error,vote:a.execute,isLoadingCandidates:o.isLoading,candidatesError:o.error,getCandidates:o.execute}}function _(n){if(!n||"string"!=typeof n)throw new Error("useRNG: appId is required and must be a non-empty string");const{isLoading:a,error:o,execute:s}=e(async()=>{const e=await t();return await e.rng.requestRandom(n)});return{isLoading:a,error:o,requestRandom:s}}function b(){const n=e(async(e={})=>{var n;const a=await t();if(!(null==(n=a.events)?void 0:n.list))throw new Error("events.list not available");return await a.events.list(e)}),a=e(async(e,n)=>{var a;const o=String(e||"").trim();if(!o)throw new Error("eventName required");const s=await t();if(!(null==(a=s.events)?void 0:a.emit))throw new Error("events.emit not available");return await s.events.emit(o,n||{})});return{isLoading:n.isLoading,error:n.error,list:n.execute,isEmitting:a.isLoading,emitError:a.error,emit:a.execute}}function M(){const t=e(async()=>a("/gas-sponsor-check")),o=e(async e=>{const t=parseFloat(e);if(Number.isNaN(t)||t<=0)throw new Error("Invalid amount: must be a positive number");return n("/gas-sponsor-request",{amount:e})});return{isCheckingEligibility:t.isLoading,eligibilityError:t.error,checkEligibility:t.execute,isRequestingSponsorship:o.isLoading,sponsorshipError:o.error,requestSponsorship:o.execute}}function k(e={}){const{slot:n="default",autoLoad:a=!1}=e,o=w([]),s=w(null),r=w(!1),i=w(!1),l=w(!1),c=w(null),d=w(null),u=async e=>{var a;r.value=!0,c.value=null;try{const r=await t(),i=await r.wallet.getAddress(),l=(null==(a=r.getConfig)?void 0:a.call(r).appId)||"unknown",c=await fetch(`/api/miniapps/${l}/cloud-saves`,{headers:{"x-wallet-address":i}});if(!c.ok)throw new Error("Failed to load saves");const u=await c.json();o.value=u.saves||[];const m=e||n;return s.value=o.value.find(e=>e.slot_name===m)||null,d.value=new Date,s.value}catch(i){return c.value=i,null}finally{r.value=!1}};return f(()=>{a&&u()}),{saves:o,currentSave:s,isLoading:r,isSaving:i,isDeleting:l,error:c,lastSyncedAt:d,load:u,save:async(e,a)=>{var o;i.value=!0,c.value=null;try{const r=await t(),i=await r.wallet.getAddress(),l=(null==(o=r.getConfig)?void 0:o.call(r).appId)||"unknown",c=await fetch(`/api/miniapps/${l}/cloud-saves`,{method:"PUT",headers:{"Content-Type":"application/json","x-wallet-address":i},body:JSON.stringify({slot_name:a||n,save_data:e,client_timestamp:(new Date).toISOString()})});if(!c.ok)throw new Error("Failed to save");const u=await c.json();return s.value=u.save,d.value=new Date,!0}catch(r){return c.value=r,!1}finally{i.value=!1}},deleteSave:async e=>{var a,r;l.value=!0,c.value=null;try{const i=await t(),l=await i.wallet.getAddress(),c=(null==(a=i.getConfig)?void 0:a.call(i).appId)||"unknown";if(!(await fetch(`/api/miniapps/${c}/cloud-saves`,{method:"DELETE",headers:{"Content-Type":"application/json","x-wallet-address":l},body:JSON.stringify({slot_name:e||n})})).ok)throw new Error("Failed to delete");return o.value=o.value.filter(t=>t.slot_name!==(e||n)),(null==(r=s.value)?void 0:r.slot_name)===(e||n)&&(s.value=null),!0}catch(i){return c.value=i,!1}finally{l.value=!1}}}}const D=()=>`mock-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,x={invoke:async(e,...t)=>(console.log("[MockSDK] invoke:",e,t),{}),getConfig:()=>({appId:"mock-app",contractAddress:null,debug:!0}),wallet:{getAddress:async()=>(console.log("[MockSDK] getAddress called"),"NXV7ZhHiyM1aHXwpVsRZC6BwNFP2jghXAq"),async switchChain(e){console.log("[MockSDK] switchChain called:",e)},async signMessage(e){return console.log("[MockSDK] signMessage:",e),`mock-signature-${(t=e,"function"==typeof btoa?btoa(t):"undefined"!=typeof Buffer?Buffer.from(t,"utf8").toString("base64"):t).slice(0,12)}`;var t},invokeIntent:async e=>(console.log("[MockSDK] invokeIntent:",e),{txid:D()})},payments:{async payGAS(e,t,n){console.log("[MockSDK] payGAS:",{appId:e,amount:t,memo:n}),await new Promise(e=>setTimeout(e,800));const a=D();return{request_id:a,receipt_id:a,user_id:"mock-user",intent:"payments",constraints:{settlement:"GAS_ONLY"},chain_id:"neo-n3-mainnet",chain_type:"neo-n3",invocation:{chain_id:"neo-n3-mainnet",chain_type:"neo-n3",contract_address:"0x0bb8f09e6d3611bc5c8adbd79ff8af1e34f73193",method:"transfer",params:[t,n??""]}}},async payGASAndInvoke(e,t,n){return{...await this.payGAS(e,t,n),txid:D()}}},governance:{vote:async(e,t,n,a)=>(console.log("[MockSDK] vote:",{appId:e,proposalId:t,amount:n,support:a}),await new Promise(e=>setTimeout(e,800)),{request_id:D(),user_id:"mock-user",intent:"governance",constraints:{governance:"BNEO_ONLY"},chain_id:"neo-n3-mainnet",chain_type:"neo-n3",invocation:{chain_id:"neo-n3-mainnet",chain_type:"neo-n3",contract_address:"0xc8f3bbe1c205c932aab00b28f7df99f9bc788a05",method:"vote",params:[t,n,a]}}),async voteAndInvoke(e,t,n,a){return{...await this.vote(e,t,n,a),txid:D()}},getCandidates:async()=>(console.log("[MockSDK] getCandidates called"),await new Promise(e=>setTimeout(e,500)),{candidates:[{address:"NNShaEBGVBfmGWzGs6W5sCneKPBwmCA3Br",publicKey:"02a1",name:"NeoEconoLabs",votes:"5000000",active:!0},{address:"NdUL5oDPD159KeFpD5A9zw5xNF1xLX6nLT",publicKey:"03b2",name:"COZ",votes:"4500000",active:!0},{address:"NKuyBkoGdZZSLyPbJEetheRhMjeznFZszf",publicKey:"02c3",name:"AxLabs",votes:"3200000",active:!0}],totalVotes:"12700000",blockHeight:1234567})},rng:{async requestRandom(e){console.log("[MockSDK] requestRandom:",e),await new Promise(e=>setTimeout(e,500));const t=Array.from({length:32},()=>Math.floor(256*Math.random()).toString(16).padStart(2,"0")).join("");return{request_id:D(),app_id:e,chain_id:"neo-n3-mainnet",chain_type:"neo-n3",randomness:t}}},datafeed:{async getPrice(e){console.log("[MockSDK] getPrice:",e);return{feed_id:D(),pair:e,price:{"NEO-USD":"12.45","GAS-USD":"4.32","BTC-USD":"43250.00","ETH-USD":"2280.50"}[e]||"100.00",decimals:8,timestamp:(new Date).toISOString(),sources:["mock"]}},getPrices:async()=>(console.log("[MockSDK] getPrices called"),{neo:{usd:12.45,usd_24h_change:1.2},gas:{usd:4.32,usd_24h_change:-.4},timestamp:Date.now()}),getNetworkStats:async()=>(console.log("[MockSDK] getNetworkStats called"),{blockHeight:1234567,validatorCount:7,network:"neo-n3-mainnet",version:"mock-1.0"}),async getRecentTransactions(e=10){console.log("[MockSDK] getRecentTransactions called:",e);const t=Math.max(1,Math.min(e,5));return{blockHeight:1234567,transactions:Array.from({length:t},()=>({txid:D(),blockHeight:1234567,blockTime:Date.now(),sender:"NQiQvS9s5XbPpKXt9g6z4yUaqE8h4PGnRy",size:123,sysfee:"0.1",netfee:"0.01"}))}}},events:{async list(e={}){console.log("[MockSDK] events.list:",e),await new Promise(e=>setTimeout(e,300));const t=D();return{events:[{id:t,app_id:e.app_id||"mock-app",event_name:e.event_name||"MockEvent",chain_id:e.chain_id||"neo-n3-mainnet",contract_address:"0x0000000000000000000000000000000000000000",tx_hash:`0x${D()}`,block_index:1234567,state:[],created_at:(new Date).toISOString()}],has_more:!1,last_id:t}}},transactions:{async list(e={}){console.log("[MockSDK] transactions.list:",e),await new Promise(e=>setTimeout(e,300));const t=D();return{transactions:[{id:t,tx_hash:`0x${t}`,request_id:D(),from_service:"mock",tx_type:"contract",chain_id:e.chain_id||"neo-n3-mainnet",contract_address:"0x0000000000000000000000000000000000000000",method_name:"transfer",params:{},gas_consumed:.1,status:"confirmed",retry_count:0,error_message:null,rpc_endpoint:null,submitted_at:(new Date).toISOString(),confirmed_at:(new Date).toISOString()}],has_more:!1,last_id:t}}},stats:{getMyUsage:async(e,t)=>(console.log("[MockSDK] stats.getMyUsage:",{appId:e,date:t}),await new Promise(e=>setTimeout(e,300)),{app_id:e,chain_id:"neo-n3-mainnet",date:t||(new Date).toISOString().split("T")[0],transactions:42,volume_gas:"123.45",unique_users:10})}};function I(){"undefined"!=typeof window&&(window.MiniAppSDK=x,console.log("[MockSDK] Installed on window.MiniAppSDK"),window.dispatchEvent(new Event("miniapp-sdk-ready")))}function A(){const e=Date.now()+36e5+72e5*Math.random();return{type:"live_countdown",refreshInterval:1,endTime:Math.floor(e/1e3),jackpot:(1e3+9e3*Math.random()).toFixed(2),ticketsSold:Math.floor(100+500*Math.random()),ticketPrice:"0.1"}}function E(){return{type:"live_multiplier",refreshInterval:.1,currentMultiplier:1+5*Math.random(),status:["waiting","running","crashed"][Math.floor(3*Math.random())],playersCount:Math.floor(10+50*Math.random()),totalBets:(100+900*Math.random()).toFixed(2)}}function N(){return{type:"live_canvas",refreshInterval:5,pixels:K(32,32),width:32,height:32,activeUsers:Math.floor(5+20*Math.random())}}function K(e,t){const n=["#10b981","#3b82f6","#ec4899","#f59e0b","#8b5cf6"];let a="";for(let o=0;o<e*t;o++)a+=n[Math.floor(Math.random()*n.length)].slice(1);return a}function L(){return{type:"live_stats",refreshInterval:10,stats:[{label:"Available",value:String(Math.floor(5+20*Math.random())),icon:"ðŸ§§"},{label:"Total GAS",value:(50+200*Math.random()).toFixed(1),change:12.5},{label:"Claimed",value:String(Math.floor(100+500*Math.random()))}]}}function C(){const e=Math.floor(1e3+5e3*Math.random()),t=Math.floor(e*(.3+.5*Math.random()));return{type:"live_voting",refreshInterval:30,proposalTitle:"Increase staking rewards",yesVotes:t,noVotes:e-t,totalVotes:e,endTime:Math.floor((Date.now()+2592e5)/1e3)}}function T(){const e=10+5*Math.random();return{type:"live_price",refreshInterval:5,symbol:"NEO-USD",price:e.toFixed(2),change24h:10*Math.random()-5,sparkline:Array.from({length:24},()=>e*(.95+.1*Math.random()))}}function P(){const e=new AbortController;return{signal:e.signal,cancel:()=>e.abort(),isCancelled:()=>e.signal.aborted}}class G{constructor(){this.controllers=new Map}create(e){this.cancel(e);const t=new AbortController;return this.controllers.set(e,t),t.signal}cancel(e){const t=this.controllers.get(e);t&&(t.abort(),this.controllers.delete(e))}cancelAll(){for(const e of this.controllers.values())e.abort();this.controllers.clear()}isPending(e){const t=this.controllers.get(e);return!!t&&!t.signal.aborted}}const q=new G;export{G as RequestManager,o as apiFetch,a as apiGet,n as apiPost,s as callBridge,r as cleanupWalletStateListener,P as createCancellableRequest,i as createH5Bridge,l as getSDKSync,c as getWalletState,d as initWalletStateListener,I as installMockSDK,N as mockCanvasData,A as mockCountdownData,E as mockMultiplierData,T as mockPriceData,x as mockSDK,L as mockStatsData,C as mockVotingData,q as requestManager,u as resetI18nState,m as resolveLayout,p as subscribeToWalletState,e as useAsyncAction,k as useCloudSaves,g as useDatafeed,b as useEvents,M as useGasSponsor,S as useGovernance,h as useI18n,y as usePayments,_ as useRNG,v as useWallet,t as waitForSDK};
