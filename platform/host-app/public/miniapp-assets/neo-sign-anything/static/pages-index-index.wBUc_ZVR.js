import{r as e,a as n,o as t,b as a,c as o,d as i,e as l,f as r,i as s,w as c,g as d,h as u,j as v,t as h,k as f,u as w,l as g,m as p,n as y,p as m,q as b,s as C,v as _,x as k,y as A}from"./index-BHlIwlVz.js";import{A as I,s as E,w as S,g as T,a as M,_ as x,b as R,u as O}from"./useI18n.CRbxgM9n.js";let N=class extends Error{constructor(e,n){super(e),this.statusCode=n,this.name="HttpError"}};const P={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function D(e,n){return Math.min(n.baseDelayMs*Math.pow(2,e),n.maxDelayMs)*(.75+.5*Math.random())}function $(e,n){if(n&&n>=500)return!0;if(429===n)return!0;if(e instanceof Error){const n=e.message.toLowerCase();return n.includes("network")||n.includes("timeout")||n.includes("abort")}return!1}async function L(n,t){var a;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((a,o)=>{const i=(e=>{if(e){if(e instanceof Headers){const n={};return e.forEach((e,t)=>{n[t]=e}),n}return Array.isArray(e)?Object.fromEntries(e):e}})(t.headers),l=String((null==i?void 0:i["Content-Type"])||(null==i?void 0:i["content-type"])||"");let r=t.body;if("string"==typeof r&&l.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:n,method:t.method||"GET",data:r,header:i,success:e=>{var n,t;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)a(e.data);else{const a=(null==(t=null==(n=e.data)?void 0:n.error)?void 0:t.message)||`Request failed: ${e.statusCode}`;o(new N(a,e.statusCode??0))}},fail:e=>{o(new Error(e.errMsg||"Network error"))}})});const o="undefined"!=typeof window&&n.startsWith(window.location.origin),i=await fetch(n,{credentials:o?"include":"same-origin",...t});if(!i.ok){const e=await i.json().catch(()=>({}));throw new N((null==(a=e.error)?void 0:a.message)||`Request failed: ${n}`,i.status)}return i.json()}async function j(e){return async function(e,n={}){var t,a;const o=e.startsWith("http")?e:`${I}${e}`,i={...P,...n.retryConfig};let l=null;for(let s=0;s<=i.maxRetries;s++){if(null==(t=n.signal)?void 0:t.aborted)throw new Error("Request cancelled");try{return await L(o,n)}catch(r){l=r instanceof Error?r:new Error(String(r));const e=r instanceof N?r.statusCode:void 0;if(null==(a=n.signal)?void 0:a.aborted)throw l;if(s>=i.maxRetries)break;if(!$(r,e))break;const t=D(s,i);await new Promise(e=>setTimeout(e,t))}}throw l||new Error("Request failed")}(e,{method:"GET"})}let K=null;function q(){const e=n(null),o=n({}),i=n(null),l=n(null),r=n(null),s=n([]),c=n(!1),d=n(!1),u=n(null),v=n(!1),h=n(null),f=n=>{n.connected&&n.address?(e.value=n.address,c.value=!0):(e.value=null,c.value=!1),i.value=n.chainId??null,l.value=n.chainType??null,o.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const n={};return n[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(n[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),n}return{}})(n)},w=e=>{e&&(r.value=e.chainId??null,s.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const n=await S(),t=null==(e=n.getConfig)?void 0:e.call(n);return w(t),t},p=async e=>{const n=await S();if(!n.wallet.switchChain)throw new Error("switchChain not supported by SDK");await n.wallet.switchChain(e),i.value=e};let y=null;return t(()=>{const n=M();f(n),y=E(e=>{f(e)});const t=T();(null==t?void 0:t.getConfig)&&w(t.getConfig()),t&&!c.value&&(e=>e?(K||(K=e.wallet.getAddress().then(e=>e||null).catch(e=>{const n=e instanceof Error?e.message:String(e);return console.debug("[MiniApp SDK] Fallback wallet connection failed:",n),null}).finally(()=>{K=null})),K):Promise.resolve(null))(t).then(n=>{var a;if(!c.value&&n){e.value=n,c.value=!0;const o=null==(a=t.getConfig)?void 0:a.call(t);i.value=(null==o?void 0:o.chainId)??null,l.value=(null==o?void 0:o.chainType)??null,w(o)}}),S().then(e=>{var n;return w(null==(n=e.getConfig)?void 0:n.call(e))}).catch(()=>{})}),a(()=>{y&&y()}),{address:e,chainId:i,chainType:l,appChainId:r,supportedChains:s,balances:o,isConnected:c,isLoading:d,error:u,showConnectionPrompt:v,connectionPromptMessage:h,connect:async()=>{var n;d.value=!0,u.value=null;try{const t=await S(),a=await t.wallet.getAddress();if(!a)throw new Error("wallet returned empty address");e.value=a,c.value=!0;const o=null==(n=t.getConfig)?void 0:n.call(t);i.value=(null==o?void 0:o.chainId)??null,l.value=(null==o?void 0:o.chainType)??null,w(o)}catch(t){u.value=t}finally{d.value=!1}},invokeIntent:async e=>{var n;const t=T();if(!(null==(n=null==t?void 0:t.wallet)?void 0:n.invokeIntent))throw new Error("invokeIntent not available");return t.wallet.invokeIntent(e)},invokeContract:async e=>{var n;const t=await S(),a=null==(n=t.getConfig)?void 0:n.call(t),o=e.contractAddress||e.scriptHash||e.contractHash,i=e.method||e.operation;if(!o||!i)throw new Error("contract address and method required");return t.invoke("invokeFunction",{contract:o,method:i,args:e.args,chainId:null==a?void 0:a.chainId,chainType:null==a?void 0:a.chainType})},invokeRead:async e=>{var n;const t=await S(),a=null==(n=t.getConfig)?void 0:n.call(t),o=e.contractAddress||e.scriptHash||e.contractHash||(null==a?void 0:a.contractAddress),i=e.method||e.operation;if(!o)throw new Error("contract address not configured");if(!i)throw new Error("method required");return t.invoke("invokeRead",{contract:o,method:i,args:e.args||[],chainId:e.chainId||(null==a?void 0:a.chainId),chainType:e.chainType||(null==a?void 0:a.chainType)})},getContractAddress:async()=>{var e,n,t,a,o;const i=await S(),l=null==(e=i.getConfig)?void 0:e.call(i);if(null==l?void 0:l.contractAddress)return l.contractAddress;if((null==l?void 0:l.chainId)&&(null==(t=null==(n=null==l?void 0:l.chainContracts)?void 0:n[l.chainId])?void 0:t.address))return l.chainContracts[l.chainId].address||null;if(i.invoke)try{const e=await i.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(o=null==(a=null==e?void 0:e.chainContracts)?void 0:a[e.chainId])?void 0:o.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await S()).wallet.getAddress(),signMessage:async e=>{var n;const t=await S();if(!(null==(n=t.wallet)?void 0:n.signMessage))throw new Error("signMessage not available");return t.wallet.signMessage(e)},switchChain:p,switchToAppChain:async e=>{const n=await g(),t=(null==n?void 0:n.chainId)||(Array.isArray(null==n?void 0:n.supportedChains)&&n.supportedChains.length>0?n.supportedChains[0]:null)||e||null;if(!t)throw new Error("app chain not configured");await p(t)},getBalance:async e=>{var n;d.value=!0,u.value=null;try{const t=await S(),a=null==(n=t.getConfig)?void 0:n.call(t),l=(null==a?void 0:a.chainId)||i.value,r=l?`?chain_id=${encodeURIComponent(l)}`:"",s=await j(`/wallet-balance${r}`),c=(null==s?void 0:s.balances)??{};return o.value=c,e?c[e]||"0":c}catch(t){throw u.value=t,t}finally{d.value=!1}},getTransactions:async(e=20)=>{var n;d.value=!0,u.value=null;try{const t=Number.isNaN(e)||e<1?20:Math.min(e,100),a=await S(),o=null==(n=a.getConfig)?void 0:n.call(a),l=(null==o?void 0:o.chainId)||i.value,r=new URLSearchParams({limit:String(t)});l&&r.set("chain_id",l);const s=await j(`/wallet-transactions?${r.toString()}`);return(null==s?void 0:s.transactions)??[]}catch(t){throw u.value=t,t}finally{d.value=!1}},invoke:async(e,n)=>(await S()).invoke(e,n),requireConnection:(e={})=>{const{showPrompt:n=!0,errorMessage:t}=e;return!!c.value||(n&&(h.value=t||null,v.value=!0),!1)},closeConnectionPrompt:()=>{v.value=!1,h.value=null},clearError:()=>{u.value=null}}}const W=x(i({__name:"ChainWarning",props:{title:{default:"Wrong Network"},message:{default:"Switch to Neo N3 Mainnet to continue."},buttonText:{default:"Switch Network"},show:{type:Boolean,default:void 0}},emits:["switch","switch-complete","switch-error"],setup(e,{emit:t}){const a=e,i=t,{showWarning:g,switchToAppChain:p}=function(){const{switchToAppChain:e}=q();return{showWarning:o(()=>!1),switchToAppChain:async()=>{try{await e()}catch(n){throw console.error("[useChainValidation] Failed to switch chain:",n),n}}}}(),y=n(!1),m=o(()=>void 0!==a.show?a.show:g.value),b=async()=>{if(!y.value){y.value=!0,i("switch");try{await p(),i("switch-complete")}catch(e){const n=e instanceof Error?e:new Error(String(e));i("switch-error",n),console.error("[ChainWarning] Failed to switch chain:",n)}finally{y.value=!1}}};return(e,n)=>{const t=u,a=s;return m.value?(l(),r(a,{key:0,class:"chain-warning px-4 mb-4"},{default:c(()=>[d(w(G),{variant:"danger"},{default:c(()=>[d(a,{class:"flex flex-col items-center gap-2 py-1"},{default:c(()=>[d(t,{class:"text-center font-bold text-red-400"},{default:c(()=>[v(h(e.title),1)]),_:1}),e.message?(l(),r(t,{key:0,class:"text-xs text-center opacity-80 text-white"},{default:c(()=>[v(h(e.message),1)]),_:1})):f("",!0),d(w(H),{size:"sm",variant:"secondary",class:"mt-2",loading:y.value,onClick:b},{default:c(()=>[v(h(e.buttonText),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):f("",!0)}}}),[["__scopeId","data-v-3dc811c7"]]),G=x(i({__name:"NeoCard",props:{title:{default:void 0},variant:{default:"default"},hoverable:{type:Boolean,default:!1},flat:{type:Boolean,default:!1}},emits:["click"],setup:e=>(e,n)=>{const t=u,a=s;return l(),r(a,{class:y(["neo-card",`neo-card--${e.variant}`,{"neo-card--hoverable":e.hoverable,"neo-card--flat":e.flat}]),role:e.hoverable?"button":void 0,tabindex:e.hoverable?0:void 0,onClick:n[0]||(n[0]=n=>e.hoverable&&e.$emit("click",n)),onKeydown:[n[1]||(n[1]=g(n=>e.hoverable&&e.$emit("click",n),["enter"])),n[2]||(n[2]=g(p(n=>e.hoverable&&e.$emit("click",n),["prevent"]),["space"]))]},{default:c(()=>[e.title||e.$slots.header?(l(),r(a,{key:0,class:"neo-card__header"},{default:c(()=>[e.title?(l(),r(t,{key:0,class:"neo-card__title"},{default:c(()=>[v(h(e.title),1)]),_:1})):f("",!0),m(e.$slots,"header",{},void 0,!0)]),_:3})):f("",!0),d(a,{class:"neo-card__body"},{default:c(()=>[m(e.$slots,"default",{},void 0,!0)]),_:3}),e.$slots.footer?(l(),r(a,{key:1,class:"neo-card__footer"},{default:c(()=>[m(e.$slots,"footer",{},void 0,!0)]),_:3})):f("",!0)]),_:3},8,["class","role","tabindex"])}}),[["__scopeId","data-v-3f370003"]]),H=x(i({__name:"NeoButton",props:{variant:{default:"primary"},size:{default:"md"},block:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},ariaLabel:{default:void 0}},emits:["click"],setup:e=>(e,n)=>{const t=s,a=b;return l(),r(a,{class:y(["neo-btn",`neo-btn--${e.variant}`,`neo-btn--${e.size}`,{"neo-btn--block":e.block,"neo-btn--loading":e.loading}]),disabled:e.disabled||e.loading,"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading,"aria-label":e.ariaLabel,onClick:n[0]||(n[0]=n=>e.$emit("click",n))},{default:c(()=>[e.loading?(l(),r(t,{key:0,class:"neo-btn__spinner"})):m(e.$slots,"default",{key:1},void 0,!0)]),_:3},8,["class","disabled","aria-busy","aria-disabled","aria-label"])}}),[["__scopeId","data-v-4b6100e3"]]),B=5e3,U=1e4,V=100,F=["https://neomini.app","https://miniapp.neo.org","https://testnet.miniapp.neo.org"];const z=new class{constructor(){this.dynamicOrigins=new Set,this.baseOrigins=new Set([...F])}getSelfOrigin(){if("undefined"==typeof window)return null;try{const e=new URL(window.location.href);if("null"===e.origin)return null;if("http:"===e.protocol||"https:"===e.protocol)return e.origin}catch{}return null}getReferrerOrigin(){if("undefined"==typeof document||!document.referrer)return null;try{return new URL(document.referrer).origin}catch{return null}}getAllowedOrigins(){const e=new Set(this.baseOrigins);this.dynamicOrigins.forEach(n=>e.add(n));const n=this.getReferrerOrigin();n&&this.baseOrigins.has(n)&&e.add(n);const t=this.getSelfOrigin();if(t&&e.add(t),"undefined"!=typeof window){const n=window.location.hostname;"localhost"!==n&&"127.0.0.1"!==n||e.add(window.location.origin)}return e}isValid(e){return!(!e||"null"===e)&&this.getAllowedOrigins().has(e)}getTargetOrigin(){var e;const n=this.getReferrerOrigin();if(n&&this.baseOrigins.has(n))return n;try{if("undefined"!=typeof window&&window.parent!==window&&(null==(e=window.location.ancestorOrigins)?void 0:e.length)>0){const e=window.location.ancestorOrigins[0];if(this.baseOrigins.has(e))return e}}catch{}const t=this.getSelfOrigin();if(t)return t;if("undefined"!=typeof window){const e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return window.location.origin}throw new Error("Cannot determine safe target origin - no valid origin found")}getSafeTargetOrigin(){try{const e=this.getTargetOrigin();if(e&&"null"!==e)return e}catch{}if("undefined"!=typeof window&&window.parent!==window){const e=window.__MINIAPP_PARENT_ORIGIN__;if("string"==typeof e&&e&&this.baseOrigins.has(e))return e;throw new Error("Cannot communicate securely with parent - origin unknown. Ensure host app sets __MINIAPP_PARENT_ORIGIN__ or uses a supported browser.")}throw new Error("Cannot determine safe target origin - origin is null or undefined")}addDynamicOrigin(e){e&&"null"!==e&&this.dynamicOrigins.add(e)}};let J=null;function Q(e){const n=null==e?void 0:e.layout;if("web"===n||"mobile"===n)return n;if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("layout");if("web"===e||"mobile"===e)return e;if(window.ReactNativeWebView)return"mobile"}return"web"}function X(e){if(!e||"object"!=typeof e)return!1;const n="function"==typeof e.invoke&&"function"==typeof e.getConfig,t="object"==typeof e.wallet||"object"==typeof e.payments;return n||t}function Y(e=B){return new Promise((n,t)=>{if("undefined"==typeof window)return void t(new Error("SDK not available in SSR"));if(window.MiniAppSDK)return X(window.MiniAppSDK)?void n(window.MiniAppSDK):void t(new Error("SDK validation failed"));const a=setTimeout(()=>{if(window.removeEventListener("miniapp-sdk-ready",o),window.parent!==window){const e=function(){const e=z.getSafeTargetOrigin();let n=0;const t=(t,...a)=>new Promise((o,i)=>{const l="undefined"!=typeof crypto&&crypto.getRandomValues?Array.from(crypto.getRandomValues(new Uint8Array(4)),e=>e.toString(16).padStart(2,"0")).join(""):Math.random().toString(36).slice(2,10),r=`sdk-${++n}-${Date.now()}-${l}`,s=setTimeout(()=>{window.removeEventListener("message",c),i(new Error("SDK invoke timeout"))},U),c=e=>{var n,t;z.isValid(e.origin)&&e.source===window.parent&&"miniapp_sdk_response"===(null==(n=e.data)?void 0:n.type)&&(null==(t=e.data)?void 0:t.id)===r&&(clearTimeout(s),window.removeEventListener("message",c),e.data.ok?o(e.data.result):i(new Error(e.data.error||"SDK call failed")))};window.addEventListener("message",c),window.parent.postMessage({type:"miniapp_sdk_request",id:r,method:t,params:a},e)});return{invoke:t,getConfig:()=>J?{...J,layout:Q(J)}:"undefined"!=typeof window&&window.__MINIAPP_CONFIG__?(J=window.__MINIAPP_CONFIG__,{...J,layout:Q(J??void 0)}):{appId:"",contractAddress:null,chainId:null,chainType:void 0,supportedChains:[],layout:Q(),debug:!1},getAddress:()=>t("getAddress"),wallet:{getAddress:()=>t("wallet.getAddress"),switchChain:e=>t("wallet.switchChain",e),invokeIntent:e=>t("wallet.invokeIntent",e),signMessage:e=>t("wallet.signMessage",e)},payments:{payGAS:(e,n,a)=>t("payments.payGAS",e,n,a),payGASAndInvoke:(e,n,a)=>t("payments.payGASAndInvoke",e,n,a)},governance:{vote:(e,n,a,o)=>t("governance.vote",e,n,a,o),voteAndInvoke:(e,n,a,o)=>t("governance.voteAndInvoke",e,n,a,o),getCandidates:()=>t("governance.getCandidates")},rng:{requestRandom:e=>t("rng.requestRandom",e)},datafeed:{getPrice:e=>t("datafeed.getPrice",e),getPrices:()=>t("datafeed.getPrices"),getNetworkStats:()=>t("datafeed.getNetworkStats"),getRecentTransactions:e=>t("datafeed.getRecentTransactions",e)},stats:{getMyUsage:(e,n)=>t("stats.getMyUsage",e,n)},events:{list:e=>t("events.list",e),emit:(e,n)=>t("events.emit",e,n)},transactions:{list:e=>t("transactions.list",e)},automation:{register:(e,n,a,o)=>t("automation.register",e,n,a,o),unregister:e=>t("automation.unregister",e),status:e=>t("automation.status",e),list:()=>t("automation.list"),update:(e,n,a)=>t("automation.update",e,n,a),enable:e=>t("automation.enable",e),disable:e=>t("automation.disable",e),logs:(e,n)=>t("automation.logs",e,n)},share:{openModal:e=>t("share.openModal",e),getUrl:e=>t("share.getUrl",e),copy:e=>t("share.copy",e)}}}();window.MiniAppSDK=e,e.invoke("getConfig").then(e=>{e&&"object"==typeof e&&(J=e)}).catch(()=>{}),n(e)}else t(new Error("SDK timeout"))},e),o=()=>{if(clearTimeout(a),window.removeEventListener("miniapp-sdk-ready",o),window.MiniAppSDK){if(!X(window.MiniAppSDK))return void t(new Error("SDK validation failed"));n(window.MiniAppSDK)}else t(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",o)})}function Z(){return"undefined"==typeof window?null:window.MiniAppSDK??null}const ee=new Set;let ne={connected:!1,address:null,balance:null},te=null,ae=!1;"undefined"!=typeof window&&("undefined"!=typeof window&&(ae&&te||(te=e=>{if(e.source!==window.parent)return;if(!z.isValid(e.origin))return;const n=e.data;n&&"object"==typeof n&&("miniapp_config"!==n.type?"miniapp_wallet_state_change"===n.type&&(ne={connected:Boolean(n.connected),address:n.address||null,chainId:n.chainId??null,chainType:n.chainType??null,balance:n.balance||n.multiChainBalance||null,balances:n.balances||void 0},ee.forEach(e=>{try{e(ne)}catch(n){console.error("[MiniApp SDK] Wallet state listener error:",n)}})):n.config&&"object"==typeof n.config&&(J=n.config))},window.addEventListener("message",te),ae=!0)),setTimeout(function(){if("undefined"==typeof window)return;const e=z.getSafeTargetOrigin();try{window.parent.postMessage({type:"miniapp_ready"},e)}catch{}},V));class oe extends Error{constructor(e,n){super(e),this.statusCode=n,this.name="HttpError"}}const ie={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function le(e,n){return Math.min(n.baseDelayMs*Math.pow(2,e),n.maxDelayMs)*(.75+.5*Math.random())}function re(e,n){if(n&&n>=500)return!0;if(429===n)return!0;if(e instanceof Error){const n=e.message.toLowerCase();return n.includes("network")||n.includes("timeout")||n.includes("abort")}return!1}async function se(n,t){var a;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((a,o)=>{const i=(e=>{if(e){if(e instanceof Headers){const n={};return e.forEach((e,t)=>{n[t]=e}),n}return Array.isArray(e)?Object.fromEntries(e):e}})(t.headers),l=String((null==i?void 0:i["Content-Type"])||(null==i?void 0:i["content-type"])||"");let r=t.body;if("string"==typeof r&&l.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:n,method:t.method||"GET",data:r,header:i,success:e=>{var n,t;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)a(e.data);else{const a=(null==(t=null==(n=e.data)?void 0:n.error)?void 0:t.message)||`Request failed: ${e.statusCode}`;o(new oe(a,e.statusCode??0))}},fail:e=>{o(new Error(e.errMsg||"Network error"))}})});const o="undefined"!=typeof window&&n.startsWith(window.location.origin),i=await fetch(n,{credentials:o?"include":"same-origin",...t});if(!i.ok){const e=await i.json().catch(()=>({}));throw new oe((null==(a=e.error)?void 0:a.message)||`Request failed: ${n}`,i.status)}return i.json()}async function ce(e){return async function(e,n={}){var t,a;const o=e.startsWith("http")?e:`https://api.neo-service-layer.io${e}`,i={...ie,...n.retryConfig};let l=null;for(let s=0;s<=i.maxRetries;s++){if(null==(t=n.signal)?void 0:t.aborted)throw new Error("Request cancelled");try{return await se(o,n)}catch(r){l=r instanceof Error?r:new Error(String(r));const e=r instanceof oe?r.statusCode:void 0;if(null==(a=n.signal)?void 0:a.aborted)throw l;if(s>=i.maxRetries)break;if(!re(r,e))break;const t=le(s,i);await new Promise(e=>setTimeout(e,t))}}throw l||new Error("Request failed")}(e,{method:"GET"})}let de=null;function ue(){const e=n(null),o=n({}),i=n(null),l=n(null),r=n(null),s=n([]),c=n(!1),d=n(!1),u=n(null),v=n(!1),h=n(null),f=n=>{n.connected&&n.address?(e.value=n.address,c.value=!0):(e.value=null,c.value=!1),i.value=n.chainId??null,l.value=n.chainType??null,o.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const n={};return n[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(n[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),n}return{}})(n)},w=e=>{e&&(r.value=e.chainId??null,s.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const n=await Y(),t=null==(e=n.getConfig)?void 0:e.call(n);return w(t),t},p=async e=>{const n=await Y();if(!n.wallet.switchChain)throw new Error("switchChain not supported by SDK");await n.wallet.switchChain(e),i.value=e};let y=null;return t(()=>{var n;f(ne),n=e=>{f(e)},ee.add(n),n(ne),y=()=>ee.delete(n);const t=Z();(null==t?void 0:t.getConfig)&&w(t.getConfig()),t&&!c.value&&(e=>e?(de||(de=e.wallet.getAddress().then(e=>e||null).catch(e=>{const n=e instanceof Error?e.message:String(e);return console.debug("[MiniApp SDK] Fallback wallet connection failed:",n),null}).finally(()=>{de=null})),de):Promise.resolve(null))(t).then(n=>{var a;if(!c.value&&n){e.value=n,c.value=!0;const o=null==(a=t.getConfig)?void 0:a.call(t);i.value=(null==o?void 0:o.chainId)??null,l.value=(null==o?void 0:o.chainType)??null,w(o)}}),Y().then(e=>{var n;return w(null==(n=e.getConfig)?void 0:n.call(e))}).catch(()=>{})}),a(()=>{y&&y()}),{address:e,chainId:i,chainType:l,appChainId:r,supportedChains:s,balances:o,isConnected:c,isLoading:d,error:u,showConnectionPrompt:v,connectionPromptMessage:h,connect:async()=>{var n;d.value=!0,u.value=null;try{const t=await Y(),a=await t.wallet.getAddress();if(!a)throw new Error("wallet returned empty address");e.value=a,c.value=!0;const o=null==(n=t.getConfig)?void 0:n.call(t);i.value=(null==o?void 0:o.chainId)??null,l.value=(null==o?void 0:o.chainType)??null,w(o)}catch(t){u.value=t}finally{d.value=!1}},invokeIntent:async e=>{var n;const t=Z();if(!(null==(n=null==t?void 0:t.wallet)?void 0:n.invokeIntent))throw new Error("invokeIntent not available");return t.wallet.invokeIntent(e)},invokeContract:async e=>{var n;const t=await Y(),a=null==(n=t.getConfig)?void 0:n.call(t),o=e.contractAddress||e.scriptHash||e.contractHash,i=e.method||e.operation;if(!o||!i)throw new Error("contract address and method required");return t.invoke("invokeFunction",{contract:o,method:i,args:e.args,chainId:null==a?void 0:a.chainId,chainType:null==a?void 0:a.chainType})},invokeRead:async e=>{var n;const t=await Y(),a=null==(n=t.getConfig)?void 0:n.call(t),o=e.contractAddress||e.scriptHash||e.contractHash||(null==a?void 0:a.contractAddress),i=e.method||e.operation;if(!o)throw new Error("contract address not configured");if(!i)throw new Error("method required");return t.invoke("invokeRead",{contract:o,method:i,args:e.args||[],chainId:e.chainId||(null==a?void 0:a.chainId),chainType:e.chainType||(null==a?void 0:a.chainType)})},getContractAddress:async()=>{var e,n,t,a,o;const i=await Y(),l=null==(e=i.getConfig)?void 0:e.call(i);if(null==l?void 0:l.contractAddress)return l.contractAddress;if((null==l?void 0:l.chainId)&&(null==(t=null==(n=null==l?void 0:l.chainContracts)?void 0:n[l.chainId])?void 0:t.address))return l.chainContracts[l.chainId].address||null;if(i.invoke)try{const e=await i.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(o=null==(a=null==e?void 0:e.chainContracts)?void 0:a[e.chainId])?void 0:o.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await Y()).wallet.getAddress(),signMessage:async e=>{var n;const t=await Y();if(!(null==(n=t.wallet)?void 0:n.signMessage))throw new Error("signMessage not available");return t.wallet.signMessage(e)},switchChain:p,switchToAppChain:async e=>{const n=await g(),t=(null==n?void 0:n.chainId)||(Array.isArray(null==n?void 0:n.supportedChains)&&n.supportedChains.length>0?n.supportedChains[0]:null)||e||null;if(!t)throw new Error("app chain not configured");await p(t)},getBalance:async e=>{var n;d.value=!0,u.value=null;try{const t=await Y(),a=null==(n=t.getConfig)?void 0:n.call(t),l=(null==a?void 0:a.chainId)||i.value,r=l?`?chain_id=${encodeURIComponent(l)}`:"",s=await ce(`/wallet-balance${r}`),c=(null==s?void 0:s.balances)??{};return o.value=c,e?c[e]||"0":c}catch(t){throw u.value=t,t}finally{d.value=!1}},getTransactions:async(e=20)=>{var n;d.value=!0,u.value=null;try{const t=Number.isNaN(e)||e<1?20:Math.min(e,100),a=await Y(),o=null==(n=a.getConfig)?void 0:n.call(a),l=(null==o?void 0:o.chainId)||i.value,r=new URLSearchParams({limit:String(t)});l&&r.set("chain_id",l);const s=await ce(`/wallet-transactions?${r.toString()}`);return(null==s?void 0:s.transactions)??[]}catch(t){throw u.value=t,t}finally{d.value=!1}},invoke:async(e,n)=>(await Y()).invoke(e,n),requireConnection:(e={})=>{const{showPrompt:n=!0,errorMessage:t}=e;return!!c.value||(n&&(h.value=t||null,v.value=!0),!1)},closeConnectionPrompt:()=>{v.value=!1,h.value=null},clearError:()=>{u.value=null}}}n("en");const ve=new Set(["neo-n3","neo-n3-mainnet","neo-n3-testnet"]);function he(e,n,t,a){const o=function(e){if("string"==typeof e)return e;const n=null==e?void 0:e.value;return"string"==typeof n?n:""}(e);if(ve.has(o))return!0;let i="";if(!i&&"function"==typeof n){const e=n("wrongChainMessage");i=e&&"wrongChainMessage"!==e?e:n("wrongChain")}i||(i="Wrong network");const l=globalThis.uni;return(null==l?void 0:l.showToast)&&l.showToast({title:i,icon:"none"}),!1}const fe=x(i({__name:"index",setup(e){const i=n(window.innerWidth);o(()=>i.value<768),o(()=>i.value>=1024);const g=()=>{i.value=window.innerWidth};t(()=>window.addEventListener("resize",g)),a(()=>window.removeEventListener("resize",g));const{t:p}=O(),y=n(""),m=n(""),b=n(""),I=n(!1),E=n(!1),S=n("home"),{address:T,connect:M,signMessage:x,invokeContract:N,chainType:P}=ue(),D=e=>{"docs"===e?A({url:"/pages/docs/index"}):S.value=e},$=async()=>{if(y.value&&he(P,p)){I.value=!0,m.value="",b.value="";try{if(T.value||await M(),!T.value)throw new Error(p("connectWallet"));const e=await x(y.value);"string"==typeof e?m.value=e:e&&"object"==typeof e&&e.signature?m.value=e.signature:m.value=JSON.stringify(e)}catch(e){_({title:e.message||p("signFailed"),icon:"none"})}finally{I.value=!1}}},L=async()=>{if(y.value&&he(P,p))if(e=y.value,("undefined"!=typeof TextEncoder?(new TextEncoder).encode(e).length:encodeURIComponent(e).replace(/%[0-9A-F]{2}/g,"x").length)>1024)_({title:p("messageTooLong"),icon:"none"});else{var e;E.value=!0,b.value="",m.value="";try{if(T.value||await M(),!T.value)throw new Error(p("connectWallet"));const e=await N({scriptHash:"0xd2a4cff31913016155e38e474a2c06d08be276cf",operation:"transfer",args:[{type:"Hash160",value:T.value},{type:"Hash160",value:T.value},{type:"Integer",value:"0"},{type:"String",value:y.value}]});e&&e.txid?b.value=e.txid:b.value="string"==typeof e?e:p("txPending")}catch(n){_({title:n.message||p("broadcastFailed"),icon:"none"})}finally{E.value=!1}}},j=e=>{k({data:e,success:()=>{_({title:p("copySuccess"),icon:"none"})}})};return(e,n)=>{const t=u,a=s,o=C;return l(),r(w(R),{"desktop-breakpoint":1024,class:"theme-neo-sign-anything",title:w(p)("appTitle"),"show-top-nav":!1,"active-tab":S.value,tabs:[{id:"home",label:w(p)("home"),icon:"Home"},{id:"docs",label:w(p)("docs"),icon:"Book"}],onTabChange:D,"\x3c!--":"",Desktop:"",Sidebar:"","--":""},{"desktop-sidebar":c(()=>[d(a,{class:"desktop-sidebar"},{default:c(()=>[d(t,{class:"sidebar-title"},{default:c(()=>[v(h(w(p)("overview")),1)]),_:1})]),_:1})]),default:c(()=>[d(a,{class:"container"},{default:c(()=>[d(w(W),{title:w(p)("wrongChain"),message:w(p)("wrongChainMessage"),"button-text":w(p)("switchToNeo")},null,8,["title","message","button-text"]),d(a,{class:"header"},{default:c(()=>[d(t,{class:"title"},{default:c(()=>[v(h(w(p)("signTitle")),1)]),_:1}),d(t,{class:"subtitle"},{default:c(()=>[v(h(w(p)("signDesc")),1)]),_:1})]),_:1}),d(w(G),{variant:"erobo"},{default:c(()=>[d(a,{class:"input-group"},{default:c(()=>[d(t,{class:"label"},{default:c(()=>[v(h(w(p)("messageLabel")),1)]),_:1}),d(o,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),class:"textarea",placeholder:w(p)("messagePlaceholder"),maxlength:"1000"},null,8,["modelValue","placeholder"]),d(a,{class:"char-count"},{default:c(()=>[v(h(y.value.length)+"/1000",1)]),_:1})]),_:1}),d(a,{class:"actions"},{default:c(()=>[d(w(H),{variant:"primary",block:"",loading:I.value,onClick:$,disabled:!y.value||!w(T)},{default:c(()=>[v(h(w(p)("signBtn")),1)]),_:1},8,["loading","disabled"]),d(w(H),{variant:"ghost",block:"",loading:E.value,onClick:L,disabled:!y.value||!w(T),style:{"margin-top":"12px"}},{default:c(()=>[v(h(w(p)("broadcastBtn")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),m.value?(l(),r(a,{key:0,class:"result-card"},{default:c(()=>[d(w(G),{variant:"erobo-neo"},{default:c(()=>[d(a,{class:"result-header"},{default:c(()=>[d(t,{class:"result-title"},{default:c(()=>[v(h(w(p)("signatureResult")),1)]),_:1}),d(a,{class:"copy-btn",onClick:n[1]||(n[1]=e=>j(m.value))},{default:c(()=>[d(t,{class:"copy-text"},{default:c(()=>[v(h(w(p)("copy")),1)]),_:1})]),_:1})]),_:1}),d(t,{class:"result-text"},{default:c(()=>[v(h(m.value),1)]),_:1})]),_:1})]),_:1})):f("",!0),b.value?(l(),r(a,{key:1,class:"result-card"},{default:c(()=>[d(w(G),{variant:"erobo-purple"},{default:c(()=>[d(a,{class:"result-header"},{default:c(()=>[d(t,{class:"result-title"},{default:c(()=>[v(h(w(p)("broadcastResult")),1)]),_:1}),d(a,{class:"copy-btn",onClick:n[2]||(n[2]=e=>j(b.value))},{default:c(()=>[d(t,{class:"copy-text"},{default:c(()=>[v(h(w(p)("copy")),1)]),_:1})]),_:1})]),_:1}),d(t,{class:"result-text"},{default:c(()=>[v(h(b.value),1)]),_:1}),d(t,{class:"success-msg"},{default:c(()=>[v(h(w(p)("broadcastSuccess")),1)]),_:1})]),_:1})]),_:1})):f("",!0),w(T)?f("",!0):(l(),r(a,{key:2,class:"connect-prompt"},{default:c(()=>[d(t,{class:"connect-text"},{default:c(()=>[v(h(w(p)("connectWallet")),1)]),_:1})]),_:1}))]),_:1})]),_:1},8,["title","active-tab","tabs"])}}}),[["__scopeId","data-v-8d147b36"]]);export{fe as default};
