import{r as e,a as n,o as a,b as t,c as i,d as o,e as l,f as r,i as s,w as c,g as d,h as u,j as v,t as h,k as f,u as w,n as g,l as p,m as y,p as m,s as b,q as C,v as _}from"./index-D5GBothm.js";import{A as k,s as I,w as A,g as E,a as S,_ as T,b as M,u as x}from"./useI18n.BIdGDSbj.js";const R={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function O(e,n){return Math.min(n.baseDelayMs*Math.pow(2,e),n.maxDelayMs)*(.75+.5*Math.random())}function N(e,n){if(e instanceof Error){const n=e.message.toLowerCase();return n.includes("network")||n.includes("timeout")||n.includes("abort")}return!1}async function P(n,a){var t;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((t,i)=>{const o=(e=>{if(e){if(e instanceof Headers){const n={};return e.forEach((e,a)=>{n[a]=e}),n}return Array.isArray(e)?Object.fromEntries(e):e}})(a.headers),l=String((null==o?void 0:o["Content-Type"])||(null==o?void 0:o["content-type"])||"");let r=a.body;if("string"==typeof r&&l.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:n,method:a.method||"GET",data:r,header:o,success:e=>{var n,a;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)t(e.data);else{const t=(null==(a=null==(n=e.data)?void 0:n.error)?void 0:a.message)||`Request failed: ${e.statusCode}`;i(new Error(t))}},fail:e=>{i(new Error(e.errMsg||"Network error"))}})});const i=await fetch(n,{credentials:"include",...a});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error((null==(t=e.error)?void 0:t.message)||`Request failed: ${n}`)}return i.json()}async function D(e){return async function(e,n={}){var a,t;const i=e.startsWith("http")?e:`${k}${e}`,o={...R,...n.retryConfig};let l=null;for(let s=0;s<=o.maxRetries;s++){if(null==(a=n.signal)?void 0:a.aborted)throw new Error("Request cancelled");try{return await P(i,n)}catch(r){if(l=r instanceof Error?r:new Error(String(r)),null==(t=n.signal)?void 0:t.aborted)throw l;if(s>=o.maxRetries)break;if(!N(r))break;const e=O(s,o);await new Promise(n=>setTimeout(n,e))}}throw l||new Error("Request failed")}(e,{method:"GET"})}let $=null,L=null;function j(){const e=n(null),i=n({}),o=n(null),l=n(null),r=n(null),s=n([]),c=n(!1),d=n(!1),u=n(null),v=n(!1),h=n(null),f=n=>{n.connected&&n.address?(e.value=n.address,c.value=!0):(e.value=null,c.value=!1),o.value=n.chainId??null,l.value=n.chainType??null,i.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const n={};return n[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(n[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),n}return{}})(n)},w=e=>{e&&(r.value=e.chainId??null,s.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const n=await A(),a=null==(e=n.getConfig)?void 0:e.call(n);return w(a),a},p=async e=>{const n=await A();if(!n.wallet.switchChain)throw new Error("switchChain not supported by SDK");await n.wallet.switchChain(e),o.value=e};let y=null;return a(()=>{const n=S();f(n),y=I(e=>{f(e)});const a=E();if((null==a?void 0:a.getConfig)&&w(a.getConfig()),a&&!c.value){const n=c.value,t=t=>{var i;if(!n&&!c.value){e.value=t,c.value=!0;const n=null==(i=a.getConfig)?void 0:i.call(a);o.value=(null==n?void 0:n.chainId)??null,l.value=(null==n?void 0:n.chainType)??null,w(n)}};L?t(L):($||($=a.wallet.getAddress().then(e=>(L=e,e))),$.then(e=>t(e)).catch(e=>{$=null,console.debug("[MiniApp SDK] Fallback wallet connection failed:",(null==e?void 0:e.message)||e)}))}A().then(e=>{var n;return w(null==(n=e.getConfig)?void 0:n.call(e))}).catch(()=>{})}),t(()=>{y&&y()}),{address:e,chainId:o,chainType:l,appChainId:r,supportedChains:s,balances:i,isConnected:c,isLoading:d,error:u,showConnectionPrompt:v,connectionPromptMessage:h,connect:async()=>{var n;d.value=!0,u.value=null;try{const a=await A();e.value=await a.wallet.getAddress(),c.value=!0;const t=null==(n=a.getConfig)?void 0:n.call(a);o.value=(null==t?void 0:t.chainId)??null,l.value=(null==t?void 0:t.chainType)??null,w(t)}catch(a){u.value=a}finally{d.value=!1}},invokeIntent:async e=>{var n;const a=E();if(!(null==(n=null==a?void 0:a.wallet)?void 0:n.invokeIntent))throw new Error("invokeIntent not available");return a.wallet.invokeIntent(e)},invokeContract:async e=>{var n;const a=await A(),t=null==(n=a.getConfig)?void 0:n.call(a),i=e.contractAddress||e.scriptHash||e.contractHash,o=e.method||e.operation;if(!i||!o)throw new Error("contract address and method required");return a.invoke("invokeFunction",{contract:i,method:o,args:e.args,chainId:null==t?void 0:t.chainId,chainType:null==t?void 0:t.chainType})},invokeRead:async e=>{var n;const a=await A(),t=null==(n=a.getConfig)?void 0:n.call(a),i=e.contractAddress||e.scriptHash||e.contractHash||(null==t?void 0:t.contractAddress),o=e.method||e.operation;if(!i)throw new Error("contract address not configured");if(!o)throw new Error("method required");return a.invoke("invokeRead",{contract:i,method:o,args:e.args||[],chainId:e.chainId||(null==t?void 0:t.chainId),chainType:e.chainType||(null==t?void 0:t.chainType)})},getContractAddress:async()=>{var e,n,a,t,i;const o=await A(),l=null==(e=o.getConfig)?void 0:e.call(o);if(null==l?void 0:l.contractAddress)return l.contractAddress;if((null==l?void 0:l.chainId)&&(null==(a=null==(n=null==l?void 0:l.chainContracts)?void 0:n[l.chainId])?void 0:a.address))return l.chainContracts[l.chainId].address||null;if(o.invoke)try{const e=await o.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(i=null==(t=null==e?void 0:e.chainContracts)?void 0:t[e.chainId])?void 0:i.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await A()).wallet.getAddress(),signMessage:async e=>{var n;const a=await A();if(!(null==(n=a.wallet)?void 0:n.signMessage))throw new Error("signMessage not available");return a.wallet.signMessage(e)},switchChain:p,switchToAppChain:async e=>{const n=await g(),a=(null==n?void 0:n.chainId)||(Array.isArray(null==n?void 0:n.supportedChains)&&n.supportedChains.length>0?n.supportedChains[0]:null)||e||null;if(!a)throw new Error("app chain not configured");await p(a)},getBalance:async e=>{var n;d.value=!0,u.value=null;try{const a=await A(),t=null==(n=a.getConfig)?void 0:n.call(a),l=(null==t?void 0:t.chainId)||o.value,r=l?`?chain_id=${encodeURIComponent(l)}`:"",s=await D(`/wallet-balance${r}`),c=(null==s?void 0:s.balances)??{};return i.value=c,e?c[e]||"0":c}catch(a){throw u.value=a,a}finally{d.value=!1}},getTransactions:async(e=20)=>{var n;d.value=!0,u.value=null;try{const a=Number.isNaN(e)||e<1?20:Math.min(e,100),t=await A(),i=null==(n=t.getConfig)?void 0:n.call(t),l=(null==i?void 0:i.chainId)||o.value,r=new URLSearchParams({limit:String(a)});l&&r.set("chain_id",l);return(await D(`/wallet-transactions?${r.toString()}`)).transactions}catch(a){throw u.value=a,a}finally{d.value=!1}},invoke:async(e,n)=>(await A()).invoke(e,n),requireConnection:(e={})=>{const{showPrompt:n=!0,errorMessage:a}=e;return!!c.value||(n&&(h.value=a||null,v.value=!0),!1)},closeConnectionPrompt:()=>{v.value=!1,h.value=null},clearError:()=>{u.value=null}}}const K=T(o({__name:"ChainWarning",props:{title:{default:"Wrong Network"},message:{default:"Switch to Neo N3 Mainnet to continue."},buttonText:{default:"Switch Network"},show:{type:Boolean,default:void 0}},emits:["switch","switch-complete","switch-error"],setup(e,{emit:a}){const t=e,o=a,{showWarning:g,switchToAppChain:p}=function(){const{switchToAppChain:e}=j();return{showWarning:i(()=>!1),switchToAppChain:async()=>{try{await e()}catch(n){throw console.error("[useChainValidation] Failed to switch chain:",n),n}}}}(),y=n(!1),m=i(()=>void 0!==t.show?t.show:g.value),b=async()=>{if(!y.value){y.value=!0,o("switch");try{await p(),o("switch-complete")}catch(e){const n=e instanceof Error?e:new Error(String(e));o("switch-error",n),console.error("[ChainWarning] Failed to switch chain:",n)}finally{y.value=!1}}};return(e,n)=>{const a=u,t=s;return m.value?(l(),r(t,{key:0,class:"chain-warning px-4 mb-4"},{default:c(()=>[d(w(q),{variant:"danger"},{default:c(()=>[d(t,{class:"flex flex-col items-center gap-2 py-1"},{default:c(()=>[d(a,{class:"text-center font-bold text-red-400"},{default:c(()=>[v(h(e.title),1)]),_:1}),e.message?(l(),r(a,{key:0,class:"text-xs text-center opacity-80 text-white"},{default:c(()=>[v(h(e.message),1)]),_:1})):f("",!0),d(w(G),{size:"sm",variant:"secondary",class:"mt-2",loading:y.value,onClick:b},{default:c(()=>[v(h(e.buttonText),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):f("",!0)}}}),[["__scopeId","data-v-3dc811c7"]]),q=T(o({__name:"NeoCard",props:{title:{default:void 0},variant:{default:"default"},hoverable:{type:Boolean,default:!1},flat:{type:Boolean,default:!1}},emits:["click"],setup:e=>(e,n)=>{const a=u,t=s;return l(),r(t,{class:g(["neo-card",`neo-card--${e.variant}`,{"neo-card--hoverable":e.hoverable,"neo-card--flat":e.flat}]),onClick:n[0]||(n[0]=n=>e.hoverable&&e.$emit("click",n))},{default:c(()=>[e.title||e.$slots.header?(l(),r(t,{key:0,class:"neo-card__header"},{default:c(()=>[e.title?(l(),r(a,{key:0,class:"neo-card__title"},{default:c(()=>[v(h(e.title),1)]),_:1})):f("",!0),p(e.$slots,"header",{},void 0,!0)]),_:3})):f("",!0),d(t,{class:"neo-card__body"},{default:c(()=>[p(e.$slots,"default",{},void 0,!0)]),_:3}),e.$slots.footer?(l(),r(t,{key:1,class:"neo-card__footer"},{default:c(()=>[p(e.$slots,"footer",{},void 0,!0)]),_:3})):f("",!0)]),_:3},8,["class"])}}),[["__scopeId","data-v-8c9297aa"]]),G=T(o({__name:"NeoButton",props:{variant:{default:"primary"},size:{default:"md"},block:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},ariaLabel:{default:void 0}},emits:["click"],setup:e=>(e,n)=>{const a=s,t=y;return l(),r(t,{class:g(["neo-btn",`neo-btn--${e.variant}`,`neo-btn--${e.size}`,{"neo-btn--block":e.block,"neo-btn--loading":e.loading}]),disabled:e.disabled||e.loading,"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading,"aria-label":e.ariaLabel,onClick:n[0]||(n[0]=n=>e.$emit("click",n))},{default:c(()=>[e.loading?(l(),r(a,{key:0,class:"neo-btn__spinner"})):p(e.$slots,"default",{key:1},void 0,!0)]),_:3},8,["class","disabled","aria-busy","aria-disabled","aria-label"])}}),[["__scopeId","data-v-d9647ea1"]]),W=5e3,B=1e4,H=100,U=["https://neomini.app","https://miniapp.neo.org","https://testnet.miniapp.neo.org"];const V=new class{constructor(){this.dynamicOrigins=new Set,this.baseOrigins=new Set([...U])}getSelfOrigin(){if("undefined"==typeof window)return null;try{const e=new URL(window.location.href);if("null"===e.origin)return null;if("http:"===e.protocol||"https:"===e.protocol)return e.origin}catch{}return null}getReferrerOrigin(){if("undefined"==typeof document||!document.referrer)return null;try{return new URL(document.referrer).origin}catch{return null}}getAllowedOrigins(){const e=new Set(this.baseOrigins);this.dynamicOrigins.forEach(n=>e.add(n));const n=this.getReferrerOrigin();n&&this.baseOrigins.has(n)&&e.add(n);const a=this.getSelfOrigin();if(a&&e.add(a),"undefined"!=typeof window){const n=window.location.hostname;"localhost"!==n&&"127.0.0.1"!==n||e.add(window.location.origin)}return e}isValid(e){return!(!e||"null"===e)&&this.getAllowedOrigins().has(e)}getTargetOrigin(){var e;const n=this.getReferrerOrigin();if(n&&this.baseOrigins.has(n))return n;try{if("undefined"!=typeof window&&window.parent!==window&&(null==(e=window.location.ancestorOrigins)?void 0:e.length)>0){const e=window.location.ancestorOrigins[0];if(this.baseOrigins.has(e))return e}}catch{}const a=this.getSelfOrigin();if(a)return a;if("undefined"!=typeof window){const e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return window.location.origin}throw new Error("Cannot determine safe target origin - no valid origin found")}getSafeTargetOrigin(){try{const e=this.getTargetOrigin();if(e&&"null"!==e)return e}catch{}if("undefined"!=typeof window&&window.parent!==window){const e=window.__MINIAPP_PARENT_ORIGIN__;if("string"==typeof e&&e&&this.baseOrigins.has(e))return e;throw new Error("Cannot communicate securely with parent - origin unknown. Ensure host app sets __MINIAPP_PARENT_ORIGIN__ or uses a supported browser.")}throw new Error("Cannot determine safe target origin - origin is null or undefined")}addDynamicOrigin(e){e&&"null"!==e&&this.dynamicOrigins.add(e)}};let F=null;function z(e){const n=null==e?void 0:e.layout;if("web"===n||"mobile"===n)return n;if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("layout");if("web"===e||"mobile"===e)return e;if(window.ReactNativeWebView)return"mobile"}return"web"}function J(e){if(!e||"object"!=typeof e)return!1;const n="function"==typeof e.invoke&&"function"==typeof e.getConfig,a="object"==typeof e.wallet||"object"==typeof e.payments;return n||a}function Q(e=W){return new Promise((n,a)=>{if("undefined"==typeof window)return void a(new Error("SDK not available in SSR"));if(window.MiniAppSDK)return J(window.MiniAppSDK)?void n(window.MiniAppSDK):void a(new Error("SDK validation failed"));const t=setTimeout(()=>{if(window.removeEventListener("miniapp-sdk-ready",i),window.parent!==window){const e=function(){const e=V.getSafeTargetOrigin();let n=0;const a=(a,...t)=>new Promise((i,o)=>{const l=`sdk-${++n}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,r=setTimeout(()=>{window.removeEventListener("message",s),o(new Error("SDK invoke timeout"))},B),s=e=>{var n,a;V.isValid(e.origin)&&e.source===window.parent&&"miniapp_sdk_response"===(null==(n=e.data)?void 0:n.type)&&(null==(a=e.data)?void 0:a.id)===l&&(clearTimeout(r),window.removeEventListener("message",s),e.data.ok?i(e.data.result):o(new Error(e.data.error||"SDK call failed")))};window.addEventListener("message",s),window.parent.postMessage({type:"miniapp_sdk_request",id:l,method:a,params:t},e)});return{invoke:a,getConfig:()=>F?{...F,layout:z(F)}:"undefined"!=typeof window&&window.__MINIAPP_CONFIG__?(F=window.__MINIAPP_CONFIG__,{...F,layout:z(F??void 0)}):{appId:"",contractAddress:null,chainId:null,chainType:void 0,supportedChains:[],layout:z(),debug:!1},getAddress:()=>a("getAddress"),wallet:{getAddress:()=>a("wallet.getAddress"),switchChain:e=>a("wallet.switchChain",e),invokeIntent:e=>a("wallet.invokeIntent",e),signMessage:e=>a("wallet.signMessage",e)},payments:{payGAS:(e,n,t)=>a("payments.payGAS",e,n,t),payGASAndInvoke:(e,n,t)=>a("payments.payGASAndInvoke",e,n,t)},governance:{vote:(e,n,t,i)=>a("governance.vote",e,n,t,i),voteAndInvoke:(e,n,t,i)=>a("governance.voteAndInvoke",e,n,t,i),getCandidates:()=>a("governance.getCandidates")},rng:{requestRandom:e=>a("rng.requestRandom",e)},datafeed:{getPrice:e=>a("datafeed.getPrice",e),getPrices:()=>a("datafeed.getPrices"),getNetworkStats:()=>a("datafeed.getNetworkStats"),getRecentTransactions:e=>a("datafeed.getRecentTransactions",e)},stats:{getMyUsage:(e,n)=>a("stats.getMyUsage",e,n)},events:{list:e=>a("events.list",e),emit:(e,n)=>a("events.emit",e,n)},transactions:{list:e=>a("transactions.list",e)},automation:{register:(e,n,t,i)=>a("automation.register",e,n,t,i),unregister:e=>a("automation.unregister",e),status:e=>a("automation.status",e),list:()=>a("automation.list"),update:(e,n,t)=>a("automation.update",e,n,t),enable:e=>a("automation.enable",e),disable:e=>a("automation.disable",e),logs:(e,n)=>a("automation.logs",e,n)},share:{openModal:e=>a("share.openModal",e),getUrl:e=>a("share.getUrl",e),copy:e=>a("share.copy",e)}}}();window.MiniAppSDK=e,e.invoke("getConfig").then(e=>{e&&"object"==typeof e&&(F=e)}).catch(()=>{}),n(e)}else a(new Error("SDK timeout"))},e),i=()=>{if(clearTimeout(t),window.removeEventListener("miniapp-sdk-ready",i),window.MiniAppSDK){if(!J(window.MiniAppSDK))return void a(new Error("SDK validation failed"));n(window.MiniAppSDK)}else a(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",i)})}function X(){return"undefined"==typeof window?null:window.MiniAppSDK??null}const Y=new Set;let Z={connected:!1,address:null,balance:null},ee=null,ne=!1;"undefined"!=typeof window&&("undefined"!=typeof window&&(ne&&ee||(ee=e=>{if(e.source!==window.parent)return;if(!V.isValid(e.origin))return;const n=e.data;n&&"object"==typeof n&&("miniapp_config"!==n.type?"miniapp_wallet_state_change"===n.type&&(Z={connected:Boolean(n.connected),address:n.address||null,chainId:n.chainId??null,chainType:n.chainType??null,balance:n.balance||n.multiChainBalance||null,balances:n.balances||void 0},Y.forEach(e=>{try{e(Z)}catch(n){console.error("[MiniApp SDK] Wallet state listener error:",n)}})):n.config&&"object"==typeof n.config&&(F=n.config))},window.addEventListener("message",ee),ne=!0)),setTimeout(function(){if("undefined"==typeof window)return;const e=V.getSafeTargetOrigin();try{window.parent.postMessage({type:"miniapp_ready"},e)}catch{}},H));const ae={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function te(e,n){return Math.min(n.baseDelayMs*Math.pow(2,e),n.maxDelayMs)*(.75+.5*Math.random())}function ie(e,n){if(e instanceof Error){const n=e.message.toLowerCase();return n.includes("network")||n.includes("timeout")||n.includes("abort")}return!1}async function oe(n,a){var t;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((t,i)=>{const o=(e=>{if(e){if(e instanceof Headers){const n={};return e.forEach((e,a)=>{n[a]=e}),n}return Array.isArray(e)?Object.fromEntries(e):e}})(a.headers),l=String((null==o?void 0:o["Content-Type"])||(null==o?void 0:o["content-type"])||"");let r=a.body;if("string"==typeof r&&l.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:n,method:a.method||"GET",data:r,header:o,success:e=>{var n,a;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)t(e.data);else{const t=(null==(a=null==(n=e.data)?void 0:n.error)?void 0:a.message)||`Request failed: ${e.statusCode}`;i(new Error(t))}},fail:e=>{i(new Error(e.errMsg||"Network error"))}})});const i=await fetch(n,{credentials:"include",...a});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error((null==(t=e.error)?void 0:t.message)||`Request failed: ${n}`)}return i.json()}async function le(e){return async function(e,n={}){var a,t;const i=e.startsWith("http")?e:`https://api.neo-service-layer.io${e}`,o={...ae,...n.retryConfig};let l=null;for(let s=0;s<=o.maxRetries;s++){if(null==(a=n.signal)?void 0:a.aborted)throw new Error("Request cancelled");try{return await oe(i,n)}catch(r){if(l=r instanceof Error?r:new Error(String(r)),null==(t=n.signal)?void 0:t.aborted)throw l;if(s>=o.maxRetries)break;if(!ie(r))break;const e=te(s,o);await new Promise(n=>setTimeout(n,e))}}throw l||new Error("Request failed")}(e,{method:"GET"})}let re=null,se=null;function ce(){const e=n(null),i=n({}),o=n(null),l=n(null),r=n(null),s=n([]),c=n(!1),d=n(!1),u=n(null),v=n(!1),h=n(null),f=n=>{n.connected&&n.address?(e.value=n.address,c.value=!0):(e.value=null,c.value=!1),o.value=n.chainId??null,l.value=n.chainType??null,i.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const n={};return n[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(n[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),n}return{}})(n)},w=e=>{e&&(r.value=e.chainId??null,s.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const n=await Q(),a=null==(e=n.getConfig)?void 0:e.call(n);return w(a),a},p=async e=>{const n=await Q();if(!n.wallet.switchChain)throw new Error("switchChain not supported by SDK");await n.wallet.switchChain(e),o.value=e};let y=null;return a(()=>{var n;f(Z),n=e=>{f(e)},Y.add(n),n(Z),y=()=>Y.delete(n);const a=X();if((null==a?void 0:a.getConfig)&&w(a.getConfig()),a&&!c.value){const n=c.value,t=t=>{var i;if(!n&&!c.value){e.value=t,c.value=!0;const n=null==(i=a.getConfig)?void 0:i.call(a);o.value=(null==n?void 0:n.chainId)??null,l.value=(null==n?void 0:n.chainType)??null,w(n)}};se?t(se):(re||(re=a.wallet.getAddress().then(e=>(se=e,e))),re.then(e=>t(e)).catch(e=>{re=null,console.debug("[MiniApp SDK] Fallback wallet connection failed:",(null==e?void 0:e.message)||e)}))}Q().then(e=>{var n;return w(null==(n=e.getConfig)?void 0:n.call(e))}).catch(()=>{})}),t(()=>{y&&y()}),{address:e,chainId:o,chainType:l,appChainId:r,supportedChains:s,balances:i,isConnected:c,isLoading:d,error:u,showConnectionPrompt:v,connectionPromptMessage:h,connect:async()=>{var n;d.value=!0,u.value=null;try{const a=await Q();e.value=await a.wallet.getAddress(),c.value=!0;const t=null==(n=a.getConfig)?void 0:n.call(a);o.value=(null==t?void 0:t.chainId)??null,l.value=(null==t?void 0:t.chainType)??null,w(t)}catch(a){u.value=a}finally{d.value=!1}},invokeIntent:async e=>{var n;const a=X();if(!(null==(n=null==a?void 0:a.wallet)?void 0:n.invokeIntent))throw new Error("invokeIntent not available");return a.wallet.invokeIntent(e)},invokeContract:async e=>{var n;const a=await Q(),t=null==(n=a.getConfig)?void 0:n.call(a),i=e.contractAddress||e.scriptHash||e.contractHash,o=e.method||e.operation;if(!i||!o)throw new Error("contract address and method required");return a.invoke("invokeFunction",{contract:i,method:o,args:e.args,chainId:null==t?void 0:t.chainId,chainType:null==t?void 0:t.chainType})},invokeRead:async e=>{var n;const a=await Q(),t=null==(n=a.getConfig)?void 0:n.call(a),i=e.contractAddress||e.scriptHash||e.contractHash||(null==t?void 0:t.contractAddress),o=e.method||e.operation;if(!i)throw new Error("contract address not configured");if(!o)throw new Error("method required");return a.invoke("invokeRead",{contract:i,method:o,args:e.args||[],chainId:e.chainId||(null==t?void 0:t.chainId),chainType:e.chainType||(null==t?void 0:t.chainType)})},getContractAddress:async()=>{var e,n,a,t,i;const o=await Q(),l=null==(e=o.getConfig)?void 0:e.call(o);if(null==l?void 0:l.contractAddress)return l.contractAddress;if((null==l?void 0:l.chainId)&&(null==(a=null==(n=null==l?void 0:l.chainContracts)?void 0:n[l.chainId])?void 0:a.address))return l.chainContracts[l.chainId].address||null;if(o.invoke)try{const e=await o.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(i=null==(t=null==e?void 0:e.chainContracts)?void 0:t[e.chainId])?void 0:i.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await Q()).wallet.getAddress(),signMessage:async e=>{var n;const a=await Q();if(!(null==(n=a.wallet)?void 0:n.signMessage))throw new Error("signMessage not available");return a.wallet.signMessage(e)},switchChain:p,switchToAppChain:async e=>{const n=await g(),a=(null==n?void 0:n.chainId)||(Array.isArray(null==n?void 0:n.supportedChains)&&n.supportedChains.length>0?n.supportedChains[0]:null)||e||null;if(!a)throw new Error("app chain not configured");await p(a)},getBalance:async e=>{var n;d.value=!0,u.value=null;try{const a=await Q(),t=null==(n=a.getConfig)?void 0:n.call(a),l=(null==t?void 0:t.chainId)||o.value,r=l?`?chain_id=${encodeURIComponent(l)}`:"",s=await le(`/wallet-balance${r}`),c=(null==s?void 0:s.balances)??{};return i.value=c,e?c[e]||"0":c}catch(a){throw u.value=a,a}finally{d.value=!1}},getTransactions:async(e=20)=>{var n;d.value=!0,u.value=null;try{const a=Number.isNaN(e)||e<1?20:Math.min(e,100),t=await Q(),i=null==(n=t.getConfig)?void 0:n.call(t),l=(null==i?void 0:i.chainId)||o.value,r=new URLSearchParams({limit:String(a)});l&&r.set("chain_id",l);return(await le(`/wallet-transactions?${r.toString()}`)).transactions}catch(a){throw u.value=a,a}finally{d.value=!1}},invoke:async(e,n)=>(await Q()).invoke(e,n),requireConnection:(e={})=>{const{showPrompt:n=!0,errorMessage:a}=e;return!!c.value||(n&&(h.value=a||null,v.value=!0),!1)},closeConnectionPrompt:()=>{v.value=!1,h.value=null},clearError:()=>{u.value=null}}}n("en");const de=new Set(["neo-n3","neo-n3-mainnet","neo-n3-testnet"]);function ue(e,n,a,t){const i=function(e){if("string"==typeof e)return e;const n=null==e?void 0:e.value;return"string"==typeof n?n:""}(e);if(de.has(i))return!0;let o="";if(!o&&"function"==typeof n){const e=n("wrongChainMessage");o=e&&"wrongChainMessage"!==e?e:n("wrongChain")}o||(o="Wrong network");const l=globalThis.uni;return(null==l?void 0:l.showToast)&&l.showToast({title:o,icon:"none"}),!1}const ve=T(o({__name:"index",setup(e){const o=n(window.innerWidth);i(()=>o.value<768),i(()=>o.value>=1024);const g=()=>{o.value=window.innerWidth};a(()=>window.addEventListener("resize",g)),t(()=>window.removeEventListener("resize",g));const{t:p}=x(),y=n(""),k=n(""),I=n(""),A=n(!1),E=n(!1),S=n("home"),{address:T,connect:R,signMessage:O,invokeContract:N,chainType:P}=ce(),D=e=>{"docs"===e?_({url:"/pages/docs/index"}):S.value=e},$=async()=>{if(y.value&&ue(P,p)){A.value=!0,k.value="",I.value="";try{if(T.value||await R(),!T.value)throw new Error(p("connectWallet"));const e=await O(y.value);"string"==typeof e?k.value=e:e&&"object"==typeof e&&e.signature?k.value=e.signature:k.value=JSON.stringify(e)}catch(e){b({title:e.message||p("signFailed"),icon:"none"})}finally{A.value=!1}}},L=async()=>{if(y.value&&ue(P,p))if(e=y.value,("undefined"!=typeof TextEncoder?(new TextEncoder).encode(e).length:encodeURIComponent(e).replace(/%[0-9A-F]{2}/g,"x").length)>1024)b({title:p("messageTooLong"),icon:"none"});else{var e;E.value=!0,I.value="",k.value="";try{if(T.value||await R(),!T.value)throw new Error(p("connectWallet"));const e=await N({scriptHash:"0xd2a4cff31913016155e38e474a2c06d08be276cf",operation:"transfer",args:[{type:"Hash160",value:T.value},{type:"Hash160",value:T.value},{type:"Integer",value:"0"},{type:"String",value:y.value}]});e&&e.txid?I.value=e.txid:I.value="string"==typeof e?e:p("txPending")}catch(n){b({title:n.message||p("broadcastFailed"),icon:"none"})}finally{E.value=!1}}},j=e=>{C({data:e,success:()=>{b({title:p("copySuccess"),icon:"none"})}})};return(e,n)=>{const a=u,t=s,i=m;return l(),r(w(M),{"desktop-breakpoint":1024,class:"theme-neo-sign-anything",title:w(p)("appTitle"),"show-top-nav":!1,"active-tab":S.value,tabs:[{id:"home",label:w(p)("home"),icon:"Home"},{id:"docs",label:w(p)("docs"),icon:"Book"}],onTabChange:D,"\x3c!--":"",Desktop:"",Sidebar:"","--":""},{"desktop-sidebar":c(()=>[d(t,{class:"desktop-sidebar"},{default:c(()=>[d(a,{class:"sidebar-title"},{default:c(()=>[v(h(w(p)("overview")),1)]),_:1})]),_:1})]),default:c(()=>[v(" > "),d(t,{class:"container"},{default:c(()=>[d(w(K),{title:w(p)("wrongChain"),message:w(p)("wrongChainMessage"),"button-text":w(p)("switchToNeo")},null,8,["title","message","button-text"]),d(t,{class:"header"},{default:c(()=>[d(a,{class:"title"},{default:c(()=>[v(h(w(p)("signTitle")),1)]),_:1}),d(a,{class:"subtitle"},{default:c(()=>[v(h(w(p)("signDesc")),1)]),_:1})]),_:1}),d(w(q),{variant:"erobo"},{default:c(()=>[d(t,{class:"input-group"},{default:c(()=>[d(a,{class:"label"},{default:c(()=>[v(h(w(p)("messageLabel")),1)]),_:1}),d(i,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),class:"textarea",placeholder:w(p)("messagePlaceholder"),maxlength:"1000"},null,8,["modelValue","placeholder"]),d(t,{class:"char-count"},{default:c(()=>[v(h(y.value.length)+"/1000",1)]),_:1})]),_:1}),d(t,{class:"actions"},{default:c(()=>[d(w(G),{variant:"primary",block:"",loading:A.value,onClick:$,disabled:!y.value||!w(T)},{default:c(()=>[v(h(w(p)("signBtn")),1)]),_:1},8,["loading","disabled"]),d(w(G),{variant:"ghost",block:"",loading:E.value,onClick:L,disabled:!y.value||!w(T),style:{"margin-top":"12px"}},{default:c(()=>[v(h(w(p)("broadcastBtn")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),k.value?(l(),r(t,{key:0,class:"result-card"},{default:c(()=>[d(w(q),{variant:"erobo-neo"},{default:c(()=>[d(t,{class:"result-header"},{default:c(()=>[d(a,{class:"result-title"},{default:c(()=>[v(h(w(p)("signatureResult")),1)]),_:1}),d(t,{class:"copy-btn",onClick:n[1]||(n[1]=e=>j(k.value))},{default:c(()=>[d(a,{class:"copy-text"},{default:c(()=>[v(h(w(p)("copy")),1)]),_:1})]),_:1})]),_:1}),d(a,{class:"result-text"},{default:c(()=>[v(h(k.value),1)]),_:1})]),_:1})]),_:1})):f("",!0),I.value?(l(),r(t,{key:1,class:"result-card"},{default:c(()=>[d(w(q),{variant:"erobo-purple"},{default:c(()=>[d(t,{class:"result-header"},{default:c(()=>[d(a,{class:"result-title"},{default:c(()=>[v(h(w(p)("broadcastResult")),1)]),_:1}),d(t,{class:"copy-btn",onClick:n[2]||(n[2]=e=>j(I.value))},{default:c(()=>[d(a,{class:"copy-text"},{default:c(()=>[v(h(w(p)("copy")),1)]),_:1})]),_:1})]),_:1}),d(a,{class:"result-text"},{default:c(()=>[v(h(I.value),1)]),_:1}),d(a,{class:"success-msg"},{default:c(()=>[v(h(w(p)("broadcastSuccess")),1)]),_:1})]),_:1})]),_:1})):f("",!0),w(T)?f("",!0):(l(),r(t,{key:2,class:"connect-prompt"},{default:c(()=>[d(a,{class:"connect-text"},{default:c(()=>[v(h(w(p)("connectWallet")),1)]),_:1})]),_:1}))]),_:1})]),_:1},8,["title","active-tab","tabs"])}}}),[["__scopeId","data-v-03e401a5"]]);export{ve as default};
