import{w as e,a as t,b as a}from"./index.D82PIuzN.js";import{c as n,d as o,e as r,f as s,g as i,h as c,i as l,r as d,j as u,s as g,u as m,k as p}from"./index.D82PIuzN.js";import{x as v,o as h}from"./index-3UYbruW0.js";import"./NeoDoc.DXrf6jop.js";import"/logo.jpg";function w(e){const t=v(!1),a=v(null);return{isLoading:t,error:a,execute:async(...n)=>{t.value=!0,a.value=null;try{return await e(...n)}catch(o){throw a.value=o,o}finally{t.value=!1}}}}function f(t){const{isLoading:a,error:n,execute:o}=w(async(a,n)=>{const o=parseFloat(a);if(Number.isNaN(o)||o<=0)throw new Error("Invalid amount: must be a positive number");const r=await e();return r.payments.payGASAndInvoke?await r.payments.payGASAndInvoke(t,a,n):await r.payments.payGAS(t,a,n)});return{isLoading:a,error:n,payGAS:o}}function y(t){const a=w(async(a,n,o)=>{if(!a||"string"!=typeof a)throw new Error("Invalid proposalId: must be a non-empty string");const r=parseFloat(n);if(Number.isNaN(r)||r<=0)throw new Error("Invalid amount: must be a positive number");const s=await e();return await s.governance.vote(t,a,n,o)}),n=w(async()=>{const t=await e();return await t.governance.getCandidates()});return{isVoting:a.isLoading,voteError:a.error,vote:a.execute,isLoadingCandidates:n.isLoading,candidatesError:n.error,getCandidates:n.execute}}function S(t){if(!t||"string"!=typeof t)throw new Error("useRNG: appId is required and must be a non-empty string");const{isLoading:a,error:n,execute:o}=w(async()=>{const a=await e();return await a.rng.requestRandom(t)});return{isLoading:a,error:n,requestRandom:o}}function _(){const t=w(async t=>{if(!t||"string"!=typeof t)throw new Error("getPrice: symbol is required and must be a non-empty string");const a=await e();return await a.datafeed.getPrice(t)}),a=w(async()=>{var t;const a=await e();if(!(null==(t=a.datafeed)?void 0:t.getPrices))throw new Error("datafeed.getPrices not available");return await a.datafeed.getPrices()}),n=w(async()=>{var t;const a=await e();if(!(null==(t=a.datafeed)?void 0:t.getNetworkStats))throw new Error("datafeed.getNetworkStats not available");return await a.datafeed.getNetworkStats()}),o=w(async t=>{var a;const n=await e();if(!(null==(a=n.datafeed)?void 0:a.getRecentTransactions))throw new Error("datafeed.getRecentTransactions not available");return await n.datafeed.getRecentTransactions(t)});return{isLoading:t.isLoading,error:t.error,getPrice:t.execute,isLoadingPrices:a.isLoading,pricesError:a.error,getPrices:a.execute,isLoadingNetworkStats:n.isLoading,networkStatsError:n.error,getNetworkStats:n.execute,isLoadingRecentTransactions:o.isLoading,recentTransactionsError:o.error,getRecentTransactions:o.execute}}function b(){const t=w(async(t={})=>{var a;const n=await e();if(!(null==(a=n.events)?void 0:a.list))throw new Error("events.list not available");return await n.events.list(t)}),a=w(async(t,a)=>{var n;const o=String(t||"").trim();if(!o)throw new Error("eventName required");const r=await e();if(!(null==(n=r.events)?void 0:n.emit))throw new Error("events.emit not available");return await r.events.emit(o,a||{})});return{isLoading:t.isLoading,error:t.error,list:t.execute,isEmitting:a.isLoading,emitError:a.error,emit:a.execute}}function k(){const e=w(async()=>a("/gas-sponsor-check")),n=w(async e=>{const a=parseFloat(e);if(Number.isNaN(a)||a<=0)throw new Error("Invalid amount: must be a positive number");return t("/gas-sponsor-request",{amount:e})});return{isCheckingEligibility:e.isLoading,eligibilityError:e.error,checkEligibility:e.execute,isRequestingSponsorship:n.isLoading,sponsorshipError:n.error,requestSponsorship:n.execute}}function M(t={}){const{slot:a="default",autoLoad:n=!1}=t,o=v([]),r=v(null),s=v(!1),i=v(!1),c=v(!1),l=v(null),d=v(null),u=async t=>{var n;s.value=!0,l.value=null;try{const s=await e(),i=await s.wallet.getAddress(),c=(null==(n=s.getConfig)?void 0:n.call(s).appId)||"unknown",l=await fetch(`/api/miniapps/${c}/cloud-saves`,{headers:{"x-wallet-address":i}});if(!l.ok)throw new Error("Failed to load saves");const u=await l.json();o.value=u.saves||[];const g=t||a;return r.value=o.value.find(e=>e.slot_name===g)||null,d.value=new Date,r.value}catch(i){return l.value=i,null}finally{s.value=!1}};return h(()=>{n&&u()}),{saves:o,currentSave:r,isLoading:s,isSaving:i,isDeleting:c,error:l,lastSyncedAt:d,load:u,save:async(t,n)=>{var o;i.value=!0,l.value=null;try{const s=await e(),i=await s.wallet.getAddress(),c=(null==(o=s.getConfig)?void 0:o.call(s).appId)||"unknown",l=await fetch(`/api/miniapps/${c}/cloud-saves`,{method:"PUT",headers:{"Content-Type":"application/json","x-wallet-address":i},body:JSON.stringify({slot_name:n||a,save_data:t,client_timestamp:(new Date).toISOString()})});if(!l.ok)throw new Error("Failed to save");const u=await l.json();return r.value=u.save,d.value=new Date,!0}catch(s){return l.value=s,!1}finally{i.value=!1}},deleteSave:async t=>{var n,s;c.value=!0,l.value=null;try{const i=await e(),c=await i.wallet.getAddress(),l=(null==(n=i.getConfig)?void 0:n.call(i).appId)||"unknown";if(!(await fetch(`/api/miniapps/${l}/cloud-saves`,{method:"DELETE",headers:{"Content-Type":"application/json","x-wallet-address":c},body:JSON.stringify({slot_name:t||a})})).ok)throw new Error("Failed to delete");return o.value=o.value.filter(e=>e.slot_name!==(t||a)),(null==(s=r.value)?void 0:s.slot_name)===(t||a)&&(r.value=null),!0}catch(i){return l.value=i,!1}finally{c.value=!1}}}}const x=()=>`mock-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,D={invoke:async(e,...t)=>(console.log("[MockSDK] invoke:",e,t),{}),getConfig:()=>({appId:"mock-app",contractAddress:null,debug:!0}),wallet:{getAddress:async()=>(console.log("[MockSDK] getAddress called"),"NXV7ZhHiyM1aHXwpVsRZC6BwNFP2jghXAq"),async switchChain(e){console.log("[MockSDK] switchChain called:",e)},async signMessage(e){return console.log("[MockSDK] signMessage:",e),`mock-signature-${(t=e,"function"==typeof btoa?btoa(t):"undefined"!=typeof Buffer?Buffer.from(t,"utf8").toString("base64"):t).slice(0,12)}`;var t},invokeIntent:async e=>(console.log("[MockSDK] invokeIntent:",e),{txid:x()})},payments:{async payGAS(e,t,a){console.log("[MockSDK] payGAS:",{appId:e,amount:t,memo:a}),await new Promise(e=>setTimeout(e,800));const n=x();return{request_id:n,receipt_id:n,user_id:"mock-user",intent:"payments",constraints:{settlement:"GAS_ONLY"},chain_id:"neo-n3-mainnet",chain_type:"neo-n3",invocation:{chain_id:"neo-n3-mainnet",chain_type:"neo-n3",contract_address:"0x0bb8f09e6d3611bc5c8adbd79ff8af1e34f73193",method:"transfer",params:[t,a??""]}}},async payGASAndInvoke(e,t,a){return{...await this.payGAS(e,t,a),txid:x()}}},governance:{vote:async(e,t,a,n)=>(console.log("[MockSDK] vote:",{appId:e,proposalId:t,amount:a,support:n}),await new Promise(e=>setTimeout(e,800)),{request_id:x(),user_id:"mock-user",intent:"governance",constraints:{governance:"BNEO_ONLY"},chain_id:"neo-n3-mainnet",chain_type:"neo-n3",invocation:{chain_id:"neo-n3-mainnet",chain_type:"neo-n3",contract_address:"0xc8f3bbe1c205c932aab00b28f7df99f9bc788a05",method:"vote",params:[t,a,n]}}),async voteAndInvoke(e,t,a,n){return{...await this.vote(e,t,a,n),txid:x()}},getCandidates:async()=>(console.log("[MockSDK] getCandidates called"),await new Promise(e=>setTimeout(e,500)),{candidates:[{address:"NNShaEBGVBfmGWzGs6W5sCneKPBwmCA3Br",publicKey:"02a1",name:"NeoEconoLabs",votes:"5000000",active:!0},{address:"NdUL5oDPD159KeFpD5A9zw5xNF1xLX6nLT",publicKey:"03b2",name:"COZ",votes:"4500000",active:!0},{address:"NKuyBkoGdZZSLyPbJEetheRhMjeznFZszf",publicKey:"02c3",name:"AxLabs",votes:"3200000",active:!0}],totalVotes:"12700000",blockHeight:1234567})},rng:{async requestRandom(e){console.log("[MockSDK] requestRandom:",e),await new Promise(e=>setTimeout(e,500));const t=Array.from({length:32},()=>Math.floor(256*Math.random()).toString(16).padStart(2,"0")).join("");return{request_id:x(),app_id:e,chain_id:"neo-n3-mainnet",chain_type:"neo-n3",randomness:t}}},datafeed:{async getPrice(e){console.log("[MockSDK] getPrice:",e);return{feed_id:x(),pair:e,price:{"NEO-USD":"12.45","GAS-USD":"4.32","BTC-USD":"43250.00","ETH-USD":"2280.50"}[e]||"100.00",decimals:8,timestamp:(new Date).toISOString(),sources:["mock"]}},getPrices:async()=>(console.log("[MockSDK] getPrices called"),{neo:{usd:12.45,usd_24h_change:1.2},gas:{usd:4.32,usd_24h_change:-.4},timestamp:Date.now()}),getNetworkStats:async()=>(console.log("[MockSDK] getNetworkStats called"),{blockHeight:1234567,validatorCount:7,network:"neo-n3-mainnet",version:"mock-1.0"}),async getRecentTransactions(e=10){console.log("[MockSDK] getRecentTransactions called:",e);const t=Math.max(1,Math.min(e,5));return{blockHeight:1234567,transactions:Array.from({length:t},()=>({txid:x(),blockHeight:1234567,blockTime:Date.now(),sender:"NQiQvS9s5XbPpKXt9g6z4yUaqE8h4PGnRy",size:123,sysfee:"0.1",netfee:"0.01"}))}}},events:{async list(e={}){console.log("[MockSDK] events.list:",e),await new Promise(e=>setTimeout(e,300));const t=x();return{events:[{id:t,app_id:e.app_id||"mock-app",event_name:e.event_name||"MockEvent",chain_id:e.chain_id||"neo-n3-mainnet",contract_address:"0x0000000000000000000000000000000000000000",tx_hash:`0x${x()}`,block_index:1234567,state:[],created_at:(new Date).toISOString()}],has_more:!1,last_id:t}}},transactions:{async list(e={}){console.log("[MockSDK] transactions.list:",e),await new Promise(e=>setTimeout(e,300));const t=x();return{transactions:[{id:t,tx_hash:`0x${t}`,request_id:x(),from_service:"mock",tx_type:"contract",chain_id:e.chain_id||"neo-n3-mainnet",contract_address:"0x0000000000000000000000000000000000000000",method_name:"transfer",params:{},gas_consumed:.1,status:"confirmed",retry_count:0,error_message:null,rpc_endpoint:null,submitted_at:(new Date).toISOString(),confirmed_at:(new Date).toISOString()}],has_more:!1,last_id:t}}},stats:{getMyUsage:async(e,t)=>(console.log("[MockSDK] stats.getMyUsage:",{appId:e,date:t}),await new Promise(e=>setTimeout(e,300)),{app_id:e,chain_id:"neo-n3-mainnet",date:t||(new Date).toISOString().split("T")[0],transactions:42,volume_gas:"123.45",unique_users:10})}};function E(){"undefined"!=typeof window&&(window.MiniAppSDK=D,console.log("[MockSDK] Installed on window.MiniAppSDK"),window.dispatchEvent(new Event("miniapp-sdk-ready")))}function I(){const e=Date.now()+36e5+72e5*Math.random();return{type:"live_countdown",refreshInterval:1,endTime:Math.floor(e/1e3),jackpot:(1e3+9e3*Math.random()).toFixed(2),ticketsSold:Math.floor(100+500*Math.random()),ticketPrice:"0.1"}}function A(){return{type:"live_multiplier",refreshInterval:.1,currentMultiplier:1+5*Math.random(),status:["waiting","running","crashed"][Math.floor(3*Math.random())],playersCount:Math.floor(10+50*Math.random()),totalBets:(100+900*Math.random()).toFixed(2)}}function L(){return{type:"live_canvas",refreshInterval:5,pixels:N(32,32),width:32,height:32,activeUsers:Math.floor(5+20*Math.random())}}function N(e,t){const a=["#10b981","#3b82f6","#ec4899","#f59e0b","#8b5cf6"];let n="";for(let o=0;o<e*t;o++)n+=a[Math.floor(Math.random()*a.length)].slice(1);return n}function T(){return{type:"live_stats",refreshInterval:10,stats:[{label:"Available",value:String(Math.floor(5+20*Math.random())),icon:"ðŸ§§"},{label:"Total GAS",value:(50+200*Math.random()).toFixed(1),change:12.5},{label:"Claimed",value:String(Math.floor(100+500*Math.random()))}]}}function P(){const e=Math.floor(1e3+5e3*Math.random()),t=Math.floor(e*(.3+.5*Math.random()));return{type:"live_voting",refreshInterval:30,proposalTitle:"Increase staking rewards",yesVotes:t,noVotes:e-t,totalVotes:e,endTime:Math.floor((Date.now()+2592e5)/1e3)}}function K(){const e=10+5*Math.random();return{type:"live_price",refreshInterval:5,symbol:"NEO-USD",price:e.toFixed(2),change24h:10*Math.random()-5,sparkline:Array.from({length:24},()=>e*(.95+.1*Math.random()))}}function C(){const e=new AbortController;return{signal:e.signal,cancel:()=>e.abort(),isCancelled:()=>e.signal.aborted}}class q{constructor(){this.controllers=new Map}create(e){this.cancel(e);const t=new AbortController;return this.controllers.set(e,t),t.signal}cancel(e){const t=this.controllers.get(e);t&&(t.abort(),this.controllers.delete(e))}cancelAll(){for(const e of this.controllers.values())e.abort();this.controllers.clear()}isPending(e){const t=this.controllers.get(e);return!!t&&!t.signal.aborted}}const G=new q;export{q as RequestManager,n as apiFetch,a as apiGet,t as apiPost,o as callBridge,r as cleanupWalletStateListener,C as createCancellableRequest,s as createH5Bridge,i as getSDKSync,c as getWalletState,l as initWalletStateListener,E as installMockSDK,L as mockCanvasData,I as mockCountdownData,A as mockMultiplierData,K as mockPriceData,D as mockSDK,T as mockStatsData,P as mockVotingData,G as requestManager,d as resetI18nState,u as resolveLayout,g as subscribeToWalletState,w as useAsyncAction,M as useCloudSaves,_ as useDatafeed,b as useEvents,k as useGasSponsor,y as useGovernance,m as useI18n,f as usePayments,S as useRNG,p as useWallet,e as waitForSDK};
