import{r as e,a as t,o as n,b as a,c as i,d as o,e as s,f as r,i as l,w as c,g as d,h as u,j as v,t as f,k as h,u as p,l as g,m as w,F as y,n as m,p as b,s as C,q as _}from"./index-zkok6spj.js";import{_ as k,u as A}from"./NeoDoc.vue_vue_type_style_index_0_scoped_445ca862_lang.BuD2aUUJ.js";import{A as I,s as S,w as E,g as T,a as M,N as D,b as N,_ as R}from"./Fireworks.vue_vue_type_style_index_0_scoped_4da74fd1_lang.D0VhsUQQ.js";import{N as x}from"./NeoDoc.BKCaQnIP.js";const P={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function O(e,t){return Math.min(t.baseDelayMs*Math.pow(2,e),t.maxDelayMs)*(.75+.5*Math.random())}function L(e,t){if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("network")||t.includes("timeout")||t.includes("abort")}return!1}async function j(t,n){var a;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((a,i)=>{const o=(e=>{if(e){if(e instanceof Headers){const t={};return e.forEach((e,n)=>{t[n]=e}),t}return Array.isArray(e)?Object.fromEntries(e):e}})(n.headers),s=String((null==o?void 0:o["Content-Type"])||(null==o?void 0:o["content-type"])||"");let r=n.body;if("string"==typeof r&&s.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:t,method:n.method||"GET",data:r,header:o,success:e=>{var t,n;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)a(e.data);else{const a=(null==(n=null==(t=e.data)?void 0:t.error)?void 0:n.message)||`Request failed: ${e.statusCode}`;i(new Error(a))}},fail:e=>{i(new Error(e.errMsg||"Network error"))}})});const i=await fetch(t,{credentials:"include",...n});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error((null==(a=e.error)?void 0:a.message)||`Request failed: ${t}`)}return i.json()}async function F(e){return async function(e,t={}){var n,a;const i=e.startsWith("http")?e:`${I}${e}`,o={...P,...t.retryConfig};let s=null;for(let l=0;l<=o.maxRetries;l++){if(null==(n=t.signal)?void 0:n.aborted)throw new Error("Request cancelled");try{return await j(i,t)}catch(r){if(s=r instanceof Error?r:new Error(String(r)),null==(a=t.signal)?void 0:a.aborted)throw s;if(l>=o.maxRetries)break;if(!L(r))break;const e=O(l,o);await new Promise(t=>setTimeout(t,e))}}throw s||new Error("Request failed")}(e,{method:"GET"})}function G(){const e=t(null),i=t({}),o=t(null),s=t(null),r=t(null),l=t([]),c=t(!1),d=t(!1),u=t(null),v=t(!1),f=t(null),h=t=>{t.connected&&t.address?(e.value=t.address,c.value=!0):(e.value=null,c.value=!1),o.value=t.chainId??null,s.value=t.chainType??null,i.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const t={};return t[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(t[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),t}return{}})(t)},p=e=>{e&&(r.value=e.chainId??null,l.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const t=await E(),n=null==(e=t.getConfig)?void 0:e.call(t);return p(n),n},w=async e=>{const t=await E();if(!t.wallet.switchChain)throw new Error("switchChain not supported by SDK");await t.wallet.switchChain(e),o.value=e};let y=null;return n(()=>{const t=M();h(t),y=S(e=>{h(e)});const n=T();if((null==n?void 0:n.getConfig)&&p(n.getConfig()),n&&!c.value){const t=c.value;n.wallet.getAddress().then(a=>{var i;if(!t&&!c.value){e.value=a,c.value=!0;const t=null==(i=n.getConfig)?void 0:i.call(n);o.value=(null==t?void 0:t.chainId)??null,s.value=(null==t?void 0:t.chainType)??null,p(t)}}).catch(e=>{console.debug("[MiniApp SDK] Fallback wallet connection failed:",(null==e?void 0:e.message)||e)})}E().then(e=>{var t;return p(null==(t=e.getConfig)?void 0:t.call(e))}).catch(()=>{})}),a(()=>{y&&y()}),{address:e,chainId:o,chainType:s,appChainId:r,supportedChains:l,balances:i,isConnected:c,isLoading:d,error:u,showConnectionPrompt:v,connectionPromptMessage:f,connect:async()=>{var t;d.value=!0,u.value=null;try{const n=await E();e.value=await n.wallet.getAddress(),c.value=!0;const a=null==(t=n.getConfig)?void 0:t.call(n);o.value=(null==a?void 0:a.chainId)??null,s.value=(null==a?void 0:a.chainType)??null,p(a)}catch(n){u.value=n}finally{d.value=!1}},invokeIntent:async e=>{var t;const n=T();if(!(null==(t=null==n?void 0:n.wallet)?void 0:t.invokeIntent))throw new Error("invokeIntent not available");return n.wallet.invokeIntent(e)},invokeContract:async e=>{var t;const n=await E(),a=null==(t=n.getConfig)?void 0:t.call(n),i=e.contractAddress||e.scriptHash||e.contractHash,o=e.method||e.operation;if(!i||!o)throw new Error("contract address and method required");return n.invoke("invokeFunction",{contract:i,method:o,args:e.args,chainId:null==a?void 0:a.chainId,chainType:null==a?void 0:a.chainType})},invokeRead:async e=>{var t;const n=await E(),a=null==(t=n.getConfig)?void 0:t.call(n),i=e.contractAddress||e.scriptHash||e.contractHash||(null==a?void 0:a.contractAddress),o=e.method||e.operation;if(!i)throw new Error("contract address not configured");if(!o)throw new Error("method required");return n.invoke("invokeRead",{contract:i,method:o,args:e.args||[],chainId:e.chainId||(null==a?void 0:a.chainId),chainType:e.chainType||(null==a?void 0:a.chainType)})},getContractAddress:async()=>{var e,t,n,a,i;const o=await E(),s=null==(e=o.getConfig)?void 0:e.call(o);if(null==s?void 0:s.contractAddress)return s.contractAddress;if((null==s?void 0:s.chainId)&&(null==(n=null==(t=null==s?void 0:s.chainContracts)?void 0:t[s.chainId])?void 0:n.address))return s.chainContracts[s.chainId].address||null;if(o.invoke)try{const e=await o.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(i=null==(a=null==e?void 0:e.chainContracts)?void 0:a[e.chainId])?void 0:i.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await E()).wallet.getAddress(),signMessage:async e=>{var t;const n=await E();if(!(null==(t=n.wallet)?void 0:t.signMessage))throw new Error("signMessage not available");return n.wallet.signMessage(e)},switchChain:w,switchToAppChain:async e=>{const t=await g(),n=(null==t?void 0:t.chainId)||(Array.isArray(null==t?void 0:t.supportedChains)&&t.supportedChains.length>0?t.supportedChains[0]:null)||e||null;if(!n)throw new Error("app chain not configured");await w(n)},getBalance:async e=>{var t;d.value=!0,u.value=null;try{const n=await E(),a=null==(t=n.getConfig)?void 0:t.call(n),s=(null==a?void 0:a.chainId)||o.value,r=s?`?chain_id=${encodeURIComponent(s)}`:"",l=await F(`/wallet-balance${r}`),c=(null==l?void 0:l.balances)??{};return i.value=c,e?c[e]||"0":c}catch(n){throw u.value=n,n}finally{d.value=!1}},getTransactions:async(e=20)=>{var t;d.value=!0,u.value=null;try{const n=Number.isNaN(e)||e<1?20:Math.min(e,100),a=await E(),i=null==(t=a.getConfig)?void 0:t.call(a),s=(null==i?void 0:i.chainId)||o.value,r=new URLSearchParams({limit:String(n)});s&&r.set("chain_id",s);return(await F(`/wallet-transactions?${r.toString()}`)).transactions}catch(n){throw u.value=n,n}finally{d.value=!1}},invoke:async(e,t)=>(await E()).invoke(e,t),requireConnection:(e={})=>{const{showPrompt:t=!0,errorMessage:n}=e;return!!c.value||(t&&(f.value=n||null,v.value=!0),!1)},closeConnectionPrompt:()=>{v.value=!1,f.value=null},clearError:()=>{u.value=null}}}const K=k(o({__name:"ChainWarning",props:{title:{default:"Wrong Network"},message:{default:"Switch to Neo N3 Mainnet to continue."},buttonText:{default:"Switch Network"},show:{type:Boolean,default:void 0}},emits:["switch","switch-complete","switch-error"],setup(e,{emit:n}){const a=e,o=n,{showWarning:g,switchToAppChain:w}=function(){const{switchToAppChain:e}=G();return{showWarning:i(()=>!1),switchToAppChain:async()=>{try{await e()}catch(t){throw console.error("[useChainValidation] Failed to switch chain:",t),t}}}}(),y=t(!1),m=i(()=>void 0!==a.show?a.show:g.value),b=async()=>{if(!y.value){y.value=!0,o("switch");try{await w(),o("switch-complete")}catch(e){const t=e instanceof Error?e:new Error(String(e));o("switch-error",t),console.error("[ChainWarning] Failed to switch chain:",t)}finally{y.value=!1}}};return(e,t)=>{const n=u,a=l;return m.value?(s(),r(a,{key:0,class:"chain-warning px-4 mb-4"},{default:c(()=>[d(p(N),{variant:"danger"},{default:c(()=>[d(a,{class:"flex flex-col items-center gap-2 py-1"},{default:c(()=>[d(n,{class:"text-center font-bold text-red-400"},{default:c(()=>[v(f(e.title),1)]),_:1}),e.message?(s(),r(n,{key:0,class:"text-xs text-center opacity-80 text-white"},{default:c(()=>[v(f(e.message),1)]),_:1})):h("",!0),d(p(D),{size:"sm",variant:"secondary",class:"mt-2",loading:y.value,onClick:b},{default:c(()=>[v(f(e.buttonText),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):h("",!0)}}}),[["__scopeId","data-v-3dc811c7"]]),$=5e3,q=1e4,U=100,W=["https://neomini.app","https://miniapp.neo.org","https://testnet.miniapp.neo.org"];const H=new class{constructor(){this.dynamicOrigins=new Set,this.baseOrigins=new Set([...W])}getSelfOrigin(){if("undefined"==typeof window)return null;try{const e=new URL(window.location.href);if("null"===e.origin)return null;if("http:"===e.protocol||"https:"===e.protocol)return e.origin}catch{}return null}getReferrerOrigin(){if("undefined"==typeof document||!document.referrer)return null;try{return new URL(document.referrer).origin}catch{return null}}getAllowedOrigins(){const e=new Set(this.baseOrigins);this.dynamicOrigins.forEach(t=>e.add(t));const t=this.getReferrerOrigin();t&&this.baseOrigins.has(t)&&e.add(t);const n=this.getSelfOrigin();if(n&&e.add(n),"undefined"!=typeof window){const t=window.location.hostname;"localhost"!==t&&"127.0.0.1"!==t||e.add(window.location.origin)}return e}isValid(e){return!(!e||"null"===e)&&this.getAllowedOrigins().has(e)}getTargetOrigin(){var e;const t=this.getReferrerOrigin();if(t&&this.baseOrigins.has(t))return t;try{if("undefined"!=typeof window&&window.parent!==window&&(null==(e=window.location.ancestorOrigins)?void 0:e.length)>0){const e=window.location.ancestorOrigins[0];if(this.baseOrigins.has(e))return e}}catch{}const n=this.getSelfOrigin();if(n)return n;if("undefined"!=typeof window){const e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return window.location.origin}throw new Error("Cannot determine safe target origin - no valid origin found")}getSafeTargetOrigin(){try{const e=this.getTargetOrigin();if(e&&"null"!==e)return e}catch{}if("undefined"!=typeof window&&window.parent!==window){const e=window.__MINIAPP_PARENT_ORIGIN__;if("string"==typeof e&&e&&this.baseOrigins.has(e))return e;throw new Error("Cannot communicate securely with parent - origin unknown. Ensure host app sets __MINIAPP_PARENT_ORIGIN__ or uses a supported browser.")}throw new Error("Cannot determine safe target origin - origin is null or undefined")}addDynamicOrigin(e){e&&"null"!==e&&this.dynamicOrigins.add(e)}};let V=null;function z(e){const t=null==e?void 0:e.layout;if("web"===t||"mobile"===t)return t;if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("layout");if("web"===e||"mobile"===e)return e;if(window.ReactNativeWebView)return"mobile"}return"web"}function B(e){if(!e||"object"!=typeof e)return!1;const t="function"==typeof e.invoke&&"function"==typeof e.getConfig,n="object"==typeof e.wallet||"object"==typeof e.payments;return t||n}function J(e=$){return new Promise((t,n)=>{if("undefined"==typeof window)return void n(new Error("SDK not available in SSR"));if(window.MiniAppSDK)return B(window.MiniAppSDK)?void t(window.MiniAppSDK):void n(new Error("SDK validation failed"));const a=setTimeout(()=>{if(window.removeEventListener("miniapp-sdk-ready",i),window.parent!==window){const e=function(){const e=H.getSafeTargetOrigin();let t=0;const n=(n,...a)=>new Promise((i,o)=>{const s=`sdk-${++t}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,r=setTimeout(()=>{window.removeEventListener("message",l),o(new Error("SDK invoke timeout"))},q),l=e=>{var t,n;H.isValid(e.origin)&&e.source===window.parent&&"miniapp_sdk_response"===(null==(t=e.data)?void 0:t.type)&&(null==(n=e.data)?void 0:n.id)===s&&(clearTimeout(r),window.removeEventListener("message",l),e.data.ok?i(e.data.result):o(new Error(e.data.error||"SDK call failed")))};window.addEventListener("message",l),window.parent.postMessage({type:"miniapp_sdk_request",id:s,method:n,params:a},e)});return{invoke:n,getConfig:()=>V?{...V,layout:z(V)}:"undefined"!=typeof window&&window.__MINIAPP_CONFIG__?(V=window.__MINIAPP_CONFIG__,{...V,layout:z(V??void 0)}):{appId:"",contractAddress:null,chainId:null,chainType:void 0,supportedChains:[],layout:z(),debug:!1},getAddress:()=>n("getAddress"),wallet:{getAddress:()=>n("wallet.getAddress"),switchChain:e=>n("wallet.switchChain",e),invokeIntent:e=>n("wallet.invokeIntent",e),signMessage:e=>n("wallet.signMessage",e)},payments:{payGAS:(e,t,a)=>n("payments.payGAS",e,t,a),payGASAndInvoke:(e,t,a)=>n("payments.payGASAndInvoke",e,t,a)},governance:{vote:(e,t,a,i)=>n("governance.vote",e,t,a,i),voteAndInvoke:(e,t,a,i)=>n("governance.voteAndInvoke",e,t,a,i),getCandidates:()=>n("governance.getCandidates")},rng:{requestRandom:e=>n("rng.requestRandom",e)},datafeed:{getPrice:e=>n("datafeed.getPrice",e),getPrices:()=>n("datafeed.getPrices"),getNetworkStats:()=>n("datafeed.getNetworkStats"),getRecentTransactions:e=>n("datafeed.getRecentTransactions",e)},stats:{getMyUsage:(e,t)=>n("stats.getMyUsage",e,t)},events:{list:e=>n("events.list",e),emit:(e,t)=>n("events.emit",e,t)},transactions:{list:e=>n("transactions.list",e)},automation:{register:(e,t,a,i)=>n("automation.register",e,t,a,i),unregister:e=>n("automation.unregister",e),status:e=>n("automation.status",e),list:()=>n("automation.list"),update:(e,t,a)=>n("automation.update",e,t,a),enable:e=>n("automation.enable",e),disable:e=>n("automation.disable",e),logs:(e,t)=>n("automation.logs",e,t)},share:{openModal:e=>n("share.openModal",e),getUrl:e=>n("share.getUrl",e),copy:e=>n("share.copy",e)}}}();window.MiniAppSDK=e,e.invoke("getConfig").then(e=>{e&&"object"==typeof e&&(V=e)}).catch(()=>{}),t(e)}else n(new Error("SDK timeout"))},e),i=()=>{if(clearTimeout(a),window.removeEventListener("miniapp-sdk-ready",i),window.MiniAppSDK){if(!B(window.MiniAppSDK))return void n(new Error("SDK validation failed"));t(window.MiniAppSDK)}else n(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",i)})}function Q(){return"undefined"==typeof window?null:window.MiniAppSDK??null}const X=new Set;let Y={connected:!1,address:null,balance:null},Z=null,ee=!1;"undefined"!=typeof window&&("undefined"!=typeof window&&(ee&&Z||(Z=e=>{if(e.source!==window.parent)return;if(!H.isValid(e.origin))return;const t=e.data;t&&"object"==typeof t&&("miniapp_config"!==t.type?"miniapp_wallet_state_change"===t.type&&(Y={connected:Boolean(t.connected),address:t.address||null,chainId:t.chainId??null,chainType:t.chainType??null,balance:t.balance||t.multiChainBalance||null,balances:t.balances||void 0},X.forEach(e=>{try{e(Y)}catch(t){console.error("[MiniApp SDK] Wallet state listener error:",t)}})):t.config&&"object"==typeof t.config&&(V=t.config))},window.addEventListener("message",Z),ee=!0)),setTimeout(function(){if("undefined"==typeof window)return;const e=H.getSafeTargetOrigin();try{window.parent.postMessage({type:"miniapp_ready"},e)}catch{}},U));const te={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function ne(e,t){return Math.min(t.baseDelayMs*Math.pow(2,e),t.maxDelayMs)*(.75+.5*Math.random())}function ae(e,t){if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("network")||t.includes("timeout")||t.includes("abort")}return!1}async function ie(t,n){var a;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((a,i)=>{const o=(e=>{if(e){if(e instanceof Headers){const t={};return e.forEach((e,n)=>{t[n]=e}),t}return Array.isArray(e)?Object.fromEntries(e):e}})(n.headers),s=String((null==o?void 0:o["Content-Type"])||(null==o?void 0:o["content-type"])||"");let r=n.body;if("string"==typeof r&&s.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:t,method:n.method||"GET",data:r,header:o,success:e=>{var t,n;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)a(e.data);else{const a=(null==(n=null==(t=e.data)?void 0:t.error)?void 0:n.message)||`Request failed: ${e.statusCode}`;i(new Error(a))}},fail:e=>{i(new Error(e.errMsg||"Network error"))}})});const i=await fetch(t,{credentials:"include",...n});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error((null==(a=e.error)?void 0:a.message)||`Request failed: ${t}`)}return i.json()}async function oe(e){return async function(e,t={}){var n,a;const i=e.startsWith("http")?e:`https://api.neo-service-layer.io${e}`,o={...te,...t.retryConfig};let s=null;for(let l=0;l<=o.maxRetries;l++){if(null==(n=t.signal)?void 0:n.aborted)throw new Error("Request cancelled");try{return await ie(i,t)}catch(r){if(s=r instanceof Error?r:new Error(String(r)),null==(a=t.signal)?void 0:a.aborted)throw s;if(l>=o.maxRetries)break;if(!ae(r))break;const e=ne(l,o);await new Promise(t=>setTimeout(t,e))}}throw s||new Error("Request failed")}(e,{method:"GET"})}function se(){const e=t(null),i=t({}),o=t(null),s=t(null),r=t(null),l=t([]),c=t(!1),d=t(!1),u=t(null),v=t(!1),f=t(null),h=t=>{t.connected&&t.address?(e.value=t.address,c.value=!0):(e.value=null,c.value=!1),o.value=t.chainId??null,s.value=t.chainType??null,i.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const t={};return t[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(t[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),t}return{}})(t)},p=e=>{e&&(r.value=e.chainId??null,l.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const t=await J(),n=null==(e=t.getConfig)?void 0:e.call(t);return p(n),n},w=async e=>{const t=await J();if(!t.wallet.switchChain)throw new Error("switchChain not supported by SDK");await t.wallet.switchChain(e),o.value=e};let y=null;return n(()=>{var t;h(Y),t=e=>{h(e)},X.add(t),t(Y),y=()=>X.delete(t);const n=Q();if((null==n?void 0:n.getConfig)&&p(n.getConfig()),n&&!c.value){const t=c.value;n.wallet.getAddress().then(a=>{var i;if(!t&&!c.value){e.value=a,c.value=!0;const t=null==(i=n.getConfig)?void 0:i.call(n);o.value=(null==t?void 0:t.chainId)??null,s.value=(null==t?void 0:t.chainType)??null,p(t)}}).catch(e=>{console.debug("[MiniApp SDK] Fallback wallet connection failed:",(null==e?void 0:e.message)||e)})}J().then(e=>{var t;return p(null==(t=e.getConfig)?void 0:t.call(e))}).catch(()=>{})}),a(()=>{y&&y()}),{address:e,chainId:o,chainType:s,appChainId:r,supportedChains:l,balances:i,isConnected:c,isLoading:d,error:u,showConnectionPrompt:v,connectionPromptMessage:f,connect:async()=>{var t;d.value=!0,u.value=null;try{const n=await J();e.value=await n.wallet.getAddress(),c.value=!0;const a=null==(t=n.getConfig)?void 0:t.call(n);o.value=(null==a?void 0:a.chainId)??null,s.value=(null==a?void 0:a.chainType)??null,p(a)}catch(n){u.value=n}finally{d.value=!1}},invokeIntent:async e=>{var t;const n=Q();if(!(null==(t=null==n?void 0:n.wallet)?void 0:t.invokeIntent))throw new Error("invokeIntent not available");return n.wallet.invokeIntent(e)},invokeContract:async e=>{var t;const n=await J(),a=null==(t=n.getConfig)?void 0:t.call(n),i=e.contractAddress||e.scriptHash||e.contractHash,o=e.method||e.operation;if(!i||!o)throw new Error("contract address and method required");return n.invoke("invokeFunction",{contract:i,method:o,args:e.args,chainId:null==a?void 0:a.chainId,chainType:null==a?void 0:a.chainType})},invokeRead:async e=>{var t;const n=await J(),a=null==(t=n.getConfig)?void 0:t.call(n),i=e.contractAddress||e.scriptHash||e.contractHash||(null==a?void 0:a.contractAddress),o=e.method||e.operation;if(!i)throw new Error("contract address not configured");if(!o)throw new Error("method required");return n.invoke("invokeRead",{contract:i,method:o,args:e.args||[],chainId:e.chainId||(null==a?void 0:a.chainId),chainType:e.chainType||(null==a?void 0:a.chainType)})},getContractAddress:async()=>{var e,t,n,a,i;const o=await J(),s=null==(e=o.getConfig)?void 0:e.call(o);if(null==s?void 0:s.contractAddress)return s.contractAddress;if((null==s?void 0:s.chainId)&&(null==(n=null==(t=null==s?void 0:s.chainContracts)?void 0:t[s.chainId])?void 0:n.address))return s.chainContracts[s.chainId].address||null;if(o.invoke)try{const e=await o.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(i=null==(a=null==e?void 0:e.chainContracts)?void 0:a[e.chainId])?void 0:i.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await J()).wallet.getAddress(),signMessage:async e=>{var t;const n=await J();if(!(null==(t=n.wallet)?void 0:t.signMessage))throw new Error("signMessage not available");return n.wallet.signMessage(e)},switchChain:w,switchToAppChain:async e=>{const t=await g(),n=(null==t?void 0:t.chainId)||(Array.isArray(null==t?void 0:t.supportedChains)&&t.supportedChains.length>0?t.supportedChains[0]:null)||e||null;if(!n)throw new Error("app chain not configured");await w(n)},getBalance:async e=>{var t;d.value=!0,u.value=null;try{const n=await J(),a=null==(t=n.getConfig)?void 0:t.call(n),s=(null==a?void 0:a.chainId)||o.value,r=s?`?chain_id=${encodeURIComponent(s)}`:"",l=await oe(`/wallet-balance${r}`),c=(null==l?void 0:l.balances)??{};return i.value=c,e?c[e]||"0":c}catch(n){throw u.value=n,n}finally{d.value=!1}},getTransactions:async(e=20)=>{var t;d.value=!0,u.value=null;try{const n=Number.isNaN(e)||e<1?20:Math.min(e,100),a=await J(),i=null==(t=a.getConfig)?void 0:t.call(a),s=(null==i?void 0:i.chainId)||o.value,r=new URLSearchParams({limit:String(n)});s&&r.set("chain_id",s);return(await oe(`/wallet-transactions?${r.toString()}`)).transactions}catch(n){throw u.value=n,n}finally{d.value=!1}},invoke:async(e,t)=>(await J()).invoke(e,t),requireConnection:(e={})=>{const{showPrompt:t=!0,errorMessage:n}=e;return!!c.value||(t&&(f.value=n||null,v.value=!0),!1)},closeConnectionPrompt:()=>{v.value=!1,f.value=null},clearError:()=>{u.value=null}}}function re(){const{t:o,locale:s}=A(),{chainType:r}=se(),l=t([]),c=t(0),d=t(!1),u=t(!1),v=t(window.innerWidth),f=i(()=>v.value<768),h=i(()=>v.value>=1024),p=()=>{v.value=window.innerWidth};n(()=>window.addEventListener("resize",p)),a(()=>window.removeEventListener("resize",p));const g=i(()=>l.value.filter(e=>m(e.state)).length),w=i(()=>l.value.length);function y(e){return String(e||"").toLowerCase()}function m(e){const t=y(e);return["active","review","voting","discussion"].includes(t)}return{grants:l,totalProposals:c,loading:d,fetchError:u,activeProposals:g,displayedProposals:w,isMobile:f,isDesktop:h,windowWidth:v,chainType:r,fetchGrants:async function(){d.value=!0,u.value=!1;try{const t=await new Promise((t,n)=>{e({url:"/api/grantshares/proposals",success:e=>t(e.data),fail:e=>n(e)})});if(t&&Array.isArray(t.items)){l.value=t.items.map(e=>{const t=function(e){try{return decodeURIComponent(escape(atob(e)))}catch{return e}}(e.title||"");return{id:String(e.offchain_id||e.id||""),title:t,proposer:String(e.proposer||e.proposer_address||e.proposerAddress||""),state:y(e.state||""),votesAccept:Number(e.votes_amount_accept||e.votesAmountAccept||0),votesReject:Number(e.votes_amount_reject||e.votesAmountReject||0),discussionUrl:String(e.discussion_url||e.discussionUrl||""),createdAt:String(e.offchain_creation_timestamp||e.offchainCreationTimestamp||""),comments:Number(e.offchain_comments_count||e.offchainCommentsCount||0),onchainId:e.onchain_id??e.onchainId??null}}).filter(e=>e.id&&e.title);const e=Number(t.total??t.totalCount??l.value.length);c.value=Number.isFinite(e)?e:l.value.length}else l.value=[],c.value=0}catch(t){l.value=[],c.value=0,u.value=!0}finally{d.value=!1}},formatCount:function(e){return Number.isFinite(e)?e.toLocaleString():"0"},formatDate:function(e){if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const n="zh"===s.value?"zh-CN":"en-US";return t.toLocaleDateString(n,{month:"short",day:"numeric",year:"numeric"})},getStatusLabel:function(e){return{active:o("statusActive"),review:o("statusReview"),voting:o("statusVoting"),discussion:o("statusDiscussion"),executed:o("statusExecuted"),cancelled:o("statusCancelled"),rejected:o("statusRejected"),expired:o("statusExpired")}[y(e)]||e},normalizeState:y,isActiveState:m}}t("en");const le=k(o({__name:"ProposalGallery",props:{grants:{},loading:{type:Boolean},fetchError:{type:Boolean},t:{type:Function},formatCount:{type:Function},formatDate:{type:Function},getStatusLabel:{type:Function}},emits:["select","copyLink"],setup:e=>(e,t)=>{const n=u,a=l;return s(),r(a,{class:"proposal-gallery"},{default:c(()=>[e.loading?(s(),r(a,{key:0,class:"empty-state"},{default:c(()=>[d(n,{class:"empty-text"},{default:c(()=>[v(f(e.t("loading")),1)]),_:1})]),_:1})):e.fetchError?(s(),r(a,{key:1,class:"empty-state"},{default:c(()=>[d(n,{class:"empty-text"},{default:c(()=>[v(f(e.t("loadFailed")),1)]),_:1})]),_:1})):0===e.grants.length?(s(),r(a,{key:2,class:"empty-state"},{default:c(()=>[d(n,{class:"empty-text"},{default:c(()=>[v(f(e.t("noActiveGrants")),1)]),_:1})]),_:1})):(s(),r(a,{key:3,class:"grants-list"},{default:c(()=>[(s(!0),g(y,null,w(e.grants,i=>(s(),r(p(N),{key:i.id,variant:"erobo-neo",class:"grant-card-neo clickable",hoverable:"",onClick:t=>e.$emit("select",i)},{default:c(()=>[d(a,{class:"grant-card-header"},{default:c(()=>[d(a,{class:"grant-info"},{default:c(()=>[d(n,{class:"grant-title-glass"},{default:c(()=>[v(f(i.title),1)]),_:2},1024),i.proposer?(s(),r(n,{key:0,class:"grant-creator-glass"},{default:c(()=>[v(f(e.t("by"))+" "+f(i.proposer),1)]),_:2},1024)):h("",!0)]),_:2},1024),d(a,{class:m(["grant-badge-glass",i.state])},{default:c(()=>[d(n,{class:"badge-text"},{default:c(()=>[v(f(e.getStatusLabel(i.state)),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024),d(a,{class:"proposal-meta"},{default:c(()=>[null!==i.onchainId?(s(),r(n,{key:0,class:"meta-item"},{default:c(()=>[v("#"+f(i.onchainId),1)]),_:2},1024)):h("",!0),i.createdAt?(s(),r(n,{key:1,class:"meta-item"},{default:c(()=>[v(f(e.formatDate(i.createdAt)),1)]),_:2},1024)):h("",!0)]),_:2},1024),d(a,{class:"proposal-stats"},{default:c(()=>[d(a,{class:"stat-chip accept"},{default:c(()=>[v(f(e.t("votesFor"))+" "+f(e.formatCount(i.votesAccept)),1)]),_:2},1024),d(a,{class:"stat-chip reject"},{default:c(()=>[v(f(e.t("votesAgainst"))+" "+f(e.formatCount(i.votesReject)),1)]),_:2},1024),d(a,{class:"stat-chip comments"},{default:c(()=>[v(f(e.t("comments"))+" "+f(e.formatCount(i.comments)),1)]),_:2},1024)]),_:2},1024),d(a,{class:"proposal-actions"},{default:c(()=>[d(a,{onClick:t[0]||(t[0]=b(()=>{},["stop"]))},{default:c(()=>[d(p(D),{size:"sm",variant:"secondary",disabled:!i.discussionUrl,onClick:t=>e.$emit("copyLink",i.discussionUrl)},{default:c(()=>[v(f(i.discussionUrl?e.t("copyDiscussion"):e.t("noDiscussion")),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}))]),_:1})}}),[["__scopeId","data-v-26c093fb"]]),ce=k(o({__name:"index",setup(e){const{t:a}=A(),{grants:o,totalProposals:g,loading:w,fetchError:y,activeProposals:m,displayedProposals:b,fetchGrants:k,formatCount:I,formatDate:S,getStatusLabel:E}=re(),{statusMessage:T,statusType:M,copyLink:D}=function(){const{t:e}=A(),n=t(""),a=t("success");function i(e,t){n.value=e,a.value=t,setTimeout(()=>n.value="",5e3)}return{statusMessage:n,statusType:a,showStatus:i,copyLink:function(t){var n;if(!t)return;const a=null==globalThis?void 0:globalThis.uni;(null==a?void 0:a.setClipboardData)?a.setClipboardData({data:t,success:()=>i(e("linkCopied"),"success"),fail:()=>i(e("copyFailed"),"error")}):"undefined"!=typeof navigator&&(null==(n=navigator.clipboard)?void 0:n.writeText)?navigator.clipboard.writeText(t).then(()=>i(e("linkCopied"),"success")).catch(()=>i(e("copyFailed"),"error")):i(e("copyFailed"),"error")}}}(),P=t("grants"),O=i(()=>[{id:"grants",icon:"gift",label:a("tabGrants")},{id:"stats",icon:"chart",label:a("tabStats")},{id:"docs",icon:"book",label:a("docs")}]),L=i(()=>[a("step1"),a("step2"),a("step3"),a("step4")]),j=i(()=>[{name:a("feature1Name"),desc:a("feature1Desc")},{name:a("feature2Name"),desc:a("feature2Desc")}]);function F(e){try{C("current_grant_detail",e)}catch(t){}_({url:`/pages/detail/index?id=${e.id}`})}return n(()=>{k()}),(e,t)=>{const n=u,i=l;return s(),r(p(R),{"desktop-breakpoint":1024,class:"theme-grant-share",tabs:O.value,"active-tab":P.value,onTabChange:t[0]||(t[0]=e=>P.value=e),"\x3c!--":"",Desktop:"",Sidebar:"","--":""},{"desktop-sidebar":c(()=>[d(i,{class:"desktop-sidebar"},{default:c(()=>[d(n,{class:"sidebar-title"},{default:c(()=>[v(f(p(a)("overview")),1)]),_:1})]),_:1})]),default:c(()=>[v(" > "),d(i,{class:"app-container"},{default:c(()=>[d(p(K),{title:p(a)("wrongChain"),message:p(a)("wrongChainMessage"),"button-text":p(a)("switchToNeo")},null,8,["title","message","button-text"]),p(T)?(s(),r(p(N),{key:0,variant:"error"===p(M)?"danger":"success",class:"mb-4 text-center"},{default:c(()=>[d(n,{class:"font-bold uppercase tracking-wider"},{default:c(()=>[v(f(p(T)),1)]),_:1})]),_:1},8,["variant"])):h("",!0),"grants"===P.value?(s(),r(i,{key:1,class:"tab-content"},{default:c(()=>[d(le,{grants:p(o),loading:p(w),"fetch-error":p(y),t:p(a),"format-count":p(I),"format-date":p(S),"get-status-label":p(E),onSelect:F,onCopyLink:p(D)},null,8,["grants","loading","fetch-error","t","format-count","format-date","get-status-label","onCopyLink"])]),_:1})):h("",!0),"stats"===P.value?(s(),r(i,{key:2,class:"tab-content"},{default:c(()=>[d(p(N),{variant:"erobo",class:"pool-overview-card"},{default:c(()=>[d(i,{class:"pool-stats"},{default:c(()=>[d(i,{class:"pool-stat-glass"},{default:c(()=>[d(n,{class:"stat-label-glass"},{default:c(()=>[v(f(p(a)("totalPool")),1)]),_:1}),d(n,{class:"stat-value-glass"},{default:c(()=>[v(f(p(I)(p(g))),1)]),_:1})]),_:1}),d(i,{class:"pool-stat-glass"},{default:c(()=>[d(n,{class:"stat-label-glass"},{default:c(()=>[v(f(p(a)("activeProjects")),1)]),_:1}),d(n,{class:"stat-value-glass"},{default:c(()=>[v(f(p(I)(p(m))),1)]),_:1})]),_:1}),d(i,{class:"pool-stat-glass"},{default:c(()=>[d(n,{class:"stat-label-glass"},{default:c(()=>[v(f(p(a)("yourShare")),1)]),_:1}),d(n,{class:"stat-value-glass highlight"},{default:c(()=>[v(f(p(I)(p(b))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),"docs"===P.value?(s(),r(i,{key:3,class:"tab-content scrollable"},{default:c(()=>[d(p(x),{title:p(a)("title"),subtitle:p(a)("docSubtitle"),description:p(a)("docDescription"),steps:L.value,features:j.value},null,8,["title","subtitle","description","steps","features"])]),_:1})):h("",!0)]),_:1})]),_:1},8,["tabs","active-tab"])}}}),[["__scopeId","data-v-bf38d5f1"]]);export{ce as default};
