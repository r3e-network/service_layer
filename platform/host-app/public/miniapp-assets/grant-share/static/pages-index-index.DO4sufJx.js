import{r as e,a as t,o as n,b as a,c as o,d as i,e as s,f as r,i as l,w as c,g as u,h as d,j as f,t as v,k as h,u as p,l as g,m as w,F as m,n as y,p as b,s as _,q as C}from"./index-DAJADRwF.js";import{_ as k,u as A}from"./NeoDoc.vue_vue_type_style_index_0_scoped_445ca862_lang.Ddmr3wbk.js";import{A as S,s as I,w as E,g as T,a as M,N,b as R,_ as D}from"./Fireworks.vue_vue_type_style_index_0_scoped_4da74fd1_lang.Bn-n1ZBH.js";import{N as P}from"./NeoDoc.Dy2Fh0mb.js";let x=class extends Error{constructor(e,t){super(e),this.statusCode=t,this.name="HttpError"}};const O={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function j(e,t){return Math.min(t.baseDelayMs*Math.pow(2,e),t.maxDelayMs)*(.75+.5*Math.random())}function L(e,t){if(t&&t>=500)return!0;if(429===t)return!0;if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("network")||t.includes("timeout")||t.includes("abort")}return!1}async function F(t,n){var a;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((a,o)=>{const i=(e=>{if(e){if(e instanceof Headers){const t={};return e.forEach((e,n)=>{t[n]=e}),t}return Array.isArray(e)?Object.fromEntries(e):e}})(n.headers),s=String((null==i?void 0:i["Content-Type"])||(null==i?void 0:i["content-type"])||"");let r=n.body;if("string"==typeof r&&s.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:t,method:n.method||"GET",data:r,header:i,success:e=>{var t,n;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)a(e.data);else{const a=(null==(n=null==(t=e.data)?void 0:t.error)?void 0:n.message)||`Request failed: ${e.statusCode}`;o(new x(a,e.statusCode??0))}},fail:e=>{o(new Error(e.errMsg||"Network error"))}})});const o="undefined"!=typeof window&&t.startsWith(window.location.origin),i=await fetch(t,{credentials:o?"include":"same-origin",...n});if(!i.ok){const e=await i.json().catch(()=>({}));throw new x((null==(a=e.error)?void 0:a.message)||`Request failed: ${t}`,i.status)}return i.json()}async function G(e){return async function(e,t={}){var n,a;const o=e.startsWith("http")?e:`${S}${e}`,i={...O,...t.retryConfig};let s=null;for(let l=0;l<=i.maxRetries;l++){if(null==(n=t.signal)?void 0:n.aborted)throw new Error("Request cancelled");try{return await F(o,t)}catch(r){s=r instanceof Error?r:new Error(String(r));const e=r instanceof x?r.statusCode:void 0;if(null==(a=t.signal)?void 0:a.aborted)throw s;if(l>=i.maxRetries)break;if(!L(r,e))break;const n=j(l,i);await new Promise(e=>setTimeout(e,n))}}throw s||new Error("Request failed")}(e,{method:"GET"})}let K=null;function U(){const e=t(null),o=t({}),i=t(null),s=t(null),r=t(null),l=t([]),c=t(!1),u=t(!1),d=t(null),f=t(!1),v=t(null),h=t=>{t.connected&&t.address?(e.value=t.address,c.value=!0):(e.value=null,c.value=!1),i.value=t.chainId??null,s.value=t.chainType??null,o.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const t={};return t[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(t[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),t}return{}})(t)},p=e=>{e&&(r.value=e.chainId??null,l.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const t=await E(),n=null==(e=t.getConfig)?void 0:e.call(t);return p(n),n},w=async e=>{const t=await E();if(!t.wallet.switchChain)throw new Error("switchChain not supported by SDK");await t.wallet.switchChain(e),i.value=e};let m=null;return n(()=>{const t=M();h(t),m=I(e=>{h(e)});const n=T();(null==n?void 0:n.getConfig)&&p(n.getConfig()),n&&!c.value&&(e=>e?(K||(K=e.wallet.getAddress().then(e=>e||null).catch(e=>{const t=e instanceof Error?e.message:String(e);return console.debug("[MiniApp SDK] Fallback wallet connection failed:",t),null}).finally(()=>{K=null})),K):Promise.resolve(null))(n).then(t=>{var a;if(!c.value&&t){e.value=t,c.value=!0;const o=null==(a=n.getConfig)?void 0:a.call(n);i.value=(null==o?void 0:o.chainId)??null,s.value=(null==o?void 0:o.chainType)??null,p(o)}}),E().then(e=>{var t;return p(null==(t=e.getConfig)?void 0:t.call(e))}).catch(()=>{})}),a(()=>{m&&m()}),{address:e,chainId:i,chainType:s,appChainId:r,supportedChains:l,balances:o,isConnected:c,isLoading:u,error:d,showConnectionPrompt:f,connectionPromptMessage:v,connect:async()=>{var t;u.value=!0,d.value=null;try{const n=await E(),a=await n.wallet.getAddress();if(!a)throw new Error("wallet returned empty address");e.value=a,c.value=!0;const o=null==(t=n.getConfig)?void 0:t.call(n);i.value=(null==o?void 0:o.chainId)??null,s.value=(null==o?void 0:o.chainType)??null,p(o)}catch(n){d.value=n}finally{u.value=!1}},invokeIntent:async e=>{var t;const n=T();if(!(null==(t=null==n?void 0:n.wallet)?void 0:t.invokeIntent))throw new Error("invokeIntent not available");return n.wallet.invokeIntent(e)},invokeContract:async e=>{var t;const n=await E(),a=null==(t=n.getConfig)?void 0:t.call(n),o=e.contractAddress||e.scriptHash||e.contractHash,i=e.method||e.operation;if(!o||!i)throw new Error("contract address and method required");return n.invoke("invokeFunction",{contract:o,method:i,args:e.args,chainId:null==a?void 0:a.chainId,chainType:null==a?void 0:a.chainType})},invokeRead:async e=>{var t;const n=await E(),a=null==(t=n.getConfig)?void 0:t.call(n),o=e.contractAddress||e.scriptHash||e.contractHash||(null==a?void 0:a.contractAddress),i=e.method||e.operation;if(!o)throw new Error("contract address not configured");if(!i)throw new Error("method required");return n.invoke("invokeRead",{contract:o,method:i,args:e.args||[],chainId:e.chainId||(null==a?void 0:a.chainId),chainType:e.chainType||(null==a?void 0:a.chainType)})},getContractAddress:async()=>{var e,t,n,a,o;const i=await E(),s=null==(e=i.getConfig)?void 0:e.call(i);if(null==s?void 0:s.contractAddress)return s.contractAddress;if((null==s?void 0:s.chainId)&&(null==(n=null==(t=null==s?void 0:s.chainContracts)?void 0:t[s.chainId])?void 0:n.address))return s.chainContracts[s.chainId].address||null;if(i.invoke)try{const e=await i.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(o=null==(a=null==e?void 0:e.chainContracts)?void 0:a[e.chainId])?void 0:o.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await E()).wallet.getAddress(),signMessage:async e=>{var t;const n=await E();if(!(null==(t=n.wallet)?void 0:t.signMessage))throw new Error("signMessage not available");return n.wallet.signMessage(e)},switchChain:w,switchToAppChain:async e=>{const t=await g(),n=(null==t?void 0:t.chainId)||(Array.isArray(null==t?void 0:t.supportedChains)&&t.supportedChains.length>0?t.supportedChains[0]:null)||e||null;if(!n)throw new Error("app chain not configured");await w(n)},getBalance:async e=>{var t;u.value=!0,d.value=null;try{const n=await E(),a=null==(t=n.getConfig)?void 0:t.call(n),s=(null==a?void 0:a.chainId)||i.value,r=s?`?chain_id=${encodeURIComponent(s)}`:"",l=await G(`/wallet-balance${r}`),c=(null==l?void 0:l.balances)??{};return o.value=c,e?c[e]||"0":c}catch(n){throw d.value=n,n}finally{u.value=!1}},getTransactions:async(e=20)=>{var t;u.value=!0,d.value=null;try{const n=Number.isNaN(e)||e<1?20:Math.min(e,100),a=await E(),o=null==(t=a.getConfig)?void 0:t.call(a),s=(null==o?void 0:o.chainId)||i.value,r=new URLSearchParams({limit:String(n)});s&&r.set("chain_id",s);const l=await G(`/wallet-transactions?${r.toString()}`);return(null==l?void 0:l.transactions)??[]}catch(n){throw d.value=n,n}finally{u.value=!1}},invoke:async(e,t)=>(await E()).invoke(e,t),requireConnection:(e={})=>{const{showPrompt:t=!0,errorMessage:n}=e;return!!c.value||(t&&(v.value=n||null,f.value=!0),!1)},closeConnectionPrompt:()=>{f.value=!1,v.value=null},clearError:()=>{d.value=null}}}const q=k(i({__name:"ChainWarning",props:{title:{default:"Wrong Network"},message:{default:"Switch to Neo N3 Mainnet to continue."},buttonText:{default:"Switch Network"},show:{type:Boolean,default:void 0}},emits:["switch","switch-complete","switch-error"],setup(e,{emit:n}){const a=e,i=n,{showWarning:g,switchToAppChain:w}=function(){const{switchToAppChain:e}=U();return{showWarning:o(()=>!1),switchToAppChain:async()=>{try{await e()}catch(t){throw console.error("[useChainValidation] Failed to switch chain:",t),t}}}}(),m=t(!1),y=o(()=>void 0!==a.show?a.show:g.value),b=async()=>{if(!m.value){m.value=!0,i("switch");try{await w(),i("switch-complete")}catch(e){const t=e instanceof Error?e:new Error(String(e));i("switch-error",t),console.error("[ChainWarning] Failed to switch chain:",t)}finally{m.value=!1}}};return(e,t)=>{const n=d,a=l;return y.value?(s(),r(a,{key:0,class:"chain-warning px-4 mb-4"},{default:c(()=>[u(p(R),{variant:"danger"},{default:c(()=>[u(a,{class:"flex flex-col items-center gap-2 py-1"},{default:c(()=>[u(n,{class:"text-center font-bold text-red-400"},{default:c(()=>[f(v(e.title),1)]),_:1}),e.message?(s(),r(n,{key:0,class:"text-xs text-center opacity-80 text-white"},{default:c(()=>[f(v(e.message),1)]),_:1})):h("",!0),u(p(N),{size:"sm",variant:"secondary",class:"mt-2",loading:m.value,onClick:b},{default:c(()=>[f(v(e.buttonText),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):h("",!0)}}}),[["__scopeId","data-v-3dc811c7"]]),$=5e3,W=1e4,H=100,V=["https://neomini.app","https://miniapp.neo.org","https://testnet.miniapp.neo.org"];const z=new class{constructor(){this.dynamicOrigins=new Set,this.baseOrigins=new Set([...V])}getSelfOrigin(){if("undefined"==typeof window)return null;try{const e=new URL(window.location.href);if("null"===e.origin)return null;if("http:"===e.protocol||"https:"===e.protocol)return e.origin}catch{}return null}getReferrerOrigin(){if("undefined"==typeof document||!document.referrer)return null;try{return new URL(document.referrer).origin}catch{return null}}getAllowedOrigins(){const e=new Set(this.baseOrigins);this.dynamicOrigins.forEach(t=>e.add(t));const t=this.getReferrerOrigin();t&&this.baseOrigins.has(t)&&e.add(t);const n=this.getSelfOrigin();if(n&&e.add(n),"undefined"!=typeof window){const t=window.location.hostname;"localhost"!==t&&"127.0.0.1"!==t||e.add(window.location.origin)}return e}isValid(e){return!(!e||"null"===e)&&this.getAllowedOrigins().has(e)}getTargetOrigin(){var e;const t=this.getReferrerOrigin();if(t&&this.baseOrigins.has(t))return t;try{if("undefined"!=typeof window&&window.parent!==window&&(null==(e=window.location.ancestorOrigins)?void 0:e.length)>0){const e=window.location.ancestorOrigins[0];if(this.baseOrigins.has(e))return e}}catch{}const n=this.getSelfOrigin();if(n)return n;if("undefined"!=typeof window){const e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e)return window.location.origin}throw new Error("Cannot determine safe target origin - no valid origin found")}getSafeTargetOrigin(){try{const e=this.getTargetOrigin();if(e&&"null"!==e)return e}catch{}if("undefined"!=typeof window&&window.parent!==window){const e=window.__MINIAPP_PARENT_ORIGIN__;if("string"==typeof e&&e&&this.baseOrigins.has(e))return e;throw new Error("Cannot communicate securely with parent - origin unknown. Ensure host app sets __MINIAPP_PARENT_ORIGIN__ or uses a supported browser.")}throw new Error("Cannot determine safe target origin - origin is null or undefined")}addDynamicOrigin(e){e&&"null"!==e&&this.dynamicOrigins.add(e)}};let B=null;function J(e){const t=null==e?void 0:e.layout;if("web"===t||"mobile"===t)return t;if("undefined"!=typeof window){const e=new URLSearchParams(window.location.search).get("layout");if("web"===e||"mobile"===e)return e;if(window.ReactNativeWebView)return"mobile"}return"web"}function X(e){if(!e||"object"!=typeof e)return!1;const t="function"==typeof e.invoke&&"function"==typeof e.getConfig,n="object"==typeof e.wallet||"object"==typeof e.payments;return t||n}function Y(e=$){return new Promise((t,n)=>{if("undefined"==typeof window)return void n(new Error("SDK not available in SSR"));if(window.MiniAppSDK)return X(window.MiniAppSDK)?void t(window.MiniAppSDK):void n(new Error("SDK validation failed"));const a=setTimeout(()=>{if(window.removeEventListener("miniapp-sdk-ready",o),window.parent!==window){const e=function(){const e=z.getSafeTargetOrigin();let t=0;const n=(n,...a)=>new Promise((o,i)=>{const s="undefined"!=typeof crypto&&crypto.getRandomValues?Array.from(crypto.getRandomValues(new Uint8Array(4)),e=>e.toString(16).padStart(2,"0")).join(""):Math.random().toString(36).slice(2,10),r=`sdk-${++t}-${Date.now()}-${s}`,l=setTimeout(()=>{window.removeEventListener("message",c),i(new Error("SDK invoke timeout"))},W),c=e=>{var t,n;z.isValid(e.origin)&&e.source===window.parent&&"miniapp_sdk_response"===(null==(t=e.data)?void 0:t.type)&&(null==(n=e.data)?void 0:n.id)===r&&(clearTimeout(l),window.removeEventListener("message",c),e.data.ok?o(e.data.result):i(new Error(e.data.error||"SDK call failed")))};window.addEventListener("message",c),window.parent.postMessage({type:"miniapp_sdk_request",id:r,method:n,params:a},e)});return{invoke:n,getConfig:()=>B?{...B,layout:J(B)}:"undefined"!=typeof window&&window.__MINIAPP_CONFIG__?(B=window.__MINIAPP_CONFIG__,{...B,layout:J(B??void 0)}):{appId:"",contractAddress:null,chainId:null,chainType:void 0,supportedChains:[],layout:J(),debug:!1},getAddress:()=>n("getAddress"),wallet:{getAddress:()=>n("wallet.getAddress"),switchChain:e=>n("wallet.switchChain",e),invokeIntent:e=>n("wallet.invokeIntent",e),signMessage:e=>n("wallet.signMessage",e)},payments:{payGAS:(e,t,a)=>n("payments.payGAS",e,t,a),payGASAndInvoke:(e,t,a)=>n("payments.payGASAndInvoke",e,t,a)},governance:{vote:(e,t,a,o)=>n("governance.vote",e,t,a,o),voteAndInvoke:(e,t,a,o)=>n("governance.voteAndInvoke",e,t,a,o),getCandidates:()=>n("governance.getCandidates")},rng:{requestRandom:e=>n("rng.requestRandom",e)},datafeed:{getPrice:e=>n("datafeed.getPrice",e),getPrices:()=>n("datafeed.getPrices"),getNetworkStats:()=>n("datafeed.getNetworkStats"),getRecentTransactions:e=>n("datafeed.getRecentTransactions",e)},stats:{getMyUsage:(e,t)=>n("stats.getMyUsage",e,t)},events:{list:e=>n("events.list",e),emit:(e,t)=>n("events.emit",e,t)},transactions:{list:e=>n("transactions.list",e)},automation:{register:(e,t,a,o)=>n("automation.register",e,t,a,o),unregister:e=>n("automation.unregister",e),status:e=>n("automation.status",e),list:()=>n("automation.list"),update:(e,t,a)=>n("automation.update",e,t,a),enable:e=>n("automation.enable",e),disable:e=>n("automation.disable",e),logs:(e,t)=>n("automation.logs",e,t)},share:{openModal:e=>n("share.openModal",e),getUrl:e=>n("share.getUrl",e),copy:e=>n("share.copy",e)}}}();window.MiniAppSDK=e,e.invoke("getConfig").then(e=>{e&&"object"==typeof e&&(B=e)}).catch(()=>{}),t(e)}else n(new Error("SDK timeout"))},e),o=()=>{if(clearTimeout(a),window.removeEventListener("miniapp-sdk-ready",o),window.MiniAppSDK){if(!X(window.MiniAppSDK))return void n(new Error("SDK validation failed"));t(window.MiniAppSDK)}else n(new Error("SDK not found"))};window.addEventListener("miniapp-sdk-ready",o)})}function Z(){return"undefined"==typeof window?null:window.MiniAppSDK??null}const Q=new Set;let ee={connected:!1,address:null,balance:null},te=null,ne=!1;"undefined"!=typeof window&&("undefined"!=typeof window&&(ne&&te||(te=e=>{if(e.source!==window.parent)return;if(!z.isValid(e.origin))return;const t=e.data;t&&"object"==typeof t&&("miniapp_config"!==t.type?"miniapp_wallet_state_change"===t.type&&(ee={connected:Boolean(t.connected),address:t.address||null,chainId:t.chainId??null,chainType:t.chainType??null,balance:t.balance||t.multiChainBalance||null,balances:t.balances||void 0},Q.forEach(e=>{try{e(ee)}catch(t){console.error("[MiniApp SDK] Wallet state listener error:",t)}})):t.config&&"object"==typeof t.config&&(B=t.config))},window.addEventListener("message",te),ne=!0)),setTimeout(function(){if("undefined"==typeof window)return;const e=z.getSafeTargetOrigin();try{window.parent.postMessage({type:"miniapp_ready"},e)}catch{}},H));class ae extends Error{constructor(e,t){super(e),this.statusCode=t,this.name="HttpError"}}const oe={maxRetries:3,baseDelayMs:1e3,maxDelayMs:1e4};function ie(e,t){return Math.min(t.baseDelayMs*Math.pow(2,e),t.maxDelayMs)*(.75+.5*Math.random())}function se(e,t){if(t&&t>=500)return!0;if(429===t)return!0;if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("network")||t.includes("timeout")||t.includes("abort")}return!1}async function re(t,n){var a;if("undefined"!=typeof uni&&"function"==typeof e)return new Promise((a,o)=>{const i=(e=>{if(e){if(e instanceof Headers){const t={};return e.forEach((e,n)=>{t[n]=e}),t}return Array.isArray(e)?Object.fromEntries(e):e}})(n.headers),s=String((null==i?void 0:i["Content-Type"])||(null==i?void 0:i["content-type"])||"");let r=n.body;if("string"==typeof r&&s.includes("application/json"))try{r=JSON.parse(r)}catch{}e({url:t,method:n.method||"GET",data:r,header:i,success:e=>{var t,n;if((e.statusCode??0)>=200&&(e.statusCode??0)<300)a(e.data);else{const a=(null==(n=null==(t=e.data)?void 0:t.error)?void 0:n.message)||`Request failed: ${e.statusCode}`;o(new ae(a,e.statusCode??0))}},fail:e=>{o(new Error(e.errMsg||"Network error"))}})});const o="undefined"!=typeof window&&t.startsWith(window.location.origin),i=await fetch(t,{credentials:o?"include":"same-origin",...n});if(!i.ok){const e=await i.json().catch(()=>({}));throw new ae((null==(a=e.error)?void 0:a.message)||`Request failed: ${t}`,i.status)}return i.json()}async function le(e){return async function(e,t={}){var n,a;const o=e.startsWith("http")?e:`https://api.neo-service-layer.io${e}`,i={...oe,...t.retryConfig};let s=null;for(let l=0;l<=i.maxRetries;l++){if(null==(n=t.signal)?void 0:n.aborted)throw new Error("Request cancelled");try{return await re(o,t)}catch(r){s=r instanceof Error?r:new Error(String(r));const e=r instanceof ae?r.statusCode:void 0;if(null==(a=t.signal)?void 0:a.aborted)throw s;if(l>=i.maxRetries)break;if(!se(r,e))break;const n=ie(l,i);await new Promise(e=>setTimeout(e,n))}}throw s||new Error("Request failed")}(e,{method:"GET"})}let ce=null;function ue(){const e=t(null),o=t({}),i=t(null),s=t(null),r=t(null),l=t([]),c=t(!1),u=t(!1),d=t(null),f=t(!1),v=t(null),h=t=>{t.connected&&t.address?(e.value=t.address,c.value=!0):(e.value=null,c.value=!1),i.value=t.chainId??null,s.value=t.chainType??null,o.value=(e=>{if(!e)return{};if(e.balances&&Object.keys(e.balances).length>0)return{...e.balances};if(e.balance){const t={};return t[e.balance.nativeSymbol||("neo-n3"===e.chainType?"GAS":"NATIVE")]=e.balance.native||"0",(e.balance.governance||e.balance.governanceSymbol)&&(t[e.balance.governanceSymbol||("neo-n3"===e.chainType?"NEO":"GOV")]=e.balance.governance||"0"),t}return{}})(t)},p=e=>{e&&(r.value=e.chainId??null,l.value=Array.isArray(e.supportedChains)?e.supportedChains:[])},g=async()=>{var e;const t=await Y(),n=null==(e=t.getConfig)?void 0:e.call(t);return p(n),n},w=async e=>{const t=await Y();if(!t.wallet.switchChain)throw new Error("switchChain not supported by SDK");await t.wallet.switchChain(e),i.value=e};let m=null;return n(()=>{var t;h(ee),t=e=>{h(e)},Q.add(t),t(ee),m=()=>Q.delete(t);const n=Z();(null==n?void 0:n.getConfig)&&p(n.getConfig()),n&&!c.value&&(e=>e?(ce||(ce=e.wallet.getAddress().then(e=>e||null).catch(e=>{const t=e instanceof Error?e.message:String(e);return console.debug("[MiniApp SDK] Fallback wallet connection failed:",t),null}).finally(()=>{ce=null})),ce):Promise.resolve(null))(n).then(t=>{var a;if(!c.value&&t){e.value=t,c.value=!0;const o=null==(a=n.getConfig)?void 0:a.call(n);i.value=(null==o?void 0:o.chainId)??null,s.value=(null==o?void 0:o.chainType)??null,p(o)}}),Y().then(e=>{var t;return p(null==(t=e.getConfig)?void 0:t.call(e))}).catch(()=>{})}),a(()=>{m&&m()}),{address:e,chainId:i,chainType:s,appChainId:r,supportedChains:l,balances:o,isConnected:c,isLoading:u,error:d,showConnectionPrompt:f,connectionPromptMessage:v,connect:async()=>{var t;u.value=!0,d.value=null;try{const n=await Y(),a=await n.wallet.getAddress();if(!a)throw new Error("wallet returned empty address");e.value=a,c.value=!0;const o=null==(t=n.getConfig)?void 0:t.call(n);i.value=(null==o?void 0:o.chainId)??null,s.value=(null==o?void 0:o.chainType)??null,p(o)}catch(n){d.value=n}finally{u.value=!1}},invokeIntent:async e=>{var t;const n=Z();if(!(null==(t=null==n?void 0:n.wallet)?void 0:t.invokeIntent))throw new Error("invokeIntent not available");return n.wallet.invokeIntent(e)},invokeContract:async e=>{var t;const n=await Y(),a=null==(t=n.getConfig)?void 0:t.call(n),o=e.contractAddress||e.scriptHash||e.contractHash,i=e.method||e.operation;if(!o||!i)throw new Error("contract address and method required");return n.invoke("invokeFunction",{contract:o,method:i,args:e.args,chainId:null==a?void 0:a.chainId,chainType:null==a?void 0:a.chainType})},invokeRead:async e=>{var t;const n=await Y(),a=null==(t=n.getConfig)?void 0:t.call(n),o=e.contractAddress||e.scriptHash||e.contractHash||(null==a?void 0:a.contractAddress),i=e.method||e.operation;if(!o)throw new Error("contract address not configured");if(!i)throw new Error("method required");return n.invoke("invokeRead",{contract:o,method:i,args:e.args||[],chainId:e.chainId||(null==a?void 0:a.chainId),chainType:e.chainType||(null==a?void 0:a.chainType)})},getContractAddress:async()=>{var e,t,n,a,o;const i=await Y(),s=null==(e=i.getConfig)?void 0:e.call(i);if(null==s?void 0:s.contractAddress)return s.contractAddress;if((null==s?void 0:s.chainId)&&(null==(n=null==(t=null==s?void 0:s.chainContracts)?void 0:t[s.chainId])?void 0:n.address))return s.chainContracts[s.chainId].address||null;if(i.invoke)try{const e=await i.invoke("getConfig");if(null==e?void 0:e.contractAddress)return e.contractAddress;if((null==e?void 0:e.chainId)&&(null==(o=null==(a=null==e?void 0:e.chainContracts)?void 0:a[e.chainId])?void 0:o.address))return e.chainContracts[e.chainId].address||null}catch{}return null},getAppConfig:g,getAddress:async()=>(await Y()).wallet.getAddress(),signMessage:async e=>{var t;const n=await Y();if(!(null==(t=n.wallet)?void 0:t.signMessage))throw new Error("signMessage not available");return n.wallet.signMessage(e)},switchChain:w,switchToAppChain:async e=>{const t=await g(),n=(null==t?void 0:t.chainId)||(Array.isArray(null==t?void 0:t.supportedChains)&&t.supportedChains.length>0?t.supportedChains[0]:null)||e||null;if(!n)throw new Error("app chain not configured");await w(n)},getBalance:async e=>{var t;u.value=!0,d.value=null;try{const n=await Y(),a=null==(t=n.getConfig)?void 0:t.call(n),s=(null==a?void 0:a.chainId)||i.value,r=s?`?chain_id=${encodeURIComponent(s)}`:"",l=await le(`/wallet-balance${r}`),c=(null==l?void 0:l.balances)??{};return o.value=c,e?c[e]||"0":c}catch(n){throw d.value=n,n}finally{u.value=!1}},getTransactions:async(e=20)=>{var t;u.value=!0,d.value=null;try{const n=Number.isNaN(e)||e<1?20:Math.min(e,100),a=await Y(),o=null==(t=a.getConfig)?void 0:t.call(a),s=(null==o?void 0:o.chainId)||i.value,r=new URLSearchParams({limit:String(n)});s&&r.set("chain_id",s);const l=await le(`/wallet-transactions?${r.toString()}`);return(null==l?void 0:l.transactions)??[]}catch(n){throw d.value=n,n}finally{u.value=!1}},invoke:async(e,t)=>(await Y()).invoke(e,t),requireConnection:(e={})=>{const{showPrompt:t=!0,errorMessage:n}=e;return!!c.value||(t&&(v.value=n||null,f.value=!0),!1)},closeConnectionPrompt:()=>{f.value=!1,v.value=null},clearError:()=>{d.value=null}}}function de(){const{t:i,locale:s}=A(),{chainType:r}=ue(),l=t([]),c=t(0),u=t(!1),d=t(!1),f=t(window.innerWidth),v=o(()=>f.value<768),h=o(()=>f.value>=1024),p=()=>{f.value=window.innerWidth};n(()=>window.addEventListener("resize",p)),a(()=>window.removeEventListener("resize",p));const g="undefined"!=typeof window&&["127.0.0.1","localhost"].includes(window.location.hostname),w={total:3,items:[{offchain_id:"101",title:"Developer Education Sprint",proposer:"NfYhP6Yw5tM4oX2Qz7bR5mU8dC6jK9vW1Q",state:"active",votes_amount_accept:152340,votes_amount_reject:12340,discussion_url:"https://forum.grantshares.io/t/dev-education-sprint",offchain_creation_timestamp:"2026-01-30T08:12:00.000Z",offchain_comments_count:18,onchain_id:57,description:"Build a 6-week education sprint focused on secure NEO smart contract development."},{offchain_id:"102",title:"Neo Wallet UX Research",proposer:"NQf1fY3mP8jC2rL7nD4sX9aV6kW3mP5tYH",state:"review",votes_amount_accept:92340,votes_amount_reject:4560,discussion_url:"https://forum.grantshares.io/t/wallet-ux-research",offchain_creation_timestamp:"2026-02-01T13:20:00.000Z",offchain_comments_count:9,onchain_id:58,description:"Research and prototype better onboarding and transaction clarity for first-time users."},{offchain_id:"103",title:"Cross-Chain Tooling Maintenance",proposer:"NdR6mX4tW8qL2dP5sH9fV3bN1kJ7gC2qZT",state:"executed",votes_amount_accept:210340,votes_amount_reject:7830,discussion_url:"https://forum.grantshares.io/t/cross-chain-tooling-maintenance",offchain_creation_timestamp:"2025-12-18T10:45:00.000Z",offchain_comments_count:24,onchain_id:54,description:"Maintain bridge and indexing tooling to improve reliability and incident response."}]},m=o(()=>l.value.filter(e=>_(e.state)).length),y=o(()=>l.value.length);function b(e){return String(e||"").toLowerCase()}function _(e){const t=b(e);return["active","review","voting","discussion"].includes(t)}return{grants:l,totalProposals:c,loading:u,fetchError:d,activeProposals:m,displayedProposals:y,isMobile:v,isDesktop:h,windowWidth:f,chainType:r,fetchGrants:async function(){u.value=!0,d.value=!1;try{let t=null;if(g&&(t=w),t||(t=await new Promise((t,n)=>{e({url:"/api/grantshares/proposals",success:e=>t((e=>{if("string"==typeof e)try{return JSON.parse(e)}catch{return null}return e})(e.data)),fail:e=>n(e)})})),t&&Array.isArray(t.items)){l.value=t.items.map(e=>{const t=function(e){try{return decodeURIComponent(escape(atob(e)))}catch{return e}}(e.title||"");return{id:String(e.offchain_id||e.id||""),title:t,proposer:String(e.proposer||e.proposer_address||e.proposerAddress||""),state:b(e.state||""),votesAccept:Number(e.votes_amount_accept||e.votesAmountAccept||0),votesReject:Number(e.votes_amount_reject||e.votesAmountReject||0),discussionUrl:String(e.discussion_url||e.discussionUrl||""),createdAt:String(e.offchain_creation_timestamp||e.offchainCreationTimestamp||""),comments:Number(e.offchain_comments_count||e.offchainCommentsCount||0),onchainId:e.onchain_id??e.onchainId??null}}).filter(e=>e.id&&e.title);const e=Number(t.total??t.totalCount??l.value.length);c.value=Number.isFinite(e)?e:l.value.length}else l.value=[],c.value=0}catch(t){l.value=[],c.value=0,d.value=!0}finally{u.value=!1}},formatCount:function(e){return Number.isFinite(e)?e.toLocaleString():"0"},formatDate:function(e){if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const n="zh"===s.value?"zh-CN":"en-US";return t.toLocaleDateString(n,{month:"short",day:"numeric",year:"numeric"})},getStatusLabel:function(e){return{active:i("statusActive"),review:i("statusReview"),voting:i("statusVoting"),discussion:i("statusDiscussion"),executed:i("statusExecuted"),cancelled:i("statusCancelled"),rejected:i("statusRejected"),expired:i("statusExpired")}[b(e)]||e},normalizeState:b,isActiveState:_}}t("en");const fe=k(i({__name:"ProposalGallery",props:{grants:{},loading:{type:Boolean},fetchError:{type:Boolean},t:{type:Function},formatCount:{type:Function},formatDate:{type:Function},getStatusLabel:{type:Function}},emits:["select","copyLink"],setup:e=>(e,t)=>{const n=d,a=l;return s(),r(a,{class:"proposal-gallery"},{default:c(()=>[e.loading?(s(),r(a,{key:0,class:"empty-state"},{default:c(()=>[u(n,{class:"empty-text"},{default:c(()=>[f(v(e.t("loading")),1)]),_:1})]),_:1})):e.fetchError?(s(),r(a,{key:1,class:"empty-state"},{default:c(()=>[u(n,{class:"empty-text"},{default:c(()=>[f(v(e.t("loadFailed")),1)]),_:1})]),_:1})):0===e.grants.length?(s(),r(a,{key:2,class:"empty-state"},{default:c(()=>[u(n,{class:"empty-text"},{default:c(()=>[f(v(e.t("noActiveGrants")),1)]),_:1})]),_:1})):(s(),r(a,{key:3,class:"grants-list"},{default:c(()=>[(s(!0),g(m,null,w(e.grants,o=>(s(),r(p(R),{key:o.id,variant:"erobo-neo",class:"grant-card-neo clickable",hoverable:"",onClick:t=>e.$emit("select",o)},{default:c(()=>[u(a,{class:"grant-card-header"},{default:c(()=>[u(a,{class:"grant-info"},{default:c(()=>[u(n,{class:"grant-title-glass"},{default:c(()=>[f(v(o.title),1)]),_:2},1024),o.proposer?(s(),r(n,{key:0,class:"grant-creator-glass"},{default:c(()=>[f(v(e.t("by"))+" "+v(o.proposer),1)]),_:2},1024)):h("",!0)]),_:2},1024),u(a,{class:y(["grant-badge-glass",o.state])},{default:c(()=>[u(n,{class:"badge-text"},{default:c(()=>[f(v(e.getStatusLabel(o.state)),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024),u(a,{class:"proposal-meta"},{default:c(()=>[null!==o.onchainId?(s(),r(n,{key:0,class:"meta-item"},{default:c(()=>[f("#"+v(o.onchainId),1)]),_:2},1024)):h("",!0),o.createdAt?(s(),r(n,{key:1,class:"meta-item"},{default:c(()=>[f(v(e.formatDate(o.createdAt)),1)]),_:2},1024)):h("",!0)]),_:2},1024),u(a,{class:"proposal-stats"},{default:c(()=>[u(a,{class:"stat-chip accept"},{default:c(()=>[f(v(e.t("votesFor"))+" "+v(e.formatCount(o.votesAccept)),1)]),_:2},1024),u(a,{class:"stat-chip reject"},{default:c(()=>[f(v(e.t("votesAgainst"))+" "+v(e.formatCount(o.votesReject)),1)]),_:2},1024),u(a,{class:"stat-chip comments"},{default:c(()=>[f(v(e.t("comments"))+" "+v(e.formatCount(o.comments)),1)]),_:2},1024)]),_:2},1024),u(a,{class:"proposal-actions"},{default:c(()=>[u(a,{onClick:t[0]||(t[0]=b(()=>{},["stop"]))},{default:c(()=>[u(p(N),{size:"sm",variant:"secondary",disabled:!o.discussionUrl,onClick:t=>e.$emit("copyLink",o.discussionUrl)},{default:c(()=>[f(v(o.discussionUrl?e.t("copyDiscussion"):e.t("noDiscussion")),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}))]),_:1})}}),[["__scopeId","data-v-26c093fb"]]),ve=k(i({__name:"index",setup(e){const{t:a}=A(),{grants:i,totalProposals:g,loading:w,fetchError:m,activeProposals:y,displayedProposals:b,fetchGrants:k,formatCount:S,formatDate:I,getStatusLabel:E}=de(),{statusMessage:T,statusType:M,copyLink:N}=function(){const{t:e}=A(),n=t(""),a=t("success");function o(e,t){n.value=e,a.value=t,setTimeout(()=>n.value="",5e3)}return{statusMessage:n,statusType:a,showStatus:o,copyLink:function(t){var n;if(!t)return;const a=null==globalThis?void 0:globalThis.uni;(null==a?void 0:a.setClipboardData)?a.setClipboardData({data:t,success:()=>o(e("linkCopied"),"success"),fail:()=>o(e("copyFailed"),"error")}):"undefined"!=typeof navigator&&(null==(n=navigator.clipboard)?void 0:n.writeText)?navigator.clipboard.writeText(t).then(()=>o(e("linkCopied"),"success")).catch(()=>o(e("copyFailed"),"error")):o(e("copyFailed"),"error")}}}(),x=t("grants"),O=o(()=>[{id:"grants",icon:"gift",label:a("tabGrants")},{id:"stats",icon:"chart",label:a("tabStats")},{id:"docs",icon:"book",label:a("docs")}]),j=o(()=>[a("step1"),a("step2"),a("step3"),a("step4")]),L=o(()=>[{name:a("feature1Name"),desc:a("feature1Desc")},{name:a("feature2Name"),desc:a("feature2Desc")}]);function F(e){try{_("current_grant_detail",e)}catch(t){}C({url:`/pages/detail/index?id=${e.id}`})}return n(()=>{k()}),(e,t)=>{const n=d,o=l;return s(),r(p(D),{"desktop-breakpoint":1024,class:"theme-grant-share",tabs:O.value,"active-tab":x.value,onTabChange:t[0]||(t[0]=e=>x.value=e)},{"desktop-sidebar":c(()=>[u(o,{class:"desktop-sidebar"},{default:c(()=>[u(n,{class:"sidebar-title"},{default:c(()=>[f(v(p(a)("overview")),1)]),_:1})]),_:1})]),default:c(()=>[u(o,{class:"app-container"},{default:c(()=>[u(p(q),{title:p(a)("wrongChain"),message:p(a)("wrongChainMessage"),"button-text":p(a)("switchToNeo")},null,8,["title","message","button-text"]),p(T)?(s(),r(p(R),{key:0,variant:"error"===p(M)?"danger":"success",class:"mb-4 text-center"},{default:c(()=>[u(n,{class:"font-bold uppercase tracking-wider"},{default:c(()=>[f(v(p(T)),1)]),_:1})]),_:1},8,["variant"])):h("",!0),"grants"===x.value?(s(),r(o,{key:1,class:"tab-content"},{default:c(()=>[u(fe,{grants:p(i),loading:p(w),"fetch-error":p(m),t:p(a),"format-count":p(S),"format-date":p(I),"get-status-label":p(E),onSelect:F,onCopyLink:p(N)},null,8,["grants","loading","fetch-error","t","format-count","format-date","get-status-label","onCopyLink"])]),_:1})):h("",!0),"stats"===x.value?(s(),r(o,{key:2,class:"tab-content"},{default:c(()=>[u(p(R),{variant:"erobo",class:"pool-overview-card"},{default:c(()=>[u(o,{class:"pool-stats"},{default:c(()=>[u(o,{class:"pool-stat-glass"},{default:c(()=>[u(n,{class:"stat-label-glass"},{default:c(()=>[f(v(p(a)("totalPool")),1)]),_:1}),u(n,{class:"stat-value-glass"},{default:c(()=>[f(v(p(S)(p(g))),1)]),_:1})]),_:1}),u(o,{class:"pool-stat-glass"},{default:c(()=>[u(n,{class:"stat-label-glass"},{default:c(()=>[f(v(p(a)("activeProjects")),1)]),_:1}),u(n,{class:"stat-value-glass"},{default:c(()=>[f(v(p(S)(p(y))),1)]),_:1})]),_:1}),u(o,{class:"pool-stat-glass"},{default:c(()=>[u(n,{class:"stat-label-glass"},{default:c(()=>[f(v(p(a)("yourShare")),1)]),_:1}),u(n,{class:"stat-value-glass highlight"},{default:c(()=>[f(v(p(S)(p(b))),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),"docs"===x.value?(s(),r(o,{key:3,class:"tab-content scrollable"},{default:c(()=>[u(p(P),{title:p(a)("title"),subtitle:p(a)("docSubtitle"),description:p(a)("docDescription"),steps:j.value,features:L.value},null,8,["title","subtitle","description","steps","features"])]),_:1})):h("",!0)]),_:1})]),_:1},8,["tabs","active-tab"])}}}),[["__scopeId","data-v-c460e415"]]);export{ve as default};
